function _t(t,e){return"undefined"!=typeof aws_lang&&"undefined"!=typeof aws_lang[t]&&(t=aws_lang[t]),e&&(t=t.replace("%s",e)),t}$(document).ready(function(){if(G_USER_INVALID_EMAIL.length){var t="你的邮箱 <strong>"+G_USER_INVALID_EMAIL+'</strong> 还未验证, 如果没有收到邮件<a class="alert-link" onclick="NKR.ajax_request(G_BASE_URL + \'/account/ajax/send_valid_mail/\');"> 点击重新发送</a>';NKR.notify(t,"warning",!1,"bottom",0,0,"up")}G_SITE_ANNOUNCE_CLOSE!=$.cookie("announce_close")&&$("#site-announce").show(),NKR.Notifcation.load(),$("body").on("click","[data-ma-action]",function(t){t.preventDefault();var e=$(this),a=$(this).data("ma-action");switch(a){case"sidebar-open":var i=e.data("ma-target"),n='<div data-ma-action="sidebar-close" class="ma-backdrop" />';$("body").addClass("sidebar-toggled"),$("#header, #header-alt, #main").append(n),e.addClass("toggled"),$(i).addClass("toggled");break;case"sidebar-close":$("body").removeClass("sidebar-toggled"),$(".ma-backdrop").remove(),$(".sidebar, .ma-trigger").removeClass("toggled");break;case"submenu-toggle":e.next().slideToggle(200),e.parent().toggleClass("toggled");break;case"search-open":$("#header").addClass("search-toggled"),$("#top-search-wrap input").focus();break;case"search-close":$("#header").removeClass("search-toggled");break;case"check-all-notifications":var o=e.closest(".list-group"),s=o.find(".list-group-item"),r=s.size();e.parent().fadeOut(),o.find(".list-group").prepend('<i class="grid-loading hide-it"></i>'),o.find(".grid-loading").fadeIn(1500);var c=0;s.each(function(){var t=$(this);setTimeout(function(){t.addClass("animated fadeOutRightBig").delay(1e3).queue(function(){t.remove()})},c+=150)}),setTimeout(function(){$(".him-notification").addClass("empty").find(".lg-body").html('<p class="no-notification">没有未读消息</p>')},150*r+200);break;case"action-header-open":ahParent=e.closest(".action-header").find(".ah-search"),ahParent.fadeIn(300),ahParent.find(".ahs-input").focus();break;case"action-header-close":ahParent.fadeOut(300),setTimeout(function(){ahParent.find(".ahs-input").val("")},350)}})}),$(document).ready(function(){if($(".dropdown")[0]&&($("body").on("click",".dropdown.open .dropdown-menu",function(t){t.stopPropagation()}),$(".dropdown").on("shown.bs.dropdown",function(t){$(this).attr("data-animation")&&($animArray=[],$animation=$(this).data("animation"),$animArray=$animation.split(","),$animationIn="animated "+$animArray[0],$animationOut="animated "+$animArray[1],$animationDuration="",$animArray[2]?$animationDuration=$animArray[2]:$animationDuration=500,$(this).find(".dropdown-menu").removeClass($animationOut),$(this).find(".dropdown-menu").addClass($animationIn))}),$(".dropdown").on("hide.bs.dropdown",function(t){$(this).attr("data-animation")&&(t.preventDefault(),$this=$(this),$dropdownMenu=$this.find(".dropdown-menu"),$dropdownMenu.addClass($animationOut),setTimeout(function(){$this.removeClass("open")},$animationDuration))})),$(".collapse")[0]&&($(".collapse").on("show.bs.collapse",function(t){$(this).closest(".panel").find(".panel-heading").addClass("active")}),$(".collapse").on("hide.bs.collapse",function(t){$(this).closest(".panel").find(".panel-heading").removeClass("active")}),$(".collapse.in").each(function(){$(this).closest(".panel").find(".panel-heading").addClass("active")})),$(".modal")[0]){var t=!1;$(".modal").on("show.bs.modal",function(){t=$(window).scrollTop()}).on("shown.bs.modal",function(){$("body").css({position:"fixed"})}).on("hide.bs.modal",function(){$("body").css({position:"relative"}),window.scrollTo(0,t)})}$(".fg-line")[0]&&($("body").on("focus",".fg-line .form-control",function(){$(this).closest(".fg-line").addClass("fg-toggled")}),$("body").on("blur",".form-control",function(){var t=$(this).closest(".form-group, .input-group"),e=t.find(".form-control").val();t.hasClass("fg-float")?0==e.length&&$(this).closest(".fg-line").removeClass("fg-toggled"):$(this).closest(".fg-line").removeClass("fg-toggled")})),$(".fg-float")[0]&&$(".fg-float .form-control").each(function(){var t=$(this).val();0==!t.length&&$(this).closest(".fg-line").addClass("fg-toggled")}),$("html").hasClass("ie9")&&$("input, textarea").placeholder({customClass:"ie9-placeholder"})}),function(t){t(document).ready(function(){t.fn.reverse=[].reverse,t(document).on("mouseenter",".fixed-action-btn:not(.toggle)",function(a){var i=t(this);e(i)}),t(document).on("mouseleave",".fixed-action-btn:not(.toggle)",function(e){var i=t(this);a(i)}),t(document).on("click",".fixed-action-btn.toggle > a",function(i){var n=t(this),o=n.parent();o.hasClass("active")?a(o):e(o)})}),t.fn.extend({openFAB:function(){e(t(this))},closeFAB:function(){a(t(this))}});var e=function(e){if($this=e,$this.hasClass("active")===!1){var a,i,n=$this.hasClass("horizontal");n===!0?i=40:a=40,$this.addClass("active"),$this.find("ul .btn").velocity({scaleY:".4",scaleX:".4",translateY:a+"px",translateX:i+"px"},{duration:0});var o=0;$this.find("ul .btn").reverse().each(function(){t(this).velocity({opacity:"1",scaleX:"1",scaleY:"1",translateY:"0",translateX:"0"},{duration:80,delay:o}),o+=40})}},a=function(t){$this=t;var e,a,i=$this.hasClass("horizontal");i===!0?a=40:e=40,$this.removeClass("active");$this.find("ul .btn").velocity("stop",!0),$this.find("ul .btn").velocity({opacity:"0",scaleX:".4",scaleY:".4",translateY:e+"px",translateX:a+"px"},{duration:80})}}(jQuery),$(document).ready(function(){new Swiper(".swiper-container",{pagination:".swiper-pagination",paginationClickable:!0,loop:!0})}),$(document).ready(function(){function t(t,e){e&&(t.removeClass("disabled").addClass("end").unbind("click").attr("href",G_BASE_URL+"/question/"),t.html("更多精彩答题，进入题库"))}function e(t,e){e&&(t.removeClass("disabled").addClass("end").unbind("click").attr("href",G_BASE_URL+"/topic/"),t.html("获取更多专题"))}function a(t,e){e&&(t.removeClass("disabled").addClass("end").unbind("click").attr("href",G_BASE_URL+"/article/"),t.html("获取更多知识"))}NKR.load_list_view(G_BASE_URL+"/explore/ajax/load_question_list/",$("#ql-load-more"),$("#question-list"),2,t),NKR.load_list_view(G_BASE_URL+"/explore/ajax/load_topic_list/",$("#tl-load-more"),$("#topic-list"),1,e),NKR.load_list_view(G_BASE_URL+"/explore/ajax/load_article_list/",$("#al-load-more"),$("#article-list"),1,a),$(".mr-tab").on("click",function(){var t=$($(this).attr("href"));t.find(".tc-list").is(":empty")&&t.find(".load-more a").click()})}),$(document).ready(function(){$("#login_form input").keydown(function(t){return 13==t.keyCode?($("#login_submit").click(),!1):void 0})}),$(document).ready(function(){$("#captcha").attr("src",G_BASE_URL+"/account/captcha/")}),$(document).ready(function(){function t(t){return t.length>=2&&t.length<=16}function e(t){var e=/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/;return e.test(t)}function a(t){return t.length>=6&&t.length<=17}function i(){return t($("#register_form input[name=user_name]").val())&&e($("#register_form input[name=email]").val())&&a($("#register_form input[name=password]").val())}function n(){return t($("#register_form input[name=user_name]").val())&&e($("#register_form input[name=email]").val())}function o(i){$(i).find("[type=text], [type=password]").on({focus:function(){var t=$(this),e=t.parent(),a=t.attr("tips");e.find(".help-block").detach(),e.find(".form-control-feedback").detach(),e.removeClass("has-error").removeClass("has-success").removeClass("has-feedback"),"undefined"!=typeof a&&""!=a&&e.append('<small class="help-block">'+t.attr("tips")+"</small>")},blur:function(){function i(){var t=o.find(".help-block"),e=o.find(".form-control-feedback");t.detach(),e.detach(),o.removeClass("has-error").removeClass("has-warning").removeClass("has-success").removeClass("has-feedback"),c?(o.addClass("has-feedback"),o.append('<span class="icon icon-check form-control-feedback"></span>')):"undefined"!=typeof r&&""!=r&&(o.addClass("has-error"),o.append('<small class="help-block">'+r+"</small>"))}var n=$(this),o=n.parent(),s=n.val(),r=n.attr("errortips"),c=!1;switch(n.attr("name")){case"user_name":c=t(s),c&&$.get(G_BASE_URL+"/account/ajax/check_username/username-"+encodeURIComponent(s),function(t){-1==t.errno&&(c=!1,r=t.err,i())},"json");break;case"email":c=e(s),c&&$.get(G_BASE_URL+"/account/ajax/check_email/email-"+encodeURIComponent(s),function(t){-1==t.errno&&(c=!1,r=t.err,i())},"json");break;case"password":c=a(s);break;default:r=""}i()}})}o("#register_form"),$("#submit-form").on("click",function(t){t.preventDefault(),i()&&NKR.ajax_post($("#register_form"),NKR.ajax_processer,"error_message")}),$("#sns-register-submit").on("click",function(t){t.preventDefault(),n()&&NKR.ajax_post($("#register_form"),NKR.ajax_processer,"error_message")})}),$(document).ready(function(){$(".change-email").on("click",function(t){t.preventDefault(),$(".lcb-resend-email").hide(),$(".lcb-change-email").show()})});var NKR={notify:function(t,e,a,i,n,o,s){var r="animated fadeInDown";switch(s){case"down":r="animated fadeInDown";break;case"up":r="animated fadeInUp";break;case"left":r="animated fadeInLeft";break;case"right":r="animated fadeInRight"}$.notify({icon:"",title:"",message:t},{element:"body",type:e,allow_dismiss:a,placement:{from:i,align:"center"},offset:{x:n,y:o},spacing:10,z_index:9999,delay:2500,timer:1e3,mouse_over:!1,newest_on_top:!0,animate:{enter:r,exit:"animated fadeOutDown"},icon_type:"class",template:'<div data-notify="container" class="alert alert-{0}" role="alert"><button type="button" class="close c-white" data-notify="dismiss"><span aria-hidden="true">&times;</span><span class="sr-only">close</span></button><span data-notify="icon" class="c-white"></span> <span data-notify="title">{1}</span><span data-notify="message" class="c-white">{2}</span></div>'})},loading:function(t){if(!$("#aw-loading").length,"show"==t){if("block"==$("#aw-loading").css("display"))return!1;$("#aw-loading").fadeIn(),NKR.G.loading_timer=setInterval(function(){NKR.G.loading_bg_count-=1,$("#aw-loading-box").css("background-position","0px "+40*NKR.G.loading_bg_count+"px"),1==NKR.G.loading_bg_count&&(NKR.G.loading_bg_count=12)},100)}else $("#aw-loading").fadeOut(),clearInterval(NKR.G.loading_timer)},loading_mini:function(t,e){!t.find("#aw-loading-mini-box").length,"show"==e?(t.find("#aw-loading-mini-box").fadeIn(),NKR.G.loading_timer=setInterval(function(){NKR.G.loading_mini_bg_count-=1,$("#aw-loading-mini-box").css("background-position","0px "+16*NKR.G.loading_mini_bg_count+"px"),1==NKR.G.loading_mini_bg_count&&(NKR.G.loading_mini_bg_count=9)},100)):(t.find("#aw-loading-mini-box").fadeOut(),clearInterval(NKR.G.loading_timer))},ajax_error_msg:function(t){NKR.notify(t,"danger",!0,"top",0,0,"down")},ajax_request:function(t,e){function a(t){return NKR.loading("hide"),t?void(-1==t.errno?NKR.alert(t.err):0==t.errno?NKR.alert(t.err,"success"):t.rsm&&t.rsm.url?window.location=decodeURIComponent(t.rsm.url):1==t.errno&&window.location.reload()):!1}function i(t){NKR.loading("hide"),""!=$.trim(t.responseText)&&alert(_t("发生错误, 返回的信息:")+" "+t.responseText)}return NKR.loading("show"),e?$.post(t,e+"&_post_type=ajax",function(t){a(t)},"json").error(function(t){i(t)}):$.get(t,function(t){a(t)},"json").error(function(t){i(t)}),!1},ajax_post:function(t,e,a){if("undefined"!=typeof CKEDITOR)for(instance in CKEDITOR.instances)CKEDITOR.instances[instance].updateElement();if("function"!=typeof e){var e=NKR.ajax_processer;NKR.loading("show")}if(a)"reply_question"==a&&(NKR.loading("show"),$(".btn-reply").addClass("disabled"),void 0!=EDITOR&&EDITOR.removeListener("blur",EDITOR_CALLBACK));else var a="default";var i={_post_type:"ajax"};t.ajaxSubmit({dataType:"json",data:i,success:function(t){e(a,t)},error:function(t){console.log(t),""!=$.trim(t.responseText)?(NKR.loading("hide"),alert(_t("发生错误, 返回的信息:")+" "+t.responseText)):0==t.status?(NKR.loading("hide"),alert(_t("网络链接异常"))):500==t.status&&(NKR.loading("hide"),alert(_t("内部服务器错误")))}})},ajax_processer:function(t,e){if(NKR.loading("hide"),"undefined"==typeof e.errno)NKR.alert(e);else if(0==e.errno)NKR.alert(e.err,"success");else if(1!=e.errno)switch(t){case"default":case"comments_form":case"reply":case"reply_question":case"invite_friend":NKR.alert(e.err),$(".submit-comment-box, .btn-reply").removeClass("disabled");break;case"ajax_post_alert":case"ajax_post_modal":case"error_message":NKR.ajax_error_msg(e.err),$("#captcha").length&&$("#captcha").click()}else if("comments_form"==t&&(NKR.reload_comments_list(e.rsm.item_id,e.rsm.item_id,e.rsm.type_name),$("#comment-box-"+e.rsm.type_name+"-"+e.rsm.item_id+" form textarea").val(""),$("#comment-box-"+e.rsm.type_name+"-"+e.rsm.item_id).hide(),$(".submit-comment-box").removeClass("disabled")),e.rsm&&e.rsm.url)window.location.href==e.rsm.url?window.location.reload():window.location=decodeURIComponent(e.rsm.url);else switch(t){case"default":case"ajax_post_alert":case"error_message":window.location.reload();break;case"ajax_post_modal":$("#aw-ajax-box div.modal").modal("hide");break;case"invite_friend":$("#modalInviteFriend").modal("hide"),swal({title:"发送邀请成功",text:"",html:!0,confirmButtonText:"确定",type:"success"});break;case"reply_question":NKR.loading("hide"),e.rsm.ajax_html?($(".load-question-answers").click(),$(".comment-box .btn-reply").removeClass("disabled"),"undefined"!=EDITOR&&EDITOR.setData("")):e.rsm.url?window.location=decodeURIComponent(e.rsm.url):window.location.reload();break;case"reply":NKR.loading("hide"),e.rsm.ajax_html?($(".article-comment-items").append(e.rsm.ajax_html),$(".article-reply-button").removeClass("disabled"),$.scrollTo($("#"+$(e.rsm.ajax_html).attr("id")),600,{queue:!0}),$("#comment_editor").val("")):e.rsm.url?window.location=decodeURIComponent(e.rsm.url):window.location.reload()}},load_list_view:function(t,e,a,i,n){return e.attr("id")?(i||(i=0),void 0==e.attr("data-page")?e.attr("data-page",i):e.attr("data-page",parseInt(e.attr("data-page"))+1),e.bind("click",function(){var e=$(this),o=$('<div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>');return o.insertBefore(e.hide()),$.get(t+"__page-"+e.attr("data-page"),function(t){var s=!1;o.remove(),e.show(),""!=$.trim(t)?(e.attr("data-page")==i&&"false"!=e.attr("auto-load")?a.html(t):a.append(t),e.attr("data-page",parseInt(e.attr("data-page"))+1)):(e.attr("data-page")==i&&"false"!=e.attr("auto-load")&&a.html('<p class="c-gray text-center p-t-15 p-b-15">没有内容</p>'),s=!0,e.addClass("disabled").unbind("click").bind("click",function(t){t.preventDefault()})),null!=n&&n(e,s)}),!1}),void("false"!=e.attr("auto-load")&&e.click())):!1},reload_comments_list:function(t,e,a){$.get(G_BASE_URL+"/question/ajax/get_"+a+"_comments/"+a+"_id-"+t,function(t){$("#comment-list-"+a+"-"+e).html(t)})},alert:function(t,e){switch(e){case"info":NKR.notify(t,"info",!0,"top",0,0,"down");break;case"warning":NKR.notify(t,"warning",!0,"top",0,0,"down");break;case"success":NKR.notify(t,"success",!0,"top",0,0,"down");break;case"error":NKR.notify(t,"danger",!0,"top",0,0,"down");break;default:NKR.notify(t,"danger",!0,"top",0,0,"down")}},dialog:function(type,data,callback){switch(type){case"alertImg":var template=Hogan.compile(AW_TEMPLATE.alertImg).render({hide:data.hide,url:data.url,message:data.message});break;case"publish":var template=Hogan.compile(AW_TEMPLATE.publishBox).render({category_id:data.category_id,ask_user_id:data.ask_user_id});break;case"redirect":var template=Hogan.compile(AW_TEMPLATE.questionRedirect).render({data_id:data});break;case"commentEdit":var template=Hogan.compile(AW_TEMPLATE.editCommentBox).render({answer_id:data.answer_id,attach_access_key:data.attach_access_key});break;case"solutionEdit":var template=Hogan.compile(AW_TEMPLATE.editSolutionBox).render({question_id:data.question_id,solution_id:data.solution_id,attach_access_key:data.attach_access_key});break;case"favorite":var template=Hogan.compile(AW_TEMPLATE.favoriteBox).render({item_id:data.item_id,item_type:data.item_type});break;case"inbox":var template=Hogan.compile(AW_TEMPLATE.inbox).render({recipient:data});break;case"report":var template=Hogan.compile(AW_TEMPLATE.reportBox).render({item_type:data.item_type,item_id:data.item_id});break;case"topicEditHistory":var template=AW_TEMPLATE.ajaxData.replace("{{title}}",_t("编辑记录")).replace("{{data}}",data);break;case"ajaxData":var template=AW_TEMPLATE.ajaxData.replace("{{title}}",data.title).replace("{{data}}",'<div id="aw_dialog_ajax_data"></div>');break;case"imagePreview":var template=AW_TEMPLATE.ajaxData.replace("{{title}}",data.title).replace("{{data}}",'<p align="center"><img src="'+data.image+'" alt="" style="max-width:520px" /></p>');break;case"confirm":var template=Hogan.compile(AW_TEMPLATE.confirmBox).render({message:data.message});break;case"recommend":var template=Hogan.compile(AW_TEMPLATE.recommend).render();break;case"projectEventForm":var template=Hogan.compile(AW_TEMPLATE.projectEventForm).render({project_id:data.project_id,contact_name:data.contact_name,contact_tel:data.contact_tel,contact_email:data.contact_email});break;case"projectStockForm":var template=Hogan.compile(AW_TEMPLATE.projectStockForm).render({project_id:data.project_id,contact_name:data.contact_name,contact_tel:data.contact_tel,contact_email:data.contact_email});break;case"activityBox":var template=Hogan.compile(AW_TEMPLATE.activityBox).render({contact_name:data.contact_name,contact_tel:data.contact_tel,contact_qq:data.contact_qq});break;case"addTopic":var template=Hogan.compile(AW_TEMPLATE.addTopicBox).render({question_id:data.question_id})}if(template){switch($(".alert-box").length&&$(".alert-box").remove(),$("#aw-ajax-box").html(template).show(),type){case"redirect":NKR.Dropdown.bind_dropdown_list($(".aw-question-redirect-box #question-input"),"redirect");break;case"inbox":NKR.Dropdown.bind_dropdown_list($(".inbox #invite-input"),"inbox"),$("body").on("click",".inbox .lv-item",function(){$(".inbox #quick_publish input.form-control").val($(this).attr("data-username")),$(this).parents(".dropdown").removeClass("open")});break;case"publish":NKR.Dropdown.bind_dropdown_list($(".aw-publish-box #quick_publish_question_content"),"publish"),NKR.Dropdown.bind_dropdown_list($(".aw-publish-box #aw_edit_topic_title"),"topic"),1==parseInt(data.category_enable)?$.get(G_BASE_URL+"/publish/ajax/fetch_question_category/",function(result){NKR.Dropdown.set_dropdown_list(".aw-publish-box .dropdown",eval(result),data.category_id),$(".aw-publish-title .dropdown li a").click(function(){$(".aw-publish-box #quick_publish_category_id").val($(this).attr("data-value")),$(".aw-publish-box #aw-topic-tags-select").html($(this).text())})}):$(".aw-publish-box .aw-publish-title").hide(),""!=data.ask_user_id&&void 0!=data.ask_user_id&&$(".aw-publish-box .modal-title").html("向 "+data.ask_user_name+" 提问"),$("#aw-search-query").val()&&$("#aw-search-query").val()!=$("#aw-search-query").attr("placeholder")&&$("#quick_publish_question_content").val($("#aw-search-query").val()),NKR.Init.init_topic_edit_box("#quick_publish .aw-edit-topic"),$("#quick_publish .aw-edit-topic").click(),$("#quick_publish .close-edit").hide(),data.topic_title&&$("#quick_publish .aw-edit-topic").parents(".aw-topic-bar").prepend('<span class="topic-tag"><a class="text">'+data.topic_title+'</a><a class="close" onclick="$(this).parents(\'.topic-tag\').detach();"><i class="icon icon-delete"></i></a><input type="hidden" value="'+data.topic_title+'" name="topics[]" /></span>'),"undefined"!=typeof G_QUICK_PUBLISH_HUMAN_VALID&&($("#quick_publish_captcha").show(),$("#captcha").click());break;case"favorite":$.get(G_BASE_URL+"/favorite/ajax/get_favorite_tags/",function(t){var e="";$.each(t,function(t,a){e+='<li><a data-value="'+a.title+'"><i class="md md-check"></i><span class="title">'+a.title+"</span></a></li>"}),$(".aw-favorite-tag-list ul").append(e),$.post(G_BASE_URL+"/favorite/ajax/get_item_tags/",{item_id:$('#favorite_form input[name="item_id"]').val(),item_type:$('#favorite_form input[name="item_type"]').val()},function(t){t&&$.each(t,function(e,a){var i=e;$.each($(".aw-favorite-tag-list ul li .title"),function(e,a){$(this).text()==t[i]&&$(this).parents("li").addClass("active")})})},"json"),$(document).on("click",".aw-favorite-tag-list ul li a",function(){var t=this,e=!0,a=G_BASE_URL+"/favorite/ajax/update_favorite_tag/";$(this).parents("li").hasClass("active")&&(a=G_BASE_URL+"/favorite/ajax/remove_favorite_tag/",e=!1),$.post(a,{item_id:$('#favorite_form input[name="item_id"]').val(),item_type:$('#favorite_form input[name="item_type"]').val(),tags:$(t).attr("data-value")},function(a){1==a.errno&&(e?$(t).parents("li").addClass("active"):$(t).parents("li").removeClass("active"))},"json")})},"json");break;case"report":$(".aw-report-box select option").click(function(){$(".aw-report-box textarea").text($(this).attr("value"))});break;case"commentEdit":$.get(G_BASE_URL+"/question/ajax/fetch_answer_data/"+data.answer_id,function(t){$("#editor_reply").html(t.answer_content.replace("&amp;","&"));var e=CKEDITOR.replace("editor_reply");if("Y"==UPLOAD_ENABLE){var a=new FileUpload("file",".aw-edit-comment-box .upload-box .btn",".aw-edit-comment-box .upload-box .upload-container",G_BASE_URL+"/publish/ajax/attach_upload/id-answer__attach_access_key-"+ATTACH_ACCESS_KEY,{insertTextarea:".aw-edit-comment-box #editor_reply",editor:e});$.post(G_BASE_URL+"/publish/ajax/answer_attach_edit_list/","answer_id="+data.answer_id,function(t){return t.err?!1:void $.each(t.rsm.attachs,function(t,e){a.setFileList(e)})},"json")}else $(".aw-edit-comment-box .file-upload-box").hide()},"json");break;case"solutionEdit":$.get(G_BASE_URL+"/question/ajax/get_question_solution_data/"+data.question_id,function(t){$("#editor_solution").html(t.content.replace("&amp;","&"));var e=CKEDITOR.replace("editor_solution"),a=$("#solution_edit input[name=attach_access_key]").val();if("Y"==UPLOAD_ENABLE){var i=new FileUpload("file",".edit-solution-box .upload-box .btn",".edit-solution-box .upload-box .upload-container",G_BASE_URL+"/publish/ajax/attach_upload/id-solution__attach_access_key-"+a,{insertTextarea:".aw-edit-solution-box #editor_solution",editor:e});$.post(G_BASE_URL+"/publish/ajax/solution_attach_edit_list/","solution_id="+data.solution_id,function(t){return t.err||!t.rsm.attachs?!1:void $.each(t.rsm.attachs,function(t,e){i.setFileList(e)})},"json")}else $(".edit-solution-box .upload-box").hide()},"json");break;case"ajaxData":$.get(data.url,function(t){$("#aw_dialog_ajax_data").html(t)});break;case"confirm":$(".aw-confirm-box .yes").click(function(){return callback&&callback(),$(".alert-box").modal("hide"),!1});break;case"recommend":$.get(G_BASE_URL+"/help/ajax/list/",function(t){if(t&&0!=t){var e="";$.each(t,function(t,a){e+='<li class="aw-border-radius-5"><img class="aw-border-radius-5" src="'+a.icon+'"><a data-id="'+a.id+'" class="aw-hide-txt">'+a.title+'</a><i class="icon icon-followed"></i></li>'}),$(".aw-recommend-box ul").append(e),$.each($(".aw-recommend-box ul li"),function(t,e){data.focus_id==$(this).find("a").attr("data-id")&&$(this).addClass("active")}),$(document).on("click",".aw-recommend-box ul li a",function(){var t=$(this),e=G_BASE_URL+"/help/ajax/add_data/",a=!1;$(this).parents("li").hasClass("active")&&(e=G_BASE_URL+"/help/ajax/remove_data/",a=!0),$.post(e,{item_id:data.item_id,id:t.attr("data-id"),title:t.text(),type:data.type},function(e){1==e.errno&&(a?t.parents("li").removeClass("active"):($(".aw-recommend-box ul li").removeClass("active"),t.parents("li").addClass("active")))},"json")})}else $(".error_message").html(_t("请先去后台创建好章节")),"none"!=$(".error_message").css("display")?NKR.shake($(".error_message")):$(".error_message").fadeIn()},"json");break;case"addTopic":var questionId=$("#cloud-topic-list").attr("data-question-id");$("body").on("click",".cloud-topic-item",function(t){t.preventDefault();var e=$(this),a=e.attr("data-topic-id");$.get(G_BASE_URL+"/topic/ajax/toggle_question_topic_relation/topic_id-"+a+"__question_id-"+questionId,function(t){e.toggleClass("active",t.has_relation)},"json")}),NKR.load_list_view(G_BASE_URL+"/topic/ajax/get_question_cloud_topic_list/question_id-"+questionId,$("#topic-cloud-load-more"),$("#cloud-topic-list ul"),2),$.get(G_BASE_URL+"/topic/ajax/get_question_cloud_topic_list/question_id-"+questionId,function(t){$("#cloud-topic-list ul").html(t)})}$(".alert-box").modal("show")}},check_placeholder:function(t){$.each(t,function(){"undefined"!=typeof $(this).attr("placeholder")&&($(this).attr("data-placeholder","true"),""==$(this).val()&&$(this).addClass("aw-placeholder").val($(this).attr("placeholder")),$(this).focus(function(){$(this).val()==$(this).attr("placeholder")&&$(this).removeClass("aw-placeholder").val("")}),$(this).blur(function(){""==$(this).val()&&$(this).addClass("aw-placeholder").val($(this).attr("placeholder"))}))})},hightlight:function(t,e){if(t.hasClass(e))return!0;var a=setInterval(function(){t.addClass(e)},500),i=setInterval(function(){t.removeClass(e)},600);setTimeout(function(){clearInterval(a),clearInterval(i),t.addClass(e)},1200),setTimeout(function(){t.removeClass(e)},6e3)},nl2br:function(t){return t.replace(new RegExp("\r\n|\n\r|\r|\n","g"),"<br />")},content_switcher:function(t,e){t.hide(),e.removeClass("hide"),e.fadeIn()},htmlspecialchars:function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},show_card_box:function(t,e,a){if(!a)var a=300;$(document).on("mouseover",t,function(){clearTimeout(NKR.G.card_box_hide_timer);var t=$(this);NKR.G.card_box_show_timer=setTimeout(function(){function a(e,a){"user"==e&&$.get(G_BASE_URL+a+t.attr("data-id"),function(t){var e,a=t.focus;t.verified;1==a?(a="following",focusIcon="md-check",e="正在关注"):(a="",focusIcon="md-add",e="添加关注"),"enterprise"==t.verified?(verified_enterprise="icon-v i-ve",verified_title="企业认证"):"personal"==t.verified?(verified_enterprise="icon-v",verified_title="个人认证"):verified_enterprise=verified_title="";var i=G_BASE_URL+"/people/questions/id-"+t.uid+"__type-publish",o=G_BASE_URL+"/people/questions/id-"+t.uid+"__type-answered",s=G_BASE_URL+"/people/questions/id-"+t.uid+"__type-comments";$("#aw-ajax-box").html(Hogan.compile(AW_TEMPLATE.userCard).render({verified_enterprise:verified_enterprise,verified_title:verified_title,uid:t.uid,avatar_file:t.avatar_file,user_name:t.user_name,reputation:t.reputation,agree_count:t.agree_count,signature:t.signature,url:t.url,category_enable:t.category_enable,focus:a,focusIcon:focusIcon,focusTxt:e,ask_name:"'"+t.user_name+"'",fansCount:t.fans_count,success_ratio:(100*t.success_ratio).toFixed(1),poft_ratio:(100*t.poft_ratio).toFixed(1),question_count:t.question_count,answer_count:t.answer_count,quiz_count:t.quiz_count,question_count_url:i,quiz_count_url:o,answer_count_url:s})),(""==G_USER_ID||G_USER_ID==t.uid||t.uid<0)&&$("#aw-card-tips-user .mod-footer").hide(),n(),NKR.G.cashUserData.push($("#aw-ajax-box").html())},"json"),"topic"==e&&$.get(G_BASE_URL+a+t.attr("data-id"),function(t){var e,a=t.focus;0==a?(a="",e=_t("关注")):(a="active",e=_t("取消关注")),$("#aw-ajax-box").html(Hogan.compile(AW_TEMPLATE.topicCard).render({topic_id:t.topic_id,topic_pic:t.topic_pic,topic_title:t.topic_title,topic_description:t.topic_description,discuss_count:t.discuss_count,focus_count:t.focus_count,focus:a,focusTxt:e,url:t.url,fansCount:t.fans_count})),""==G_USER_ID&&$("#aw-card-tips .follow").hide(),n(),NKR.G.cashTopicData.push($("#aw-ajax-box").html())},"json")}function i(e){"user"==e&&$.each(NKR.G.cashUserData,function(e,a){a.match('data-id="'+t.attr("data-id")+'"')&&($("#aw-ajax-box").html(a),$("#aw-card-tips").removeAttr("style"),n(),o=1)}),"topic"==e&&$.each(NKR.G.cashTopicData,function(e,a){a.match('data-id="'+t.attr("data-id")+'"')&&($("#aw-ajax-box").html(a),$("#aw-card-tips").removeAttr("style"),n(),o=1)})}function n(){$(".user-pie-ratio")[0]&&NKR.showpie("user-pie-ratio",100);var e=t.offset().left,a=t.offset().top+t.height()+5,i=t.offset().top-$(window).scrollTop();i+$("#aw-card-tips").innerHeight()>$(window).height()&&(a=t.offset().top-$("#aw-card-tips").innerHeight()-10),e+$("#aw-card-tips").innerWidth()>$(window).width()&&(e=t.offset().left-$("#aw-card-tips").innerWidth()+t.innerWidth()),$("#aw-card-tips").css({left:e,top:a}).fadeIn()}if(t.attr("data-id"))switch(e){case"user":if(0==NKR.G.cashUserData.length)a("user","/people/ajax/user_info/uid-");else{var o=0;i("user"),0==o&&a("user","/people/ajax/user_info/uid-")}break;case"topic":if(0==NKR.G.cashTopicData.length)a("topic","/topic/ajax/topic_info/topic_id-");else{var o=0;i("topic"),0==o&&a("topic","/topic/ajax/topic_info/topic_id-")}}},a)}),$(document).on("mouseout",t,function(){clearTimeout(NKR.G.card_box_show_timer),NKR.G.card_box_hide_timer=setTimeout(function(){$("#aw-card-tips").fadeOut()},600)})},at_user_lists:function(t,e){function a(){$(".content_cursor")[0]||$("#aw-ajax-box").append('<span class="content_cursor"></span>'),$("#aw-ajax-box").find(".content_cursor").css({left:parseInt($(t).offset().left+parseInt($(t).css("padding-left"))+2),top:parseInt($(t).offset().top+parseInt($(t).css("padding-left")))}),$(".aw-invite-dropdown")[0]||$("#aw-ajax-box").append('<ul class="aw-invite-dropdown"></ul>')}function i(){$(".aw-invite-dropdown").css({left:$(".content_cursor").offset().left+$(".content_cursor").innerWidth(),top:$(".content_cursor").offset().top+24}).show()}function n(t){var e={text:"",start:0,end:0};if(t.focus(),t.setSelectionRange)e.start=t.selectionStart,e.end=t.selectionEnd,e.text=e.start!=e.end?t.value.substring(e.start,e.end):"";else if(document.selection){var a,i=document.selection.createRange(),n=document.body.createTextRange();for(n.moveToElementText(t),e.text=i.text,e.bookmark=i.getBookmark(),a=0;n.compareEndPoints("StartToStart",i)<0&&0!==i.moveStart("character",-1);a++)"\n"==t.value.charAt(a)&&a++;e.start=a,e.end=e.text.length+e.start}return e}$(t).keyup(function(t){var o=$(this),s=n($(this)[0]).start;if("@"==$(this).val().charAt(s-1))a(),$("#aw-ajax-box .content_cursor").html($(this).val().substring(0,s));else{var r=$(".aw-invite-dropdown li");switch(t.which){case 38:var c;r.hasClass("active")?($.each(r,function(t,e){$(this).hasClass("active")&&($(this).removeClass("active"),c=0==$(this).index()?r.length-1:$(this).index()-1)}),r.eq(c).addClass("active")):r.eq(r.length-1).addClass("active");break;case 40:var c;r.hasClass("active")?($.each(r,function(t,e){$(this).hasClass("active")&&($(this).removeClass("active"),c=$(this).index()==r.length-1?0:$(this).index()+1)}),r.eq(c).addClass("active")):r.eq(0).addClass("active");break;case 13:$.each($(".aw-invite-dropdown li"),function(t,e){$(this).hasClass("active")&&$(this).click()});break;default:if($(".aw-invite-dropdown")[0]){for(var d=0,l=s;l>0;l--)if("@"==$(this).val().charAt(l)){d=l;break}$.get(G_BASE_URL+"/search/ajax/search/?type=users&q="+encodeURIComponent($(this).val().substring(s,d).replace("@",""))+"&limit="+e,function(t){if($(".aw-invite-dropdown")[0])if(0!=t.length){var e="";$(".aw-invite-dropdown").html(""),$.each(t,function(t,a){e+='<li><img src="'+a.detail.avatar_file+'"/><a>'+a.name+"</a></li>"}),$(".aw-invite-dropdown").append(e),i(),$(".aw-invite-dropdown li").click(function(){o.val(o.val().substring(0,d)+"@"+$(this).find("a").html()+" ").focus(),$(".aw-invite-dropdown").detach()})}else $(".aw-invite-dropdown").hide();0==o.val().length&&$(".aw-invite-dropdown").hide()},"json")}}}}),$(t).keydown(function(t){var e=t.which;return!$(".aw-invite-dropdown").is(":visible")||38!=e&&40!=e&&13!=e?void 0:!1})},shake:function(t){var e=6;t.css("position","relative");for(var a=1;e>=a;a++)a%2==0?a==e?t.animate({left:0},50):t.animate({left:10},50):t.animate({left:-10},50)}};NKR.G={cashUserData:[],cashTopicData:[],card_box_hide_timer:"",card_box_show_timer:"",dropdown_list_xhr:"",loading_timer:"",loading_bg_count:12,loading_mini_bg_count:9,notification_timer:"",user_quiz_message_timer:""},NKR.User={follow:function(t,e,a){if(G_USER_ID<=0)return void(window.location=G_BASE_URL+"/account/login/");switch(t.addClass("disabled"),e){case"question":var i="/question/ajax/focus/",n={
question_id:a};break;case"topic":var i="/topic/ajax/focus_topic/",n={topic_id:a};break;case"user":var i="/follow/ajax/follow_people/",n={uid:a}}$.post(G_BASE_URL+i,n,function(e){1==e.errno?"add"==e.rsm.type?t.addClass("following"):t.removeClass("following"):(e.err&&NKR.alert(e.err),e.rsm.url&&(window.location=decodeURIComponent(e.rsm.url))),t.removeClass("disabled"),t.html()?t.hasClass("following")?t.text("已关注"):t.text("+ 关注"):t.hasClass("following")?t.attr("data-original-title","正在关注"):t.attr("data-original-title","添加关注")},"json")},share_out:function(t){var e=e||window.location.href;if(t.title)var a=t.title+" - "+G_SITE_NAME;else var a=$("title").text();shareURL="http://www.jiathis.com/send/?webid="+t.webid+"&url="+e+"&title="+a,t.content&&$(t.content).find("img").length&&(shareURL=shareURL+"&pic="+$(t.content).find("img").eq(0).attr("src")),window.open(shareURL)},delete_draft:function(t,e){"clean"==e?$.post(G_BASE_URL+"/account/ajax/delete_draft/","type="+e,function(t){1!=t.errno&&NKR.alert(t.err)},"json"):$.post(G_BASE_URL+"/account/ajax/delete_draft/","item_id="+t+"&type="+e,function(t){1!=t.errno&&NKR.alert(t.err)},"json")},agree_vote:function(t,e,a){var i=$(t);$.post(G_BASE_URL+"/question/ajax/answer_vote/","answer_id="+a+"&value=1");var n=i.find(".count"),o=i.find("span"),s=i.attr("data-agreed"),r=parseInt(n.html());s>0?(r>0&&n.html(r-1),o.html("赞同"),i.removeClass("active"),i.attr("data-agreed",0)):(n.html(r+1),o.html("已赞同"),i.addClass("active"),i.attr("data-agreed",1))},disagree_vote:function(t,e,a){$.post(G_BASE_URL+"/question/ajax/answer_vote/","answer_id="+a+"&value=-1",function(t){}),$(t).hasClass("active")?$(t).removeClass("active"):$(t).parents(".operate").find(".agree").hasClass("active")?($.each($(t).parents(".aw-item").find(".aw-user-name"),function(t,a){$(a).html()==e&&($(a).prev()?$(a).prev().remove():$(a).next().remove(),$(a).remove())}),0==$(t).parents(".aw-item").find(".aw-agree-by a").length&&$(t).parents(".aw-item").find(".aw-agree-by").hide(),$(t).parents(".operate").find(".count").html(parseInt($(t).parents(".operate").find(".count").html())-1),$(t).parents(".operate").find(".agree").removeClass("active"),$(t).addClass("active")):$(t).addClass("active")},question_uninterested:function(t,e){t.fadeOut(),$.post(G_BASE_URL+"/question/ajax/uninterested/","question_id="+e,function(t){"1"!=t.errno&&NKR.alert(t.err)},"json")},answer_force_fold:function(t,e){$.post(G_BASE_URL+"/question/ajax/answer_force_fold/","answer_id="+e,function(e){1!=e.errno?NKR.alert(e.err):1==e.errno&&("fold"==e.rsm.action?t.html(t.html().replace(_t("折叠"),_t("撤消折叠"))):t.html(t.html().replace(_t("撤消折叠"),_t("折叠"))))},"json")},question_invite_delete:function(t,e){$.post(G_BASE_URL+"/question/ajax/question_invite_delete/","question_invite_id="+e,function(e){1==e.errno?t.fadeOut():NKR.alert(e.rsm.err)},"json")},invite_user:function(t,e){return G_USER_ID<=0?void(window.location=G_BASE_URL+"/account/login/"):void $.post(G_BASE_URL+"/question/ajax/save_invite/",{question_id:QUESTION_ID,uid:t.attr("data-id")},function(a){-1!=a.errno?(0==t.parents(".aw-invite-box").find(".invite-list a").length&&t.parents(".aw-invite-box").find(".invite-list").show(),t.parents(".aw-invite-box").find(".invite-list").append(' <a class="text-color-999 invite-list-user" data-toggle="tooltip" data-placement="bottom" data-original-title="'+t.attr("data-value")+'"><img src='+e+" /></a>"),t.addClass("active").attr("onclick","NKR.User.disinvite_user($(this))").text("取消邀请"),t.parents(".aw-question-detail").find(".aw-invite-replay .badge").text(parseInt(t.parents(".aw-question-detail").find(".aw-invite-replay .badge").text())+1)):-1==a.errno&&NKR.alert(a.err)},"json")},disinvite_user:function(t){$.get(G_BASE_URL+"/question/ajax/cancel_question_invite/question_id-"+QUESTION_ID+"__recipients_uid-"+t.attr("data-id"),function(e){-1!=e.errno&&($.each($(".aw-question-detail .invite-list a"),function(e,a){$(this).attr("data-original-title")==t.parents(".main").find(".aw-user-name").text()&&$(this).detach()}),t.removeClass("active").attr("onclick","NKR.User.invite_user($(this),$(this).parents('li').find('img').attr('src'))").text("邀请"),t.parents(".aw-question-detail").find(".aw-invite-replay .badge").text(parseInt(t.parents(".aw-question-detail").find(".aw-invite-replay .badge").text())-1),0==t.parents(".aw-invite-box").find(".invite-list").children().length&&t.parents(".aw-invite-box").find(".invite-list").hide())})},question_thanks:function(t,e){$.post(G_BASE_URL+"/question/ajax/question_thanks/","question_id="+e,function(e){1!=e.errno?NKR.alert(e.err):"add"==e.rsm.action?(t.html(t.html().replace(_t("感谢"),_t("已感谢"))),t.removeAttr("onclick")):t.html(t.html().replace(_t("已感谢"),_t("感谢")))},"json")},answer_user_rate:function(t,e,a){$.post(G_BASE_URL+"/question/ajax/question_answer_rate/","type="+e+"&answer_id="+a,function(a){if(1!=a.errno)NKR.alert(a.err);else if(1==a.errno)switch(e){case"thanks":"add"==a.rsm.action?(t.html(t.html().replace(_t("感谢"),_t("已感谢"))),t.removeAttr("onclick")):t.html(t.html().replace(_t("已感谢"),_t("感谢")));break;case"uninterested":"add"==a.rsm.action?t.html(t.html().replace(_t("没有帮助"),_t("撤消没有帮助"))):t.html(t.html().replace(_t("撤消没有帮助"),_t("没有帮助")))}},"json")},remove_answer:function(t,e){$.get(G_BASE_URL+"/question/ajax/remove_answer/answer_id-"+e),t.parents("li.comment-item[id=comment-id-"+e+"]").fadeOut()},save_comment:function(t){t.addClass("disabled"),NKR.ajax_post(t.parents("form"),NKR.ajax_processer,"comments_form")},remove_comment:function(t,e,a){$.get(G_BASE_URL+"/question/ajax/remove_comment/type-"+e+"__comment_id-"+a),t.parents("li.sub-comment-item").fadeOut()},article_vote:function(t,e,a){if(G_USER_ID<=0)return void(window.location=G_BASE_URL+"/account/login/");if(NKR.loading("show"),t.hasClass("active"))var a=0;$.post(G_BASE_URL+"/article/ajax/article_vote/","type=article&item_id="+e+"&rating="+a,function(e){NKR.loading("hide"),1!=e.errno?NKR.alert(e.err):0==a?t.removeClass("active").find("b").html(parseInt(t.find("b").html())-1):-1==a?(t.parents(".aw-article-vote").find(".agree").hasClass("active")&&(t.parents(".aw-article-vote").find("b").html(parseInt(t.parents(".aw-article-vote").find("b").html())-1),t.parents(".aw-article-vote").find("a").removeClass("active")),t.addClass("active")):(t.parents(".aw-article-vote").find("a").removeClass("active"),t.addClass("active").find("b").html(parseInt(t.find("b").html())+1))},"json")},article_comment_vote:function(t,e,a){if(G_USER_ID<=0)return void(window.location=G_BASE_URL+"/account/login/");NKR.loading("show");var i=t.find("span");if(t.hasClass("active"))var a=0;$.post(G_BASE_URL+"/article/ajax/article_vote/","type=comment&item_id="+e+"&rating="+a,function(e){NKR.loading("hide"),1!=e.errno?NKR.alert(e.err):0==a?(t.attr("data-original-title","赞同").removeClass("active").find("b").html(parseInt(t.find("b").html())-1),i.html("赞同")):(t.attr("data-original-title","取消赞同").addClass("active").find("b").html(parseInt(t.find("b").html())+1),i.html("已赞同"))},"json")},add_favorite_tag:function(){$.post(G_BASE_URL+"/favorite/ajax/update_favorite_tag/",{item_id:$('#favorite_form input[name="item_id"]').val(),item_type:$('#favorite_form input[name="item_type"]').val(),tags:$("#favorite_form .add-input").val()},function(t){-1==t.errno?NKR.alert(t.err):1==t.errno&&($(".aw-favorite-box .aw-favorite-tag-list").show(),$(".aw-favorite-box .aw-favorite-tag-add").hide(),$(".aw-favorite-tag-list ul").prepend('<li class="active"><a data-value="'+$("#favorite_form .add-input").val()+'"><i class="md md-check"></i><span class="title">'+$("#favorite_form .add-input").val()+"</span></a></li>"))},"json")},update_signature:function(){if(G_USER_ID<0)return void window.location.reload();var t=$("#user-signature-input").val();$.post(G_BASE_URL+"/account/ajax/update_signature/",{signature:t},function(e){-1==e.errno?NKR.alert(e.err):1==e.errno&&($(".user-signature span.signature").html(t),$(".dropdown.pmop-message.user-signature-dialog").removeClass("open"))},"json")}},NKR.Dropdown={bind_dropdown_list:function(t,e){"search"==e&&$(t).focus(function(){$(t).closest(".dropdown").addClass("open")}),$(t).keyup(function(a){if($(t).closest(".dropdown").addClass("open"),"search"==e&&$(t).parent().find(".search").show().children("a").text($(t).val()),$(t).val().length>=1?38!=a.which&&40!=a.which&&188!=a.which&&13!=a.which&&NKR.Dropdown.get_dropdown_list($(this),e,$(t).val()):$(t).closest(".dropdown").removeClass("open"),"topic"==e){if(188==a.which)return","!=$(".aw-edit-topic-box #aw_edit_topic_title").val()&&($(".aw-edit-topic-box #aw_edit_topic_title").val($(".aw-edit-topic-box #aw_edit_topic_title").val().substring(0,$(".aw-edit-topic-box #aw_edit_topic_title").val().length-1)),$(".aw-edit-topic-box .aw-dropdown").hide(),$(".aw-edit-topic-box .add").click()),!1;if(13==a.which)return $(".aw-edit-topic-box .aw-dropdown").hide(),$(".aw-edit-topic-box .add").click(),!1;var i=$(t).parent().find(".aw-dropdown-list li");if(40==a.which&&i.is(":visible")){var n;i.hasClass("active")?($.each(i,function(t,e){$(this).hasClass("active")&&($(this).removeClass("active"),n=$(this).index()==i.length-1?0:$(this).index()+1)}),i.eq(n).addClass("active"),$(t).val(i.eq(n).text())):i.eq(0).addClass("active")}if(38==a.which&&i.is(":visible")){var n;i.hasClass("active")?($.each(i,function(t,e){$(this).hasClass("active")&&($(this).removeClass("active"),n=0==$(this).index()?i.length-1:$(this).index()-1)}),i.eq(n).addClass("active"),$(t).val(i.eq(n).text())):i.eq(i.length-1).addClass("active")}}}),$(t).blur(function(){})},set_dropdown_list:function(t,e,a){$(t).append(Hogan.compile(AW_TEMPLATE.dropdownList).render({items:e})),$(t+" .aw-dropdown-list li a").click(function(){$("#aw-topic-tags-select").html($(this).text())}),a&&$(t+" .dropdown-menu li a[data-value='"+a+"']").click()},get_dropdown_list:function(t,e,a){""!=NKR.G.dropdown_list_xhr&&NKR.G.dropdown_list_xhr.abort();var i,n="没有找到相关结果";switch(e){case"search":i=G_BASE_URL+"/search/ajax/search/?q="+encodeURIComponent(a)+"&limit=5";break;case"publish":i=G_BASE_URL+"/search/ajax/search/?type=questions&q="+encodeURIComponent(a)+"&limit=5";break;case"redirect":i=G_BASE_URL+"/search/ajax/search/?q="+encodeURIComponent(a)+"&type=questions&limit=30&is_question_id=1";break;case"invite":i=G_BASE_URL+"/search/ajax/search/?type=users&q="+encodeURIComponent(a)+"&limit=10",n="没有找到你想邀请的人";break;case"inbox":i=G_BASE_URL+"/search/ajax/search/?type=users&q="+encodeURIComponent(a)+"&limit=10",n="没有找到相关的人";break;case"topic_question":i=G_BASE_URL+"/search/ajax/search/?type=questions,articles&q="+encodeURIComponent(a)+"&topic_ids="+CONTENTS_RELATED_TOPIC_IDS+"&limit=50";break;case"topic":i=G_BASE_URL+"/search/ajax/search/?type=topics&q="+encodeURIComponent(a)+"&limit=10";break;case"questions":i=G_BASE_URL+"/search/ajax/search/?type=questions&q="+encodeURIComponent(a)+"&limit=10";break;case"articles":i=G_BASE_URL+"/search/ajax/search/?type=articles&q="+encodeURIComponent(a)+"&limit=10"}NKR.G.dropdown_list_xhr=$.get(i,function(i){if(0!=i.length&&void 0!=NKR.G.dropdown_list_xhr){switch($(t).parent().find(".aw-dropdown-list").html(""),e){case"search":$.each(i,function(e,a){switch(a.type){case"questions":if(a.detail.best_answer>0)var i="active";else var i="";$(t).parent().find(".aw-dropdown-list").append(Hogan.compile(AW_TEMPLATE.searchDropdownListQuestions).render({url:a.url,active:i,content:a.name,discuss_count:a.detail.answer_count}));break;case"articles":$(t).parent().find(".aw-dropdown-list").append(Hogan.compile(AW_TEMPLATE.searchDropdownListArticles).render({url:a.url,content:a.name,comments:a.detail.comments}));break;case"topics":$(t).parent().find(".aw-dropdown-list").append(Hogan.compile(AW_TEMPLATE.searchDropdownListTopics).render({url:a.url,name:a.name,focus_count:a.detail.focus_count,topic_id:a.detail.topic_id}));break;case"users":var n=a.detail.signature;$(t).parent().find(".aw-dropdown-list").append(Hogan.compile(AW_TEMPLATE.searchDropdownListUsers).render({url:a.url,img:a.detail.avatar_file,name:a.name,intro:n}))}});break;case"publish":case"topic_question":$.each(i,function(e,a){$(t).parent().find(".aw-dropdown-list").append(Hogan.compile(AW_TEMPLATE.questionDropdownList).render({url:a.url,name:a.name}))});break;case"topic":$.each(i,function(e,a){$(t).parent().find(".aw-dropdown-list").append(Hogan.compile(AW_TEMPLATE.editTopicDorpdownList).render({name:a.name}))});break;case"redirect":$.each(i,function(e,a){$(t).parent().find(".aw-dropdown-list").append(Hogan.compile(AW_TEMPLATE.questionRedirectList).render({url:"'"+G_BASE_URL+"/question/ajax/redirect/', 'item_id="+$(t).attr("data-id")+"&target_id="+a.search_id+"'",name:a.name}))});break;case"questions":case"articles":$.each(i,function(e,a){$(t).parent().find(".aw-dropdown-list").append(Hogan.compile(AW_TEMPLATE.questionDropdownList).render({url:"#",name:a.name}))});break;case"inbox":$.each(i,function(e,a){var i=a.detail.signature;$(t).parent().find(".aw-dropdown-list").append(Hogan.compile(AW_TEMPLATE.inboxDropdownList).render({uid:a.uid,name:a.name,img:a.detail.avatar_file,intro:i}))});break;case"invite":$.each(i,function(e,a){var i=a.detail.signature;$(t).parent().find(".aw-dropdown-list").append(Hogan.compile(AW_TEMPLATE.inviteDropdownList).render({uid:a.uid,name:a.name,img:a.detail.avatar_file,intro:i,url:a.url}))})}"publish"==e?$(t).parent().find(".aw-publish-suggest-question, .aw-publish-suggest-question .aw-dropdown-list").show():($(t).parent().find(".aw-dropdown, .aw-dropdown-list").show().children().show(),$(t).parent().find(".title").hide(),$(t).parent().find(".aw-dropdown-list li.question a").highText(a,"b","active"))}else $(t).parent().find(".aw-dropdown").show().end().find(".title").html(n).show(),$(t).parent().find(".aw-dropdown-list, .aw-publish-suggest-question").hide()},"json")}},NKR.Notifcation={load:function(){G_USER_ID>0&&$("#header-notifications").length&&$.get(G_BASE_URL+"/notifications/ajax/header_list/flag-0__limit-5",function(t){t.length?$("#header-notifications").html(t):$("#header-notifications").html('<p class="no-notification">没有未读消息</p>')})},check_notifications:function(){return 0==G_USER_ID?(clearInterval(NKR.G.notification_timer),!1):void $.get(G_BASE_URL+"/home/ajax/notifications/",function(t){$("#inbox_unread").html(Number(t.rsm.inbox_num)),$("#inbox_unread_mobile").html(Number(t.rsm.inbox_num));var e=G_UNREAD_NOTIFICATION;if(G_UNREAD_NOTIFICATION=Number(t.rsm.notifications_num),G_UNREAD_NOTIFICATION>0){G_UNREAD_NOTIFICATION!=e&&(NKR.Message.load_notification_list(),$("#notifications_unread").html(G_UNREAD_NOTIFICATION),$("#notifications_unread_mobile").html(G_UNREAD_NOTIFICATION));var a=Number(t.rsm.notifications_num)+Number(t.rsm.inbox_num);document.title="("+a+") "+document_title,$("#notifications_unread").show(),$("#notifications_unread_mobile").show()}else $("#header_notification_list").length&&$("#header_notification_list").html(""),$("#index_notification").length&&$("#index_notification").fadeOut(),document.title=document_title,$("#notifications_unread").hide(),$("#notifications_unread_mobile").hide();Number(t.rsm.inbox_num)>0?($("#inbox_unread").removeClass("hide"),$("#inbox_unread_mobile").removeClass("hide")):($("#inbox_unread").addClass("hide"),$("#inbox_unread_mobile").addClass("hide"))},"json")},read_notification:function(t,e,a){if(e){t.remove();var i=G_BASE_URL+"/notifications/ajax/read_notification/notification_id-"+e}else{$("#index_notification").length&&$("#index_notification").fadeOut();var i=G_BASE_URL+"/notifications/ajax/read_notification/"}$.get(i,function(t){NKR.Message.check_notifications(),a&&window.location.reload()})},notification_show:function(t){$("#index_notification").length>0&&(0==$("#index_notification ul#notification_list li").length?$("#index_notification").fadeOut():$("#index_notification ul#notification_list li").each(function(e,a){t>e?$(a).show():$(a).hide()}))}},NKR.Init={init_comment_box:function(t){$(document).on("click",t,function(){if($(this).parents(".aw-question-detail").find(".aw-invite-box, .aw-question-related-box").hide(),"undefined"!=typeof COMMENT_UNFOLD&&"all"==COMMENT_UNFOLD&&0==$(this).attr("data-comment-count")&&"hide"==$(this).attr("data-first-click"))return $(this).removeAttr("data-first-click"),!1;if(!$(this).attr("data-type")||!$(this).attr("data-id"))return!0;var t="#aw-comment-box-"+$(this).attr("data-type")+"-"+$(this).attr("data-id");if($(t).length)"none"==$(t).css("display")?($(this).addClass("active"),$(t).fadeIn()):($(this).removeClass("active"),$(t).fadeOut());else{switch($(this).attr("data-type")){case"question":var e=G_BASE_URL+"/question/ajax/save_question_comment/question_id-"+$(this).attr("data-id"),a=G_BASE_URL+"/question/ajax/get_question_comments/question_id-"+$(this).attr("data-id");break;case"answer":var e=G_BASE_URL+"/question/ajax/save_answer_comment/answer_id-"+$(this).attr("data-id"),a=G_BASE_URL+"/question/ajax/get_answer_comments/answer_id-"+$(this).attr("data-id")}G_USER_ID?($(this).parents(".aw-item").find(".mod-footer").append(Hogan.compile(AW_TEMPLATE.commentBox).render({comment_form_id:t.replace("#",""),comment_form_action:e})),$(t).find(".aw-comment-txt").bind({focus:function(){$(t).find(".aw-comment-box-btn").show()},blur:function(){""==$(this).val()&&$(t).find(".aw-comment-box-btn").hide()}}),$(t).find(".close-comment-box").click(function(){$(t).fadeOut(),$(t).find(".aw-comment-txt").css("height",$(this).css("line-height"))})):$(this).parents(".aw-item").find(".mod-footer").append(Hogan.compile(AW_TEMPLATE.commentBoxClose).render({comment_form_id:t.replace("#",""),comment_form_action:e})),$.get(a,function(e){""==$.trim(e)&&(e='<div align="center" class="aw-padding10">'+_t("暂无评论")+"</div>"),$(t).find(".aw-comment-list").html(e)}),$(t).find(".aw-comment-txt").autosize(),$(this).addClass("active"),NKR.at_user_lists(t+" .aw-comment-txt",5)}NKR.at_user_lists($(this).parents(".aw-item").find(".aw-comment-txt"))})},init_article_comment_box:function(t){$(document).on("click",t,function(){var t=$(this).closest(".comment-item").find(".article-reply-comment-box");t.length?"block"==t.css("display")?t.fadeOut():t.fadeIn():$(this).closest(".comment-item").find(".media-body").append(Hogan.compile(AW_TEMPLATE.articleCommentBox).render({at_uid:$(this).attr("data-id"),article_id:ARTICLE_ID}))})},init_topic_edit_box:function(t){$(t).click(function(){var t=$(this).parents(".aw-topic-bar"),e=t.attr("data-id"),a=t.attr("data-type");t.hasClass("active")?t.addClass("active"):(t.addClass("active"),t.find(".topic-tag .close").length||t.find(".topic-tag").append('<a class="close"><i class="icon icon-delete"></i></a>')),0==t.find(".aw-edit-topic-box").length&&(t.append(AW_TEMPLATE.editTopicBox),t.find(".add").click(function(){if(""!=t.find("#aw_edit_topic_title").val())switch(a){case"publish":t.find(".tag-bar").prepend('<span class="topic-tag"><a class="text">'+t.find("#aw_edit_topic_title").val()+'</a><a class="close" onclick="$(this).parents(\'.topic-tag\').remove();"><i class="icon icon-delete"></i></a><input type="hidden" value="'+t.find("#aw_edit_topic_title").val()+'" name="topics[]" /></span>').hide().fadeIn(),t.find("#aw_edit_topic_title").val("");break;case"question":$.post(G_BASE_URL+"/topic/ajax/save_topic_relation/","type=question&item_id="+e+"&topic_title="+encodeURIComponent(t.find("#aw_edit_topic_title").val()),function(e){return 1!=e.errno?(NKR.alert(e.err),!1):(t.find(".tag-bar").prepend('<span class="topic-tag" data-id="'+e.rsm.topic_id+'"><a href="'+G_BASE_URL+"/topic/"+e.rsm.topic_id+'" class="text">'+t.find("#aw_edit_topic_title").val()+'</a><a class="close"><i class="icon icon-delete"></i></a></span>').hide().fadeIn(),void t.find("#aw_edit_topic_title").val(""))},"json");break;case"article":$.post(G_BASE_URL+"/topic/ajax/save_topic_relation/","type=article&item_id="+e+"&topic_title="+encodeURIComponent(t.find("#aw_edit_topic_title").val()),function(e){return 1!=e.errno?(NKR.alert(e.err),!1):(t.find(".tag-bar").prepend('<span class="topic-tag" data-id="'+e.rsm.topic_id+'"><a href="'+G_BASE_URL+"/topic/"+e.rsm.topic_id+'" class="text">'+t.find("#aw_edit_topic_title").val()+'</a><a class="close"><i class="icon icon-delete"></i></a></span>').hide().fadeIn(),void t.find("#aw_edit_topic_title").val(""))},"json");break;case"topic":$.post(G_BASE_URL+"/topic/ajax/save_related_topic/topic_id-"+e,"topic_title="+encodeURIComponent(t.find("#aw_edit_topic_title").val()),function(e){return 1!=e.errno?(NKR.alert(e.err),!1):(t.find(".tag-bar").prepend('<span class="topic-tag"><a href="'+G_BASE_URL+"/favorite/tag-"+encodeURIComponent(t.find("#aw_edit_topic_title").val())+'" class="text">'+t.find("#aw_edit_topic_title").val()+'</a><a class="close"><i class="icon icon-delete"></i></a></span>').hide().fadeIn(),void t.find("#aw_edit_topic_title").val(""))},"json");break;case"favorite":$.post(G_BASE_URL+"/favorite/ajax/update_favorite_tag/","item_id="+e+"&item_type="+t.attr("data-item-type")+"&tags="+encodeURIComponent(t.find("#aw_edit_topic_title").val()),function(e){return 1!=e.errno?(NKR.alert(e.err),!1):(t.find(".tag-bar").prepend('<span class="topic-tag"><a href="'+G_BASE_URL+"/favorite/tag-"+encodeURIComponent(t.find("#aw_edit_topic_title").val())+'" class="text">'+t.find("#aw_edit_topic_title").val()+'</a><a class="close"><i class="icon icon-delete"></i></a></span>').hide().fadeIn(),void t.find("#aw_edit_topic_title").val(""))},"json")}}),t.find(".close-edit").click(function(){t.removeClass("active"),t.find(".aw-edit-topic-box").hide(),t.find(".aw-edit-topic").show()}),NKR.Dropdown.bind_dropdown_list($(this).parents(".aw-topic-bar").find("#aw_edit_topic_title"),"topic")),$(this).parents(".aw-topic-bar").find(".aw-edit-topic-box").fadeIn(),G_CAN_CREATE_TOPIC||$(this).parents(".aw-topic-bar").find(".add").hide(),$(this).hide()})}},function(t){t.fn.extend({insertAtCaret:function(e){var a=t(this).get(0);if(document.all&&a.createTextRange&&a.caretPos){var i=a.caretPos;i.text=""==i.text.charAt(i.text.length-1)?e+"":e}else if(a.setSelectionRange){var n=a.selectionStart,o=a.selectionEnd,s=a.value.substring(0,n),r=a.value.substring(o);a.value=s+e+r,a.focus();var c=e.length;a.setSelectionRange(n+c,n+c),a.blur()}else a.value+=e},highText:function(e,a,i){return this.each(function(){t(this).html(function(e,a,i,n){var o=a.replace(/\b(\w+)\b/g,"($1)").replace(/\s+/g,"|");return e.replace(new RegExp(o,"ig"),function(e){return t("<"+i+" class="+n+">"+e+"</"+i+">").outerHTML()})}(t(this).text(),e,a,i))})},outerHTML:function(t){return t?this.before(t).remove():jQuery("<p>").append(this.eq(0).clone()).html()}}),t.extend({scrollTo:function(e,a,i){if("object"==typeof e)var e=t(e).offset().top;t("html, body").animate({scrollTop:e},{duration:a,queue:i.queue})}})}(jQuery),$(document).ready(function(){var t=$("#question-select");0!=t.length&&t.affix({offset:{top:t.offset().top}})});