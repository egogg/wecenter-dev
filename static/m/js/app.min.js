function _t(e,t){return"undefined"!=typeof aws_lang&&"undefined"!=typeof aws_lang[e]&&(e=aws_lang[e]),t&&(e=e.replace("%s",t)),e}$(document).ready(function(){if(G_USER_INVALID_EMAIL.length){var e="你的邮箱 <strong>"+G_USER_INVALID_EMAIL+'</strong> 还未验证, 如果没有收到邮件<a class="alert-link" onclick="NKR.ajax_request(G_BASE_URL + \'/account/ajax/send_valid_mail/\');"> 点击重新发送</a>';NKR.notify(e,"warning",!1,"bottom",0,0,"up")}G_SITE_ANNOUNCE_CLOSE!=$.cookie("announce_close")&&$("#site-announce").show(),NKR.Notifcation.load(),$("body").on("click","[data-ma-action]",function(e){e.preventDefault();var t=$(this),a=$(this).data("ma-action");switch(a){case"sidebar-open":var i=t.data("ma-target"),n='<div data-ma-action="sidebar-close" class="ma-backdrop" />';$("body").addClass("sidebar-toggled"),$("#header, #header-alt, #main").append(n),t.addClass("toggled"),$(i).addClass("toggled");break;case"sidebar-close":$("body").removeClass("sidebar-toggled"),$(".ma-backdrop").remove(),$(".sidebar, .ma-trigger").removeClass("toggled");break;case"submenu-toggle":t.next().slideToggle(200),t.parent().toggleClass("toggled");break;case"search-open":$("#header").addClass("search-toggled"),$("#top-search-wrap input").focus();break;case"search-close":$("#header").removeClass("search-toggled");break;case"check-all-notifications":var o=t.closest(".list-group"),s=o.find(".list-group-item"),r=s.size();t.parent().fadeOut(),o.find(".list-group").prepend('<i class="grid-loading hide-it"></i>'),o.find(".grid-loading").fadeIn(1500);var c=0;s.each(function(){var e=$(this);setTimeout(function(){e.addClass("animated fadeOutRightBig").delay(1e3).queue(function(){e.remove()})},c+=150)}),setTimeout(function(){$(".him-notification").addClass("empty").find(".lg-body").html('<p class="no-notification">没有未读消息</p>')},150*r+200);break;case"action-header-open":ahParent=t.closest(".action-header").find(".ah-search"),ahParent.fadeIn(300),ahParent.find(".ahs-input").focus();break;case"action-header-close":ahParent.fadeOut(300),setTimeout(function(){ahParent.find(".ahs-input").val("")},350)}})}),$(document).ready(function(){$(".dropdown")[0]&&($("body").on("click",".dropdown.open .dropdown-menu",function(e){e.stopPropagation()}),$(".dropdown").on("shown.bs.dropdown",function(e){$(this).attr("data-animation")&&($animArray=[],$animation=$(this).data("animation"),$animArray=$animation.split(","),$animationIn="animated "+$animArray[0],$animationOut="animated "+$animArray[1],$animationDuration="",$animArray[2]?$animationDuration=$animArray[2]:$animationDuration=500,$(this).find(".dropdown-menu").removeClass($animationOut),$(this).find(".dropdown-menu").addClass($animationIn))}),$(".dropdown").on("hide.bs.dropdown",function(e){$(this).attr("data-animation")&&(e.preventDefault(),$this=$(this),$dropdownMenu=$this.find(".dropdown-menu"),$dropdownMenu.addClass($animationOut),setTimeout(function(){$this.removeClass("open")},$animationDuration))})),$(".collapse")[0]&&($(".collapse").on("show.bs.collapse",function(e){$(this).closest(".panel").find(".panel-heading").addClass("active")}),$(".collapse").on("hide.bs.collapse",function(e){$(this).closest(".panel").find(".panel-heading").removeClass("active")}),$(".collapse.in").each(function(){$(this).closest(".panel").find(".panel-heading").addClass("active")})),$(".fg-line")[0]&&($("body").on("focus",".fg-line .form-control",function(){$(this).closest(".fg-line").addClass("fg-toggled")}),$("body").on("blur",".form-control",function(){var e=$(this).closest(".form-group, .input-group"),t=e.find(".form-control").val();e.hasClass("fg-float")?0==t.length&&$(this).closest(".fg-line").removeClass("fg-toggled"):$(this).closest(".fg-line").removeClass("fg-toggled")})),$(".fg-float")[0]&&$(".fg-float .form-control").each(function(){var e=$(this).val();0==!e.length&&$(this).closest(".fg-line").addClass("fg-toggled")}),$("html").hasClass("ie9")&&$("input, textarea").placeholder({customClass:"ie9-placeholder"})}),$(document).ready(function(){new Swiper(".swiper-container",{pagination:".swiper-pagination",paginationClickable:!0,loop:!0})}),$(document).ready(function(){function e(e,t){t&&(e.removeClass("disabled").addClass("end").unbind("click").attr("href",G_BASE_URL+"/question/"),e.html("更多精彩答题，进入题库"))}NKR.load_list_view(G_BASE_URL+"/explore/ajax/load_question_list/",$("#ql-load-more"),$("#question-list"),2,e)}),$(document).ready(function(){$("#login_form input").keydown(function(e){return 13==e.keyCode?($("#login_submit").click(),!1):void 0})}),$(document).ready(function(){$("#captcha").attr("src",G_BASE_URL+"/account/captcha/")}),$(document).ready(function(){function e(e){return e.length>=2&&e.length<=16}function t(e){var t=/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/;return t.test(e)}function a(e){return e.length>=6&&e.length<=17}function i(){return e($("#register_form input[name=user_name]").val())&&t($("#register_form input[name=email]").val())&&a($("#register_form input[name=password]").val())}function n(){return e($("#register_form input[name=user_name]").val())&&t($("#register_form input[name=email]").val())}function o(i){$(i).find("[type=text], [type=password]").on({focus:function(){var e=$(this),t=e.parent(),a=e.attr("tips");t.find(".help-block").detach(),t.find(".form-control-feedback").detach(),t.removeClass("has-error").removeClass("has-success").removeClass("has-feedback"),"undefined"!=typeof a&&""!=a&&t.append('<small class="help-block">'+e.attr("tips")+"</small>")},blur:function(){function i(){var e=o.find(".help-block"),t=o.find(".form-control-feedback");e.detach(),t.detach(),o.removeClass("has-error").removeClass("has-warning").removeClass("has-success").removeClass("has-feedback"),c?(o.addClass("has-feedback"),o.append('<span class="icon icon-check form-control-feedback"></span>')):"undefined"!=typeof r&&""!=r&&(o.addClass("has-error"),o.append('<small class="help-block">'+r+"</small>"))}var n=$(this),o=n.parent(),s=n.val(),r=n.attr("errortips"),c=!1;switch(n.attr("name")){case"user_name":c=e(s),c&&$.get(G_BASE_URL+"/account/ajax/check_username/username-"+encodeURIComponent(s),function(e){-1==e.errno&&(c=!1,r=e.err,i())},"json");break;case"email":c=t(s),c&&$.get(G_BASE_URL+"/account/ajax/check_email/email-"+encodeURIComponent(s),function(e){-1==e.errno&&(c=!1,r=e.err,i())},"json");break;case"password":c=a(s);break;default:r=""}i()}})}o("#register_form"),$("#submit-form").on("click",function(e){e.preventDefault(),i()&&NKR.ajax_post($("#register_form"),NKR.ajax_processer,"error_message")}),$("#sns-register-submit").on("click",function(e){e.preventDefault(),n()&&NKR.ajax_post($("#register_form"),NKR.ajax_processer,"error_message")})}),$(document).ready(function(){$(".change-email").on("click",function(e){e.preventDefault(),$(".lcb-resend-email").hide(),$(".lcb-change-email").show()})});var NKR={notify:function(e,t,a,i,n,o,s){var r="animated fadeInDown";switch(s){case"down":r="animated fadeInDown";break;case"up":r="animated fadeInUp";break;case"left":r="animated fadeInLeft";break;case"right":r="animated fadeInRight"}$.notify({icon:"",title:"",message:e},{element:"body",type:t,allow_dismiss:a,placement:{from:i,align:"center"},offset:{x:n,y:o},spacing:10,z_index:9999,delay:2500,timer:1e3,mouse_over:!1,newest_on_top:!0,animate:{enter:r,exit:"animated fadeOutDown"},icon_type:"class",template:'<div data-notify="container" class="alert alert-{0}" role="alert"><button type="button" class="close c-white" data-notify="dismiss"><span aria-hidden="true">&times;</span><span class="sr-only">close</span></button><span data-notify="icon" class="c-white"></span> <span data-notify="title">{1}</span><span data-notify="message" class="c-white">{2}</span></div>'})},loading:function(e){if(!$("#aw-loading").length,"show"==e){if("block"==$("#aw-loading").css("display"))return!1;$("#aw-loading").fadeIn(),NKR.G.loading_timer=setInterval(function(){NKR.G.loading_bg_count-=1,$("#aw-loading-box").css("background-position","0px "+40*NKR.G.loading_bg_count+"px"),1==NKR.G.loading_bg_count&&(NKR.G.loading_bg_count=12)},100)}else $("#aw-loading").fadeOut(),clearInterval(NKR.G.loading_timer)},loading_mini:function(e,t){!e.find("#aw-loading-mini-box").length,"show"==t?(e.find("#aw-loading-mini-box").fadeIn(),NKR.G.loading_timer=setInterval(function(){NKR.G.loading_mini_bg_count-=1,$("#aw-loading-mini-box").css("background-position","0px "+16*NKR.G.loading_mini_bg_count+"px"),1==NKR.G.loading_mini_bg_count&&(NKR.G.loading_mini_bg_count=9)},100)):(e.find("#aw-loading-mini-box").fadeOut(),clearInterval(NKR.G.loading_timer))},ajax_error_msg:function(e){NKR.notify(e,"danger",!0,"top",0,0,"down")},ajax_request:function(e,t){function a(e){return NKR.loading("hide"),e?void(-1==e.errno?NKR.alert(e.err):0==e.errno?NKR.alert(e.err,"success"):e.rsm&&e.rsm.url?window.location=decodeURIComponent(e.rsm.url):1==e.errno&&window.location.reload()):!1}function i(e){NKR.loading("hide"),""!=$.trim(e.responseText)&&alert(_t("发生错误, 返回的信息:")+" "+e.responseText)}return NKR.loading("show"),t?$.post(e,t+"&_post_type=ajax",function(e){a(e)},"json").error(function(e){i(e)}):$.get(e,function(e){a(e)},"json").error(function(e){i(e)}),!1},ajax_post:function(e,t,a){if("undefined"!=typeof CKEDITOR)for(instance in CKEDITOR.instances)CKEDITOR.instances[instance].updateElement();if("function"!=typeof t){var t=NKR.ajax_processer;NKR.loading("show")}if(a)"reply_question"==a&&(NKR.loading("show"),$(".btn-reply").addClass("disabled"),void 0!=EDITOR&&EDITOR.removeListener("blur",EDITOR_CALLBACK));else var a="default";var i={_post_type:"ajax"};e.ajaxSubmit({dataType:"json",data:i,success:function(e){t(a,e)},error:function(e){console.log(e),""!=$.trim(e.responseText)?(NKR.loading("hide"),alert(_t("发生错误, 返回的信息:")+" "+e.responseText)):0==e.status?(NKR.loading("hide"),alert(_t("网络链接异常"))):500==e.status&&(NKR.loading("hide"),alert(_t("内部服务器错误")))}})},ajax_processer:function(e,t){if(NKR.loading("hide"),"undefined"==typeof t.errno)NKR.alert(t);else if(0==t.errno)NKR.alert(t.err,"success");else if(1!=t.errno)switch(e){case"default":case"comments_form":case"reply":case"reply_question":case"invite_friend":NKR.alert(t.err),$(".submit-comment-box, .btn-reply").removeClass("disabled");break;case"ajax_post_alert":case"ajax_post_modal":case"error_message":NKR.ajax_error_msg(t.err),$("#captcha").length&&$("#captcha").click()}else if("comments_form"==e&&(NKR.reload_comments_list(t.rsm.item_id,t.rsm.item_id,t.rsm.type_name),$("#comment-box-"+t.rsm.type_name+"-"+t.rsm.item_id+" form textarea").val(""),$("#comment-box-"+t.rsm.type_name+"-"+t.rsm.item_id).hide(),$(".submit-comment-box").removeClass("disabled")),t.rsm&&t.rsm.url)window.location.href==t.rsm.url?window.location.reload():window.location=decodeURIComponent(t.rsm.url);else switch(e){case"default":case"ajax_post_alert":case"error_message":window.location.reload();break;case"ajax_post_modal":$("#aw-ajax-box div.modal").modal("hide");break;case"invite_friend":$("#modalInviteFriend").modal("hide"),swal({title:"发送邀请成功",text:"",html:!0,confirmButtonText:"确定",type:"success"});break;case"reply_question":NKR.loading("hide"),t.rsm.ajax_html?($(".load-question-answers").click(),$(".comment-box .btn-reply").removeClass("disabled"),"undefined"!=EDITOR&&EDITOR.setData("")):t.rsm.url?window.location=decodeURIComponent(t.rsm.url):window.location.reload();break;case"reply":NKR.loading("hide"),t.rsm.ajax_html?($(".article-comment-items").append(t.rsm.ajax_html),$(".article-reply-button").removeClass("disabled"),$.scrollTo($("#"+$(t.rsm.ajax_html).attr("id")),600,{queue:!0}),$("#comment_editor").val("")):t.rsm.url?window.location=decodeURIComponent(t.rsm.url):window.location.reload()}},load_list_view:function(e,t,a,i,n){return t.attr("id")?(i||(i=0),void 0==t.attr("data-page")?t.attr("data-page",i):t.attr("data-page",parseInt(t.attr("data-page"))+1),t.bind("click",function(){var t=$(this),o=$('<div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>');return o.insertBefore(t.hide()),$.get(e+"__page-"+t.attr("data-page"),function(e){var s=!1;o.remove(),t.show(),""!=$.trim(e)?(t.attr("data-page")==i&&"false"!=t.attr("auto-load")?a.html(e):a.append(e),t.attr("data-page",parseInt(t.attr("data-page"))+1)):(t.attr("data-page")==i&&"false"!=t.attr("auto-load")&&a.html('<p class="c-gray text-center p-t-15 p-b-15">没有内容</p>'),s=!0,t.addClass("disabled").unbind("click").bind("click",function(e){e.preventDefault()})),null!=n&&n(t,s)}),!1}),void("false"!=t.attr("auto-load")&&t.click())):!1},reload_comments_list:function(e,t,a){$.get(G_BASE_URL+"/question/ajax/get_"+a+"_comments/"+a+"_id-"+e,function(e){$("#comment-list-"+a+"-"+t).html(e)})},alert:function(e,t){switch(t){case"info":NKR.notify(e,"info",!0,"top",0,0,"down");break;case"warning":NKR.notify(e,"warning",!0,"top",0,0,"down");break;case"success":NKR.notify(e,"success",!0,"top",0,0,"down");break;case"error":NKR.notify(e,"danger",!0,"top",0,0,"down");break;default:NKR.notify(e,"danger",!0,"top",0,0,"down")}},dialog:function(type,data,callback){switch(type){case"alertImg":var template=Hogan.compile(AW_TEMPLATE.alertImg).render({hide:data.hide,url:data.url,message:data.message});break;case"publish":var template=Hogan.compile(AW_TEMPLATE.publishBox).render({category_id:data.category_id,ask_user_id:data.ask_user_id});break;case"redirect":var template=Hogan.compile(AW_TEMPLATE.questionRedirect).render({data_id:data});break;case"commentEdit":var template=Hogan.compile(AW_TEMPLATE.editCommentBox).render({answer_id:data.answer_id,attach_access_key:data.attach_access_key});break;case"solutionEdit":var template=Hogan.compile(AW_TEMPLATE.editSolutionBox).render({question_id:data.question_id,solution_id:data.solution_id,attach_access_key:data.attach_access_key});break;case"favorite":var template=Hogan.compile(AW_TEMPLATE.favoriteBox).render({item_id:data.item_id,item_type:data.item_type});break;case"inbox":var template=Hogan.compile(AW_TEMPLATE.inbox).render({recipient:data});break;case"report":var template=Hogan.compile(AW_TEMPLATE.reportBox).render({item_type:data.item_type,item_id:data.item_id});break;case"topicEditHistory":var template=AW_TEMPLATE.ajaxData.replace("{{title}}",_t("编辑记录")).replace("{{data}}",data);break;case"ajaxData":var template=AW_TEMPLATE.ajaxData.replace("{{title}}",data.title).replace("{{data}}",'<div id="aw_dialog_ajax_data"></div>');break;case"imagePreview":var template=AW_TEMPLATE.ajaxData.replace("{{title}}",data.title).replace("{{data}}",'<p align="center"><img src="'+data.image+'" alt="" style="max-width:520px" /></p>');break;case"confirm":var template=Hogan.compile(AW_TEMPLATE.confirmBox).render({message:data.message});break;case"recommend":var template=Hogan.compile(AW_TEMPLATE.recommend).render();break;case"projectEventForm":var template=Hogan.compile(AW_TEMPLATE.projectEventForm).render({project_id:data.project_id,contact_name:data.contact_name,contact_tel:data.contact_tel,contact_email:data.contact_email});break;case"projectStockForm":var template=Hogan.compile(AW_TEMPLATE.projectStockForm).render({project_id:data.project_id,contact_name:data.contact_name,contact_tel:data.contact_tel,contact_email:data.contact_email});break;case"activityBox":var template=Hogan.compile(AW_TEMPLATE.activityBox).render({contact_name:data.contact_name,contact_tel:data.contact_tel,contact_qq:data.contact_qq});break;case"addTopic":var template=Hogan.compile(AW_TEMPLATE.addTopicBox).render({question_id:data.question_id})}if(template){switch($(".alert-box").length&&$(".alert-box").remove(),$("#aw-ajax-box").html(template).show(),type){case"redirect":NKR.Dropdown.bind_dropdown_list($(".aw-question-redirect-box #question-input"),"redirect");break;case"inbox":NKR.Dropdown.bind_dropdown_list($(".inbox #invite-input"),"inbox"),$("body").on("click",".inbox .lv-item",function(){$(".inbox #quick_publish input.form-control").val($(this).attr("data-username")),$(this).parents(".dropdown").removeClass("open")});break;case"publish":NKR.Dropdown.bind_dropdown_list($(".aw-publish-box #quick_publish_question_content"),"publish"),NKR.Dropdown.bind_dropdown_list($(".aw-publish-box #aw_edit_topic_title"),"topic"),1==parseInt(data.category_enable)?$.get(G_BASE_URL+"/publish/ajax/fetch_question_category/",function(result){NKR.Dropdown.set_dropdown_list(".aw-publish-box .dropdown",eval(result),data.category_id),$(".aw-publish-title .dropdown li a").click(function(){$(".aw-publish-box #quick_publish_category_id").val($(this).attr("data-value")),$(".aw-publish-box #aw-topic-tags-select").html($(this).text())})}):$(".aw-publish-box .aw-publish-title").hide(),""!=data.ask_user_id&&void 0!=data.ask_user_id&&$(".aw-publish-box .modal-title").html("向 "+data.ask_user_name+" 提问"),$("#aw-search-query").val()&&$("#aw-search-query").val()!=$("#aw-search-query").attr("placeholder")&&$("#quick_publish_question_content").val($("#aw-search-query").val()),NKR.Init.init_topic_edit_box("#quick_publish .aw-edit-topic"),$("#quick_publish .aw-edit-topic").click(),$("#quick_publish .close-edit").hide(),data.topic_title&&$("#quick_publish .aw-edit-topic").parents(".aw-topic-bar").prepend('<span class="topic-tag"><a class="text">'+data.topic_title+'</a><a class="close" onclick="$(this).parents(\'.topic-tag\').detach();"><i class="icon icon-delete"></i></a><input type="hidden" value="'+data.topic_title+'" name="topics[]" /></span>'),"undefined"!=typeof G_QUICK_PUBLISH_HUMAN_VALID&&($("#quick_publish_captcha").show(),$("#captcha").click());break;case"favorite":$.get(G_BASE_URL+"/favorite/ajax/get_favorite_tags/",function(e){var t="";$.each(e,function(e,a){t+='<li><a data-value="'+a.title+'"><i class="md md-check"></i><span class="title">'+a.title+"</span></a></li>"}),$(".aw-favorite-tag-list ul").append(t),$.post(G_BASE_URL+"/favorite/ajax/get_item_tags/",{item_id:$('#favorite_form input[name="item_id"]').val(),item_type:$('#favorite_form input[name="item_type"]').val()},function(e){e&&$.each(e,function(t,a){var i=t;$.each($(".aw-favorite-tag-list ul li .title"),function(t,a){$(this).text()==e[i]&&$(this).parents("li").addClass("active")})})},"json"),$(document).on("click",".aw-favorite-tag-list ul li a",function(){var e=this,t=!0,a=G_BASE_URL+"/favorite/ajax/update_favorite_tag/";$(this).parents("li").hasClass("active")&&(a=G_BASE_URL+"/favorite/ajax/remove_favorite_tag/",t=!1),$.post(a,{item_id:$('#favorite_form input[name="item_id"]').val(),item_type:$('#favorite_form input[name="item_type"]').val(),tags:$(e).attr("data-value")},function(a){1==a.errno&&(t?$(e).parents("li").addClass("active"):$(e).parents("li").removeClass("active"))},"json")})},"json");break;case"report":$(".aw-report-box select option").click(function(){$(".aw-report-box textarea").text($(this).attr("value"))});break;case"commentEdit":$.get(G_BASE_URL+"/question/ajax/fetch_answer_data/"+data.answer_id,function(e){$("#editor_reply").html(e.answer_content.replace("&amp;","&"));var t=CKEDITOR.replace("editor_reply");if("Y"==UPLOAD_ENABLE){var a=new FileUpload("file",".aw-edit-comment-box .upload-box .btn",".aw-edit-comment-box .upload-box .upload-container",G_BASE_URL+"/publish/ajax/attach_upload/id-answer__attach_access_key-"+ATTACH_ACCESS_KEY,{insertTextarea:".aw-edit-comment-box #editor_reply",editor:t});$.post(G_BASE_URL+"/publish/ajax/answer_attach_edit_list/","answer_id="+data.answer_id,function(e){return e.err?!1:void $.each(e.rsm.attachs,function(e,t){a.setFileList(t)})},"json")}else $(".aw-edit-comment-box .file-upload-box").hide()},"json");break;case"solutionEdit":$.get(G_BASE_URL+"/question/ajax/get_question_solution_data/"+data.question_id,function(e){$("#editor_solution").html(e.content.replace("&amp;","&"));var t=CKEDITOR.replace("editor_solution"),a=$("#solution_edit input[name=attach_access_key]").val();if("Y"==UPLOAD_ENABLE){var i=new FileUpload("file",".edit-solution-box .upload-box .btn",".edit-solution-box .upload-box .upload-container",G_BASE_URL+"/publish/ajax/attach_upload/id-solution__attach_access_key-"+a,{insertTextarea:".aw-edit-solution-box #editor_solution",editor:t});$.post(G_BASE_URL+"/publish/ajax/solution_attach_edit_list/","solution_id="+data.solution_id,function(e){return e.err||!e.rsm.attachs?!1:void $.each(e.rsm.attachs,function(e,t){i.setFileList(t)})},"json")}else $(".edit-solution-box .upload-box").hide()},"json");break;case"ajaxData":$.get(data.url,function(e){$("#aw_dialog_ajax_data").html(e)});break;case"confirm":$(".aw-confirm-box .yes").click(function(){return callback&&callback(),$(".alert-box").modal("hide"),!1});break;case"recommend":$.get(G_BASE_URL+"/help/ajax/list/",function(e){if(e&&0!=e){var t="";$.each(e,function(e,a){t+='<li class="aw-border-radius-5"><img class="aw-border-radius-5" src="'+a.icon+'"><a data-id="'+a.id+'" class="aw-hide-txt">'+a.title+'</a><i class="icon icon-followed"></i></li>'}),$(".aw-recommend-box ul").append(t),$.each($(".aw-recommend-box ul li"),function(e,t){data.focus_id==$(this).find("a").attr("data-id")&&$(this).addClass("active")}),$(document).on("click",".aw-recommend-box ul li a",function(){var e=$(this),t=G_BASE_URL+"/help/ajax/add_data/",a=!1;$(this).parents("li").hasClass("active")&&(t=G_BASE_URL+"/help/ajax/remove_data/",a=!0),$.post(t,{item_id:data.item_id,id:e.attr("data-id"),title:e.text(),type:data.type},function(t){1==t.errno&&(a?e.parents("li").removeClass("active"):($(".aw-recommend-box ul li").removeClass("active"),e.parents("li").addClass("active")))},"json")})}else $(".error_message").html(_t("请先去后台创建好章节")),"none"!=$(".error_message").css("display")?NKR.shake($(".error_message")):$(".error_message").fadeIn()},"json");break;case"addTopic":var questionId=$("#cloud-topic-list").attr("data-question-id");$("body").on("click",".cloud-topic-item",function(e){e.preventDefault();var t=$(this),a=t.attr("data-topic-id");$.get(G_BASE_URL+"/topic/ajax/toggle_question_topic_relation/topic_id-"+a+"__question_id-"+questionId,function(e){t.toggleClass("active",e.has_relation)},"json")}),NKR.load_list_view(G_BASE_URL+"/topic/ajax/get_question_cloud_topic_list/question_id-"+questionId,$("#topic-cloud-load-more"),$("#cloud-topic-list ul"),2),$.get(G_BASE_URL+"/topic/ajax/get_question_cloud_topic_list/question_id-"+questionId,function(e){$("#cloud-topic-list ul").html(e)})}$(".alert-box").modal("show")}},check_placeholder:function(e){$.each(e,function(){"undefined"!=typeof $(this).attr("placeholder")&&($(this).attr("data-placeholder","true"),""==$(this).val()&&$(this).addClass("aw-placeholder").val($(this).attr("placeholder")),$(this).focus(function(){$(this).val()==$(this).attr("placeholder")&&$(this).removeClass("aw-placeholder").val("")}),$(this).blur(function(){""==$(this).val()&&$(this).addClass("aw-placeholder").val($(this).attr("placeholder"))}))})},hightlight:function(e,t){if(e.hasClass(t))return!0;var a=setInterval(function(){e.addClass(t)},500),i=setInterval(function(){e.removeClass(t)},600);setTimeout(function(){clearInterval(a),clearInterval(i),e.addClass(t)},1200),setTimeout(function(){e.removeClass(t)},6e3)},nl2br:function(e){return e.replace(new RegExp("\r\n|\n\r|\r|\n","g"),"<br />")},content_switcher:function(e,t){e.hide(),t.removeClass("hide"),t.fadeIn()},htmlspecialchars:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},show_card_box:function(e,t,a){if(!a)var a=300;$(document).on("mouseover",e,function(){clearTimeout(NKR.G.card_box_hide_timer);var e=$(this);NKR.G.card_box_show_timer=setTimeout(function(){function a(t,a){"user"==t&&$.get(G_BASE_URL+a+e.attr("data-id"),function(e){var t,a=e.focus;e.verified;1==a?(a="following",focusIcon="md-check",t="正在关注"):(a="",focusIcon="md-add",t="添加关注"),"enterprise"==e.verified?(verified_enterprise="icon-v i-ve",verified_title="企业认证"):"personal"==e.verified?(verified_enterprise="icon-v",verified_title="个人认证"):verified_enterprise=verified_title="";var i=G_BASE_URL+"/people/questions/id-"+e.uid+"__type-publish",o=G_BASE_URL+"/people/questions/id-"+e.uid+"__type-answered",s=G_BASE_URL+"/people/questions/id-"+e.uid+"__type-comments";$("#aw-ajax-box").html(Hogan.compile(AW_TEMPLATE.userCard).render({verified_enterprise:verified_enterprise,verified_title:verified_title,uid:e.uid,avatar_file:e.avatar_file,user_name:e.user_name,reputation:e.reputation,agree_count:e.agree_count,signature:e.signature,url:e.url,category_enable:e.category_enable,focus:a,focusIcon:focusIcon,focusTxt:t,ask_name:"'"+e.user_name+"'",fansCount:e.fans_count,success_ratio:(100*e.success_ratio).toFixed(1),poft_ratio:(100*e.poft_ratio).toFixed(1),question_count:e.question_count,answer_count:e.answer_count,quiz_count:e.quiz_count,question_count_url:i,quiz_count_url:o,answer_count_url:s})),(""==G_USER_ID||G_USER_ID==e.uid||e.uid<0)&&$("#aw-card-tips-user .mod-footer").hide(),n(),NKR.G.cashUserData.push($("#aw-ajax-box").html())},"json"),"topic"==t&&$.get(G_BASE_URL+a+e.attr("data-id"),function(e){var t,a=e.focus;0==a?(a="",t=_t("关注")):(a="active",t=_t("取消关注")),$("#aw-ajax-box").html(Hogan.compile(AW_TEMPLATE.topicCard).render({topic_id:e.topic_id,topic_pic:e.topic_pic,topic_title:e.topic_title,topic_description:e.topic_description,discuss_count:e.discuss_count,focus_count:e.focus_count,focus:a,focusTxt:t,url:e.url,fansCount:e.fans_count})),""==G_USER_ID&&$("#aw-card-tips .follow").hide(),n(),NKR.G.cashTopicData.push($("#aw-ajax-box").html())},"json")}function i(t){"user"==t&&$.each(NKR.G.cashUserData,function(t,a){a.match('data-id="'+e.attr("data-id")+'"')&&($("#aw-ajax-box").html(a),$("#aw-card-tips").removeAttr("style"),n(),o=1)}),"topic"==t&&$.each(NKR.G.cashTopicData,function(t,a){a.match('data-id="'+e.attr("data-id")+'"')&&($("#aw-ajax-box").html(a),$("#aw-card-tips").removeAttr("style"),n(),o=1)})}function n(){$(".user-pie-ratio")[0]&&NKR.showpie("user-pie-ratio",100);var t=e.offset().left,a=e.offset().top+e.height()+5,i=e.offset().top-$(window).scrollTop();i+$("#aw-card-tips").innerHeight()>$(window).height()&&(a=e.offset().top-$("#aw-card-tips").innerHeight()-10),t+$("#aw-card-tips").innerWidth()>$(window).width()&&(t=e.offset().left-$("#aw-card-tips").innerWidth()+e.innerWidth()),$("#aw-card-tips").css({left:t,top:a}).fadeIn()}if(e.attr("data-id"))switch(t){case"user":if(0==NKR.G.cashUserData.length)a("user","/people/ajax/user_info/uid-");else{var o=0;i("user"),0==o&&a("user","/people/ajax/user_info/uid-")}break;case"topic":if(0==NKR.G.cashTopicData.length)a("topic","/topic/ajax/topic_info/topic_id-");else{var o=0;i("topic"),0==o&&a("topic","/topic/ajax/topic_info/topic_id-")}}},a)}),$(document).on("mouseout",e,function(){clearTimeout(NKR.G.card_box_show_timer),NKR.G.card_box_hide_timer=setTimeout(function(){$("#aw-card-tips").fadeOut()},600)})},at_user_lists:function(e,t){function a(){$(".content_cursor")[0]||$("#aw-ajax-box").append('<span class="content_cursor"></span>'),$("#aw-ajax-box").find(".content_cursor").css({left:parseInt($(e).offset().left+parseInt($(e).css("padding-left"))+2),top:parseInt($(e).offset().top+parseInt($(e).css("padding-left")))}),$(".aw-invite-dropdown")[0]||$("#aw-ajax-box").append('<ul class="aw-invite-dropdown"></ul>')}function i(){$(".aw-invite-dropdown").css({left:$(".content_cursor").offset().left+$(".content_cursor").innerWidth(),top:$(".content_cursor").offset().top+24}).show()}function n(e){var t={text:"",start:0,end:0};if(e.focus(),e.setSelectionRange)t.start=e.selectionStart,t.end=e.selectionEnd,t.text=t.start!=t.end?e.value.substring(t.start,t.end):"";else if(document.selection){var a,i=document.selection.createRange(),n=document.body.createTextRange();for(n.moveToElementText(e),t.text=i.text,t.bookmark=i.getBookmark(),a=0;n.compareEndPoints("StartToStart",i)<0&&0!==i.moveStart("character",-1);a++)"\n"==e.value.charAt(a)&&a++;t.start=a,t.end=t.text.length+t.start}return t}$(e).keyup(function(e){var o=$(this),s=n($(this)[0]).start;if("@"==$(this).val().charAt(s-1))a(),$("#aw-ajax-box .content_cursor").html($(this).val().substring(0,s));else{var r=$(".aw-invite-dropdown li");switch(e.which){case 38:var c;r.hasClass("active")?($.each(r,function(e,t){$(this).hasClass("active")&&($(this).removeClass("active"),c=0==$(this).index()?r.length-1:$(this).index()-1)}),r.eq(c).addClass("active")):r.eq(r.length-1).addClass("active");break;case 40:var c;r.hasClass("active")?($.each(r,function(e,t){$(this).hasClass("active")&&($(this).removeClass("active"),c=$(this).index()==r.length-1?0:$(this).index()+1)}),r.eq(c).addClass("active")):r.eq(0).addClass("active");break;case 13:$.each($(".aw-invite-dropdown li"),function(e,t){$(this).hasClass("active")&&$(this).click()});break;default:if($(".aw-invite-dropdown")[0]){for(var d=0,l=s;l>0;l--)if("@"==$(this).val().charAt(l)){d=l;break}$.get(G_BASE_URL+"/search/ajax/search/?type=users&q="+encodeURIComponent($(this).val().substring(s,d).replace("@",""))+"&limit="+t,function(e){if($(".aw-invite-dropdown")[0])if(0!=e.length){var t="";$(".aw-invite-dropdown").html(""),$.each(e,function(e,a){t+='<li><img src="'+a.detail.avatar_file+'"/><a>'+a.name+"</a></li>"}),$(".aw-invite-dropdown").append(t),i(),$(".aw-invite-dropdown li").click(function(){o.val(o.val().substring(0,d)+"@"+$(this).find("a").html()+" ").focus(),$(".aw-invite-dropdown").detach()})}else $(".aw-invite-dropdown").hide();0==o.val().length&&$(".aw-invite-dropdown").hide()},"json")}}}}),$(e).keydown(function(e){var t=e.which;return!$(".aw-invite-dropdown").is(":visible")||38!=t&&40!=t&&13!=t?void 0:!1})},shake:function(e){var t=6;e.css("position","relative");for(var a=1;t>=a;a++)a%2==0?a==t?e.animate({left:0},50):e.animate({left:10},50):e.animate({left:-10},50)}};NKR.G={cashUserData:[],cashTopicData:[],card_box_hide_timer:"",card_box_show_timer:"",dropdown_list_xhr:"",loading_timer:"",loading_bg_count:12,loading_mini_bg_count:9,notification_timer:"",user_quiz_message_timer:""},NKR.User={follow:function(e,t,a){if(G_USER_ID<=0)return void(window.location=G_BASE_URL+"/account/login/");switch(e.addClass("disabled"),t){case"question":var i="/question/ajax/focus/",n={question_id:a};break;case"topic":var i="/topic/ajax/focus_topic/",n={topic_id:a};break;case"user":var i="/follow/ajax/follow_people/",n={uid:a}}$.post(G_BASE_URL+i,n,function(t){1==t.errno?"add"==t.rsm.type?e.addClass("following"):e.removeClass("following"):(t.err&&NKR.alert(t.err),t.rsm.url&&(window.location=decodeURIComponent(t.rsm.url))),e.removeClass("disabled"),e.html()?e.hasClass("following")?e.text("已关注"):e.text("+ 关注"):e.hasClass("following")?e.attr("data-original-title","正在关注"):e.attr("data-original-title","添加关注")},"json")},share_out:function(e){var t=t||window.location.href;if(e.title)var a=e.title+" - "+G_SITE_NAME;else var a=$("title").text();shareURL="http://www.jiathis.com/send/?webid="+e.webid+"&url="+t+"&title="+a,e.content&&$(e.content).find("img").length&&(shareURL=shareURL+"&pic="+$(e.content).find("img").eq(0).attr("src")),window.open(shareURL)},delete_draft:function(e,t){"clean"==t?$.post(G_BASE_URL+"/account/ajax/delete_draft/","type="+t,function(e){1!=e.errno&&NKR.alert(e.err)},"json"):$.post(G_BASE_URL+"/account/ajax/delete_draft/","item_id="+e+"&type="+t,function(e){1!=e.errno&&NKR.alert(e.err)},"json")},agree_vote:function(e,t,a){var i=$(e);$.post(G_BASE_URL+"/question/ajax/answer_vote/","answer_id="+a+"&value=1");var n=i.find(".count"),o=i.find("span"),s=i.attr("data-agreed"),r=parseInt(n.html());s>0?(r>0&&n.html(r-1),o.html("赞同"),i.removeClass("active"),i.attr("data-agreed",0)):(n.html(r+1),o.html("已赞同"),i.addClass("active"),i.attr("data-agreed",1))},disagree_vote:function(e,t,a){$.post(G_BASE_URL+"/question/ajax/answer_vote/","answer_id="+a+"&value=-1",function(e){}),$(e).hasClass("active")?$(e).removeClass("active"):$(e).parents(".operate").find(".agree").hasClass("active")?($.each($(e).parents(".aw-item").find(".aw-user-name"),function(e,a){$(a).html()==t&&($(a).prev()?$(a).prev().remove():$(a).next().remove(),$(a).remove())}),0==$(e).parents(".aw-item").find(".aw-agree-by a").length&&$(e).parents(".aw-item").find(".aw-agree-by").hide(),
$(e).parents(".operate").find(".count").html(parseInt($(e).parents(".operate").find(".count").html())-1),$(e).parents(".operate").find(".agree").removeClass("active"),$(e).addClass("active")):$(e).addClass("active")},question_uninterested:function(e,t){e.fadeOut(),$.post(G_BASE_URL+"/question/ajax/uninterested/","question_id="+t,function(e){"1"!=e.errno&&NKR.alert(e.err)},"json")},answer_force_fold:function(e,t){$.post(G_BASE_URL+"/question/ajax/answer_force_fold/","answer_id="+t,function(t){1!=t.errno?NKR.alert(t.err):1==t.errno&&("fold"==t.rsm.action?e.html(e.html().replace(_t("折叠"),_t("撤消折叠"))):e.html(e.html().replace(_t("撤消折叠"),_t("折叠"))))},"json")},question_invite_delete:function(e,t){$.post(G_BASE_URL+"/question/ajax/question_invite_delete/","question_invite_id="+t,function(t){1==t.errno?e.fadeOut():NKR.alert(t.rsm.err)},"json")},invite_user:function(e,t){return G_USER_ID<=0?void(window.location=G_BASE_URL+"/account/login/"):void $.post(G_BASE_URL+"/question/ajax/save_invite/",{question_id:QUESTION_ID,uid:e.attr("data-id")},function(a){-1!=a.errno?(0==e.parents(".aw-invite-box").find(".invite-list a").length&&e.parents(".aw-invite-box").find(".invite-list").show(),e.parents(".aw-invite-box").find(".invite-list").append(' <a class="text-color-999 invite-list-user" data-toggle="tooltip" data-placement="bottom" data-original-title="'+e.attr("data-value")+'"><img src='+t+" /></a>"),e.addClass("active").attr("onclick","NKR.User.disinvite_user($(this))").text("取消邀请"),e.parents(".aw-question-detail").find(".aw-invite-replay .badge").text(parseInt(e.parents(".aw-question-detail").find(".aw-invite-replay .badge").text())+1)):-1==a.errno&&NKR.alert(a.err)},"json")},disinvite_user:function(e){$.get(G_BASE_URL+"/question/ajax/cancel_question_invite/question_id-"+QUESTION_ID+"__recipients_uid-"+e.attr("data-id"),function(t){-1!=t.errno&&($.each($(".aw-question-detail .invite-list a"),function(t,a){$(this).attr("data-original-title")==e.parents(".main").find(".aw-user-name").text()&&$(this).detach()}),e.removeClass("active").attr("onclick","NKR.User.invite_user($(this),$(this).parents('li').find('img').attr('src'))").text("邀请"),e.parents(".aw-question-detail").find(".aw-invite-replay .badge").text(parseInt(e.parents(".aw-question-detail").find(".aw-invite-replay .badge").text())-1),0==e.parents(".aw-invite-box").find(".invite-list").children().length&&e.parents(".aw-invite-box").find(".invite-list").hide())})},question_thanks:function(e,t){$.post(G_BASE_URL+"/question/ajax/question_thanks/","question_id="+t,function(t){1!=t.errno?NKR.alert(t.err):"add"==t.rsm.action?(e.html(e.html().replace(_t("感谢"),_t("已感谢"))),e.removeAttr("onclick")):e.html(e.html().replace(_t("已感谢"),_t("感谢")))},"json")},answer_user_rate:function(e,t,a){$.post(G_BASE_URL+"/question/ajax/question_answer_rate/","type="+t+"&answer_id="+a,function(a){if(1!=a.errno)NKR.alert(a.err);else if(1==a.errno)switch(t){case"thanks":"add"==a.rsm.action?(e.html(e.html().replace(_t("感谢"),_t("已感谢"))),e.removeAttr("onclick")):e.html(e.html().replace(_t("已感谢"),_t("感谢")));break;case"uninterested":"add"==a.rsm.action?e.html(e.html().replace(_t("没有帮助"),_t("撤消没有帮助"))):e.html(e.html().replace(_t("撤消没有帮助"),_t("没有帮助")))}},"json")},remove_answer:function(e,t){$.get(G_BASE_URL+"/question/ajax/remove_answer/answer_id-"+t),e.parents("li.comment-item[id=comment-id-"+t+"]").fadeOut()},save_comment:function(e){e.addClass("disabled"),NKR.ajax_post(e.parents("form"),NKR.ajax_processer,"comments_form")},remove_comment:function(e,t,a){$.get(G_BASE_URL+"/question/ajax/remove_comment/type-"+t+"__comment_id-"+a),e.parents("li.sub-comment-item").fadeOut()},article_vote:function(e,t,a){if(G_USER_ID<=0)return void(window.location=G_BASE_URL+"/account/login/");if(NKR.loading("show"),e.hasClass("active"))var a=0;$.post(G_BASE_URL+"/article/ajax/article_vote/","type=article&item_id="+t+"&rating="+a,function(t){NKR.loading("hide"),1!=t.errno?NKR.alert(t.err):0==a?e.removeClass("active").find("b").html(parseInt(e.find("b").html())-1):-1==a?(e.parents(".aw-article-vote").find(".agree").hasClass("active")&&(e.parents(".aw-article-vote").find("b").html(parseInt(e.parents(".aw-article-vote").find("b").html())-1),e.parents(".aw-article-vote").find("a").removeClass("active")),e.addClass("active")):(e.parents(".aw-article-vote").find("a").removeClass("active"),e.addClass("active").find("b").html(parseInt(e.find("b").html())+1))},"json")},article_comment_vote:function(e,t,a){if(G_USER_ID<=0)return void(window.location=G_BASE_URL+"/account/login/");NKR.loading("show");var i=e.find("span");if(e.hasClass("active"))var a=0;$.post(G_BASE_URL+"/article/ajax/article_vote/","type=comment&item_id="+t+"&rating="+a,function(t){NKR.loading("hide"),1!=t.errno?NKR.alert(t.err):0==a?(e.attr("data-original-title","赞同").removeClass("active").find("b").html(parseInt(e.find("b").html())-1),i.html("赞同")):(e.attr("data-original-title","取消赞同").addClass("active").find("b").html(parseInt(e.find("b").html())+1),i.html("已赞同"))},"json")},add_favorite_tag:function(){$.post(G_BASE_URL+"/favorite/ajax/update_favorite_tag/",{item_id:$('#favorite_form input[name="item_id"]').val(),item_type:$('#favorite_form input[name="item_type"]').val(),tags:$("#favorite_form .add-input").val()},function(e){-1==e.errno?NKR.alert(e.err):1==e.errno&&($(".aw-favorite-box .aw-favorite-tag-list").show(),$(".aw-favorite-box .aw-favorite-tag-add").hide(),$(".aw-favorite-tag-list ul").prepend('<li class="active"><a data-value="'+$("#favorite_form .add-input").val()+'"><i class="md md-check"></i><span class="title">'+$("#favorite_form .add-input").val()+"</span></a></li>"))},"json")},update_signature:function(){if(G_USER_ID<0)return void window.location.reload();var e=$("#user-signature-input").val();$.post(G_BASE_URL+"/account/ajax/update_signature/",{signature:e},function(t){-1==t.errno?NKR.alert(t.err):1==t.errno&&($(".user-signature span.signature").html(e),$(".dropdown.pmop-message.user-signature-dialog").removeClass("open"))},"json")}},NKR.Dropdown={bind_dropdown_list:function(e,t){"search"==t&&$(e).focus(function(){$(e).closest(".dropdown").addClass("open")}),$(e).keyup(function(a){if($(e).closest(".dropdown").addClass("open"),"search"==t&&$(e).parent().find(".search").show().children("a").text($(e).val()),$(e).val().length>=1?38!=a.which&&40!=a.which&&188!=a.which&&13!=a.which&&NKR.Dropdown.get_dropdown_list($(this),t,$(e).val()):$(e).closest(".dropdown").removeClass("open"),"topic"==t){if(188==a.which)return","!=$(".aw-edit-topic-box #aw_edit_topic_title").val()&&($(".aw-edit-topic-box #aw_edit_topic_title").val($(".aw-edit-topic-box #aw_edit_topic_title").val().substring(0,$(".aw-edit-topic-box #aw_edit_topic_title").val().length-1)),$(".aw-edit-topic-box .aw-dropdown").hide(),$(".aw-edit-topic-box .add").click()),!1;if(13==a.which)return $(".aw-edit-topic-box .aw-dropdown").hide(),$(".aw-edit-topic-box .add").click(),!1;var i=$(e).parent().find(".aw-dropdown-list li");if(40==a.which&&i.is(":visible")){var n;i.hasClass("active")?($.each(i,function(e,t){$(this).hasClass("active")&&($(this).removeClass("active"),n=$(this).index()==i.length-1?0:$(this).index()+1)}),i.eq(n).addClass("active"),$(e).val(i.eq(n).text())):i.eq(0).addClass("active")}if(38==a.which&&i.is(":visible")){var n;i.hasClass("active")?($.each(i,function(e,t){$(this).hasClass("active")&&($(this).removeClass("active"),n=0==$(this).index()?i.length-1:$(this).index()-1)}),i.eq(n).addClass("active"),$(e).val(i.eq(n).text())):i.eq(i.length-1).addClass("active")}}}),$(e).blur(function(){})},set_dropdown_list:function(e,t,a){$(e).append(Hogan.compile(AW_TEMPLATE.dropdownList).render({items:t})),$(e+" .aw-dropdown-list li a").click(function(){$("#aw-topic-tags-select").html($(this).text())}),a&&$(e+" .dropdown-menu li a[data-value='"+a+"']").click()},get_dropdown_list:function(e,t,a){""!=NKR.G.dropdown_list_xhr&&NKR.G.dropdown_list_xhr.abort();var i,n="没有找到相关结果";switch(t){case"search":i=G_BASE_URL+"/search/ajax/search/?q="+encodeURIComponent(a)+"&limit=5";break;case"publish":i=G_BASE_URL+"/search/ajax/search/?type=questions&q="+encodeURIComponent(a)+"&limit=5";break;case"redirect":i=G_BASE_URL+"/search/ajax/search/?q="+encodeURIComponent(a)+"&type=questions&limit=30&is_question_id=1";break;case"invite":i=G_BASE_URL+"/search/ajax/search/?type=users&q="+encodeURIComponent(a)+"&limit=10",n="没有找到你想邀请的人";break;case"inbox":i=G_BASE_URL+"/search/ajax/search/?type=users&q="+encodeURIComponent(a)+"&limit=10",n="没有找到相关的人";break;case"topic_question":i=G_BASE_URL+"/search/ajax/search/?type=questions,articles&q="+encodeURIComponent(a)+"&topic_ids="+CONTENTS_RELATED_TOPIC_IDS+"&limit=50";break;case"topic":i=G_BASE_URL+"/search/ajax/search/?type=topics&q="+encodeURIComponent(a)+"&limit=10";break;case"questions":i=G_BASE_URL+"/search/ajax/search/?type=questions&q="+encodeURIComponent(a)+"&limit=10";break;case"articles":i=G_BASE_URL+"/search/ajax/search/?type=articles&q="+encodeURIComponent(a)+"&limit=10"}NKR.G.dropdown_list_xhr=$.get(i,function(i){if(0!=i.length&&void 0!=NKR.G.dropdown_list_xhr){switch($(e).parent().find(".aw-dropdown-list").html(""),t){case"search":$.each(i,function(t,a){switch(a.type){case"questions":if(a.detail.best_answer>0)var i="active";else var i="";$(e).parent().find(".aw-dropdown-list").append(Hogan.compile(AW_TEMPLATE.searchDropdownListQuestions).render({url:a.url,active:i,content:a.name,discuss_count:a.detail.answer_count}));break;case"articles":$(e).parent().find(".aw-dropdown-list").append(Hogan.compile(AW_TEMPLATE.searchDropdownListArticles).render({url:a.url,content:a.name,comments:a.detail.comments}));break;case"topics":$(e).parent().find(".aw-dropdown-list").append(Hogan.compile(AW_TEMPLATE.searchDropdownListTopics).render({url:a.url,name:a.name,focus_count:a.detail.focus_count,topic_id:a.detail.topic_id}));break;case"users":var n=a.detail.signature;$(e).parent().find(".aw-dropdown-list").append(Hogan.compile(AW_TEMPLATE.searchDropdownListUsers).render({url:a.url,img:a.detail.avatar_file,name:a.name,intro:n}))}});break;case"publish":case"topic_question":$.each(i,function(t,a){$(e).parent().find(".aw-dropdown-list").append(Hogan.compile(AW_TEMPLATE.questionDropdownList).render({url:a.url,name:a.name}))});break;case"topic":$.each(i,function(t,a){$(e).parent().find(".aw-dropdown-list").append(Hogan.compile(AW_TEMPLATE.editTopicDorpdownList).render({name:a.name}))});break;case"redirect":$.each(i,function(t,a){$(e).parent().find(".aw-dropdown-list").append(Hogan.compile(AW_TEMPLATE.questionRedirectList).render({url:"'"+G_BASE_URL+"/question/ajax/redirect/', 'item_id="+$(e).attr("data-id")+"&target_id="+a.search_id+"'",name:a.name}))});break;case"questions":case"articles":$.each(i,function(t,a){$(e).parent().find(".aw-dropdown-list").append(Hogan.compile(AW_TEMPLATE.questionDropdownList).render({url:"#",name:a.name}))});break;case"inbox":$.each(i,function(t,a){var i=a.detail.signature;$(e).parent().find(".aw-dropdown-list").append(Hogan.compile(AW_TEMPLATE.inboxDropdownList).render({uid:a.uid,name:a.name,img:a.detail.avatar_file,intro:i}))});break;case"invite":$.each(i,function(t,a){var i=a.detail.signature;$(e).parent().find(".aw-dropdown-list").append(Hogan.compile(AW_TEMPLATE.inviteDropdownList).render({uid:a.uid,name:a.name,img:a.detail.avatar_file,intro:i,url:a.url}))})}"publish"==t?$(e).parent().find(".aw-publish-suggest-question, .aw-publish-suggest-question .aw-dropdown-list").show():($(e).parent().find(".aw-dropdown, .aw-dropdown-list").show().children().show(),$(e).parent().find(".title").hide(),$(e).parent().find(".aw-dropdown-list li.question a").highText(a,"b","active"))}else $(e).parent().find(".aw-dropdown").show().end().find(".title").html(n).show(),$(e).parent().find(".aw-dropdown-list, .aw-publish-suggest-question").hide()},"json")}},NKR.Notifcation={load:function(){G_USER_ID>0&&$("#header-notifications").length&&$.get(G_BASE_URL+"/notifications/ajax/header_list/flag-0__limit-5",function(e){e.length?$("#header-notifications").html(e):$("#header-notifications").html('<p class="no-notification">没有未读消息</p>')})},check_notifications:function(){return 0==G_USER_ID?(clearInterval(NKR.G.notification_timer),!1):void $.get(G_BASE_URL+"/home/ajax/notifications/",function(e){$("#inbox_unread").html(Number(e.rsm.inbox_num)),$("#inbox_unread_mobile").html(Number(e.rsm.inbox_num));var t=G_UNREAD_NOTIFICATION;if(G_UNREAD_NOTIFICATION=Number(e.rsm.notifications_num),G_UNREAD_NOTIFICATION>0){G_UNREAD_NOTIFICATION!=t&&(NKR.Message.load_notification_list(),$("#notifications_unread").html(G_UNREAD_NOTIFICATION),$("#notifications_unread_mobile").html(G_UNREAD_NOTIFICATION));var a=Number(e.rsm.notifications_num)+Number(e.rsm.inbox_num);document.title="("+a+") "+document_title,$("#notifications_unread").show(),$("#notifications_unread_mobile").show()}else $("#header_notification_list").length&&$("#header_notification_list").html(""),$("#index_notification").length&&$("#index_notification").fadeOut(),document.title=document_title,$("#notifications_unread").hide(),$("#notifications_unread_mobile").hide();Number(e.rsm.inbox_num)>0?($("#inbox_unread").removeClass("hide"),$("#inbox_unread_mobile").removeClass("hide")):($("#inbox_unread").addClass("hide"),$("#inbox_unread_mobile").addClass("hide"))},"json")},read_notification:function(e,t,a){if(t){e.remove();var i=G_BASE_URL+"/notifications/ajax/read_notification/notification_id-"+t}else{$("#index_notification").length&&$("#index_notification").fadeOut();var i=G_BASE_URL+"/notifications/ajax/read_notification/"}$.get(i,function(e){NKR.Message.check_notifications(),a&&window.location.reload()})},notification_show:function(e){$("#index_notification").length>0&&(0==$("#index_notification ul#notification_list li").length?$("#index_notification").fadeOut():$("#index_notification ul#notification_list li").each(function(t,a){e>t?$(a).show():$(a).hide()}))}},NKR.Init={init_comment_box:function(e){$(document).on("click",e,function(){if($(this).parents(".aw-question-detail").find(".aw-invite-box, .aw-question-related-box").hide(),"undefined"!=typeof COMMENT_UNFOLD&&"all"==COMMENT_UNFOLD&&0==$(this).attr("data-comment-count")&&"hide"==$(this).attr("data-first-click"))return $(this).removeAttr("data-first-click"),!1;if(!$(this).attr("data-type")||!$(this).attr("data-id"))return!0;var e="#aw-comment-box-"+$(this).attr("data-type")+"-"+$(this).attr("data-id");if($(e).length)"none"==$(e).css("display")?($(this).addClass("active"),$(e).fadeIn()):($(this).removeClass("active"),$(e).fadeOut());else{switch($(this).attr("data-type")){case"question":var t=G_BASE_URL+"/question/ajax/save_question_comment/question_id-"+$(this).attr("data-id"),a=G_BASE_URL+"/question/ajax/get_question_comments/question_id-"+$(this).attr("data-id");break;case"answer":var t=G_BASE_URL+"/question/ajax/save_answer_comment/answer_id-"+$(this).attr("data-id"),a=G_BASE_URL+"/question/ajax/get_answer_comments/answer_id-"+$(this).attr("data-id")}G_USER_ID?($(this).parents(".aw-item").find(".mod-footer").append(Hogan.compile(AW_TEMPLATE.commentBox).render({comment_form_id:e.replace("#",""),comment_form_action:t})),$(e).find(".aw-comment-txt").bind({focus:function(){$(e).find(".aw-comment-box-btn").show()},blur:function(){""==$(this).val()&&$(e).find(".aw-comment-box-btn").hide()}}),$(e).find(".close-comment-box").click(function(){$(e).fadeOut(),$(e).find(".aw-comment-txt").css("height",$(this).css("line-height"))})):$(this).parents(".aw-item").find(".mod-footer").append(Hogan.compile(AW_TEMPLATE.commentBoxClose).render({comment_form_id:e.replace("#",""),comment_form_action:t})),$.get(a,function(t){""==$.trim(t)&&(t='<div align="center" class="aw-padding10">'+_t("暂无评论")+"</div>"),$(e).find(".aw-comment-list").html(t)}),$(e).find(".aw-comment-txt").autosize(),$(this).addClass("active"),NKR.at_user_lists(e+" .aw-comment-txt",5)}NKR.at_user_lists($(this).parents(".aw-item").find(".aw-comment-txt"))})},init_article_comment_box:function(e){$(document).on("click",e,function(){var e=$(this).closest(".comment-item").find(".article-reply-comment-box");e.length?"block"==e.css("display")?e.fadeOut():e.fadeIn():$(this).closest(".comment-item").find(".media-body").append(Hogan.compile(AW_TEMPLATE.articleCommentBox).render({at_uid:$(this).attr("data-id"),article_id:ARTICLE_ID}))})},init_topic_edit_box:function(e){$(e).click(function(){var e=$(this).parents(".aw-topic-bar"),t=e.attr("data-id"),a=e.attr("data-type");e.hasClass("active")?e.addClass("active"):(e.addClass("active"),e.find(".topic-tag .close").length||e.find(".topic-tag").append('<a class="close"><i class="icon icon-delete"></i></a>')),0==e.find(".aw-edit-topic-box").length&&(e.append(AW_TEMPLATE.editTopicBox),e.find(".add").click(function(){if(""!=e.find("#aw_edit_topic_title").val())switch(a){case"publish":e.find(".tag-bar").prepend('<span class="topic-tag"><a class="text">'+e.find("#aw_edit_topic_title").val()+'</a><a class="close" onclick="$(this).parents(\'.topic-tag\').remove();"><i class="icon icon-delete"></i></a><input type="hidden" value="'+e.find("#aw_edit_topic_title").val()+'" name="topics[]" /></span>').hide().fadeIn(),e.find("#aw_edit_topic_title").val("");break;case"question":$.post(G_BASE_URL+"/topic/ajax/save_topic_relation/","type=question&item_id="+t+"&topic_title="+encodeURIComponent(e.find("#aw_edit_topic_title").val()),function(t){return 1!=t.errno?(NKR.alert(t.err),!1):(e.find(".tag-bar").prepend('<span class="topic-tag" data-id="'+t.rsm.topic_id+'"><a href="'+G_BASE_URL+"/topic/"+t.rsm.topic_id+'" class="text">'+e.find("#aw_edit_topic_title").val()+'</a><a class="close"><i class="icon icon-delete"></i></a></span>').hide().fadeIn(),void e.find("#aw_edit_topic_title").val(""))},"json");break;case"article":$.post(G_BASE_URL+"/topic/ajax/save_topic_relation/","type=article&item_id="+t+"&topic_title="+encodeURIComponent(e.find("#aw_edit_topic_title").val()),function(t){return 1!=t.errno?(NKR.alert(t.err),!1):(e.find(".tag-bar").prepend('<span class="topic-tag" data-id="'+t.rsm.topic_id+'"><a href="'+G_BASE_URL+"/topic/"+t.rsm.topic_id+'" class="text">'+e.find("#aw_edit_topic_title").val()+'</a><a class="close"><i class="icon icon-delete"></i></a></span>').hide().fadeIn(),void e.find("#aw_edit_topic_title").val(""))},"json");break;case"topic":$.post(G_BASE_URL+"/topic/ajax/save_related_topic/topic_id-"+t,"topic_title="+encodeURIComponent(e.find("#aw_edit_topic_title").val()),function(t){return 1!=t.errno?(NKR.alert(t.err),!1):(e.find(".tag-bar").prepend('<span class="topic-tag"><a href="'+G_BASE_URL+"/favorite/tag-"+encodeURIComponent(e.find("#aw_edit_topic_title").val())+'" class="text">'+e.find("#aw_edit_topic_title").val()+'</a><a class="close"><i class="icon icon-delete"></i></a></span>').hide().fadeIn(),void e.find("#aw_edit_topic_title").val(""))},"json");break;case"favorite":$.post(G_BASE_URL+"/favorite/ajax/update_favorite_tag/","item_id="+t+"&item_type="+e.attr("data-item-type")+"&tags="+encodeURIComponent(e.find("#aw_edit_topic_title").val()),function(t){return 1!=t.errno?(NKR.alert(t.err),!1):(e.find(".tag-bar").prepend('<span class="topic-tag"><a href="'+G_BASE_URL+"/favorite/tag-"+encodeURIComponent(e.find("#aw_edit_topic_title").val())+'" class="text">'+e.find("#aw_edit_topic_title").val()+'</a><a class="close"><i class="icon icon-delete"></i></a></span>').hide().fadeIn(),void e.find("#aw_edit_topic_title").val(""))},"json")}}),e.find(".close-edit").click(function(){e.removeClass("active"),e.find(".aw-edit-topic-box").hide(),e.find(".aw-edit-topic").show()}),NKR.Dropdown.bind_dropdown_list($(this).parents(".aw-topic-bar").find("#aw_edit_topic_title"),"topic")),$(this).parents(".aw-topic-bar").find(".aw-edit-topic-box").fadeIn(),G_CAN_CREATE_TOPIC||$(this).parents(".aw-topic-bar").find(".add").hide(),$(this).hide()})}},function(e){e.fn.extend({insertAtCaret:function(t){var a=e(this).get(0);if(document.all&&a.createTextRange&&a.caretPos){var i=a.caretPos;i.text=""==i.text.charAt(i.text.length-1)?t+"":t}else if(a.setSelectionRange){var n=a.selectionStart,o=a.selectionEnd,s=a.value.substring(0,n),r=a.value.substring(o);a.value=s+t+r,a.focus();var c=t.length;a.setSelectionRange(n+c,n+c),a.blur()}else a.value+=t},highText:function(t,a,i){return this.each(function(){e(this).html(function(t,a,i,n){var o=a.replace(/\b(\w+)\b/g,"($1)").replace(/\s+/g,"|");return t.replace(new RegExp(o,"ig"),function(t){return e("<"+i+" class="+n+">"+t+"</"+i+">").outerHTML()})}(e(this).text(),t,a,i))})},outerHTML:function(e){return e?this.before(e).remove():jQuery("<p>").append(this.eq(0).clone()).html()}}),e.extend({scrollTo:function(t,a,i){if("object"==typeof t)var t=e(t).offset().top;e("html, body").animate({scrollTop:t},{duration:a,queue:i.queue})}})}(jQuery);