function _t(t,e){return"undefined"!=typeof aws_lang&&"undefined"!=typeof aws_lang[t]&&(t=aws_lang[t]),e&&(t=t.replace("%s",e)),t}$(document).ready(function(){if(G_USER_INVALID_EMAIL.length){var t="你的邮箱 <strong>"+G_USER_INVALID_EMAIL+'</strong> 还未验证, 如果没有收到邮件<a class="alert-link" onclick="NKR.ajax_request(G_BASE_URL + \'/account/ajax/send_valid_mail/\');"> 点击重新发送</a>';NKR.notify(t,"warning",!1,"bottom",0,0,"up")}G_SITE_ANNOUNCE_CLOSE!=$.cookie("announce_close")&&$("#site-announce").show(),NKR.Notifcation.load(),$("#header").headroom(),$("body").on("click","[data-ma-act]",function(t){t.preventDefault();var e=$(this),i=$(this).data("ma-act");switch(i){case"sidebar-open":var a=e.data("ma-target"),n='<div data-ma-act="sidebar-close" class="ma-backdrop" />';$("body").addClass("sidebar-toggled"),$("#header, #header-alt, #main").append(n),e.addClass("toggled"),$(a).addClass("toggled");break;case"sidebar-close":$("body").removeClass("sidebar-toggled"),$(".ma-backdrop").remove(),$(".sidebar, .ma-trigger").removeClass("toggled");break;case"submenu-toggle":e.next().slideToggle(200),e.parent().toggleClass("toggled");break;case"search-open":$("#header").addClass("search-toggled"),$("#top-search-wrap input").focus();break;case"search-close":$("#header").removeClass("search-toggled");break;case"check-all-notifications":var o=e.closest(".list-group"),s=o.find(".list-group-item"),r=s.size();e.parent().fadeOut(),o.find(".list-group").prepend('<i class="grid-loading hide-it"></i>'),o.find(".grid-loading").fadeIn(1500);var c=0;s.each(function(){var t=$(this);setTimeout(function(){t.addClass("animated fadeOutRightBig").delay(1e3).queue(function(){t.remove()})},c+=150)}),setTimeout(function(){$(".him-notification").addClass("empty").find(".lg-body").html('<p class="no-notification">没有未读消息</p>')},150*r+200);break;case"action-header-open":ahParent=e.closest(".action-header").find(".ah-search"),ahParent.fadeIn(300),ahParent.find(".ahs-input").focus();break;case"action-header-close":ahParent.fadeOut(300),setTimeout(function(){ahParent.find(".ahs-input").val("")},350)}})}),$(document).ready(function(){if($(".dropdown")[0]&&($("body").on("click",".dropdown.open .dropdown-menu",function(t){t.stopPropagation()}),$(".dropdown").on("shown.bs.dropdown",function(t){$(this).attr("data-animation")&&($animArray=[],$animation=$(this).data("animation"),$animArray=$animation.split(","),$animationIn="animated "+$animArray[0],$animationOut="animated "+$animArray[1],$animationDuration="",$animArray[2]?$animationDuration=$animArray[2]:$animationDuration=500,$(this).find(".dropdown-menu").removeClass($animationOut),$(this).find(".dropdown-menu").addClass($animationIn))}),$(".dropdown").on("hide.bs.dropdown",function(t){$(this).attr("data-animation")&&(t.preventDefault(),$this=$(this),$dropdownMenu=$this.find(".dropdown-menu"),$dropdownMenu.addClass($animationOut),setTimeout(function(){$this.removeClass("open")},$animationDuration))})),$(".collapse")[0]&&($(".collapse").on("show.bs.collapse",function(t){$(this).closest(".panel").find(".panel-heading").addClass("active")}),$(".collapse").on("hide.bs.collapse",function(t){$(this).closest(".panel").find(".panel-heading").removeClass("active")}),$(".collapse.in").each(function(){$(this).closest(".panel").find(".panel-heading").addClass("active")})),$(".modal")[0]){var t=!1;$(".modal").on("show.bs.modal",function(){t=$(window).scrollTop()}).on("shown.bs.modal",function(){$("body").css({position:"fixed"})}).on("hide.bs.modal",function(){$("body").css({position:"relative"}),window.scrollTo(0,t)})}$(".fg-line")[0]&&($("body").on("focus",".fg-line .form-control",function(){$(this).closest(".fg-line").addClass("fg-toggled")}),$("body").on("blur",".form-control",function(){var t=$(this).closest(".form-group, .input-group"),e=t.find(".form-control").val();t.hasClass("fg-float")?0==e.length&&$(this).closest(".fg-line").removeClass("fg-toggled"):$(this).closest(".fg-line").removeClass("fg-toggled")})),$(".fg-float")[0]&&$(".fg-float .form-control").each(function(){var t=$(this).val();0==!t.length&&$(this).closest(".fg-line").addClass("fg-toggled")}),$("html").hasClass("ie9")&&$("input, textarea").placeholder({customClass:"ie9-placeholder"})}),function(t){t(document).ready(function(){t.fn.reverse=[].reverse,t(document).on("mouseenter",".fixed-action-btn:not(.toggle)",function(i){var a=t(this);e(a)}),t(document).on("mouseleave",".fixed-action-btn:not(.toggle)",function(e){var a=t(this);i(a)}),t(document).on("click",".fixed-action-btn.toggle > a",function(a){var n=t(this),o=n.parent();o.hasClass("active")?i(o):e(o)})}),t.fn.extend({openFAB:function(){e(t(this))},closeFAB:function(){i(t(this))}});var e=function(e){if($this=e,$this.hasClass("active")===!1){var i,a,n=$this.hasClass("horizontal");n===!0?a=40:i=40,$this.addClass("active"),$this.find("ul .btn").velocity({scaleY:".4",scaleX:".4",translateY:i+"px",translateX:a+"px"},{duration:0});var o=0;$this.find("ul .btn").reverse().each(function(){t(this).velocity({opacity:"1",scaleX:"1",scaleY:"1",translateY:"0",translateX:"0"},{duration:80,delay:o}),o+=40})}},i=function(t){$this=t;var e,i,a=$this.hasClass("horizontal");a===!0?i=40:e=40,$this.removeClass("active");$this.find("ul .btn").velocity("stop",!0),$this.find("ul .btn").velocity({opacity:"0",scaleX:".4",scaleY:".4",translateY:e+"px",translateX:i+"px"},{duration:80})}}(jQuery),$(document).ready(function(){new Swiper(".swiper-container",{pagination:".swiper-pagination",paginationClickable:!0,loop:!0})}),$(document).ready(function(){function t(t,e){e&&(t.removeClass("disabled").addClass("end").unbind("click").attr("href",G_BASE_URL+"/question/"),t.html("更多精彩答题，进入题库"))}function e(t,e){e&&(t.removeClass("disabled").addClass("end").unbind("click").attr("href",G_BASE_URL+"/topic/"),t.html("获取更多专题"))}function i(t,e){e&&(t.removeClass("disabled").addClass("end").unbind("click").attr("href",G_BASE_URL+"/article/"),t.html("获取更多知识"))}NKR.load_list_view(G_BASE_URL+"/explore/ajax/load_question_list/",$("#ql-load-more"),$("#question-list"),2,t),NKR.load_list_view(G_BASE_URL+"/explore/ajax/load_topic_list/",$("#tl-load-more"),$("#topic-list"),1,e),NKR.load_list_view(G_BASE_URL+"/explore/ajax/load_article_list/",$("#al-load-more"),$("#article-list"),1,i),$(".mr-tab").on("click",function(){var t=$($(this).attr("href"));t.find(".tc-list").is(":empty")&&t.find(".load-more a").click()})}),$(document).ready(function(){$("#login_form input").keydown(function(t){return 13==t.keyCode?($("#login_submit").click(),!1):void 0})}),$(document).ready(function(){$("#captcha").attr("src",G_BASE_URL+"/account/captcha/")}),$(document).ready(function(){function t(t){return t.length>=2&&t.length<=16}function e(t){var e=/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/;return e.test(t)}function i(t){return t.length>=6&&t.length<=17}function a(){return t($("#register_form input[name=user_name]").val())&&e($("#register_form input[name=email]").val())&&i($("#register_form input[name=password]").val())}function n(){return t($("#register_form input[name=user_name]").val())&&e($("#register_form input[name=email]").val())}function o(a){$(a).find("[type=text], [type=password]").on({focus:function(){var t=$(this),e=t.parent(),i=t.attr("tips");e.find(".help-block").detach(),e.find(".form-control-feedback").detach(),e.removeClass("has-error").removeClass("has-success").removeClass("has-feedback"),"undefined"!=typeof i&&""!=i&&e.append('<small class="help-block">'+t.attr("tips")+"</small>")},blur:function(){function a(){var t=o.find(".help-block"),e=o.find(".form-control-feedback");t.detach(),e.detach(),o.removeClass("has-error").removeClass("has-warning").removeClass("has-success").removeClass("has-feedback"),c?(o.addClass("has-feedback"),o.append('<span class="icon icon-check form-control-feedback"></span>')):"undefined"!=typeof r&&""!=r&&(o.addClass("has-error"),o.append('<small class="help-block">'+r+"</small>"))}var n=$(this),o=n.parent(),s=n.val(),r=n.attr("errortips"),c=!1;switch(n.attr("name")){case"user_name":c=t(s),c&&$.get(G_BASE_URL+"/account/ajax/check_username/username-"+encodeURIComponent(s),function(t){-1==t.errno&&(c=!1,r=t.err,a())},"json");break;case"email":c=e(s),c&&$.get(G_BASE_URL+"/account/ajax/check_email/email-"+encodeURIComponent(s),function(t){-1==t.errno&&(c=!1,r=t.err,a())},"json");break;case"password":c=i(s);break;default:r=""}a()}})}o("#register_form"),$("#submit-form").on("click",function(t){t.preventDefault(),a()&&NKR.ajax_post($("#register_form"),NKR.ajax_processer,"error_message")}),$("#sns-register-submit").on("click",function(t){t.preventDefault(),n()&&NKR.ajax_post($("#register_form"),NKR.ajax_processer,"error_message")})}),$(document).ready(function(){$(".change-email").on("click",function(t){t.preventDefault(),$(".lcb-resend-email").hide(),$(".lcb-change-email").show()})});var NKR={notify:function(t,e,i,a,n,o,s){var r="animated fadeInDown";switch(s){case"down":r="animated fadeInDown";break;case"up":r="animated fadeInUp";break;case"left":r="animated fadeInLeft";break;case"right":r="animated fadeInRight"}$.notify({icon:"",title:"",message:t},{element:"body",type:e,allow_dismiss:i,placement:{from:a,align:"center"},offset:{x:n,y:o},spacing:10,z_index:9999,delay:2500,timer:1e3,mouse_over:!1,newest_on_top:!0,animate:{enter:r,exit:"animated fadeOutDown"},icon_type:"class",template:'<div data-notify="container" class="alert alert-{0}" role="alert"><button type="button" class="close c-white" data-notify="dismiss"><span aria-hidden="true">&times;</span><span class="sr-only">close</span></button><span data-notify="icon" class="c-white"></span> <span data-notify="title">{1}</span><span data-notify="message" class="c-white">{2}</span></div>'})},loading:function(t){if(!$("#aw-loading").length,"show"==t){if("block"==$("#aw-loading").css("display"))return!1;$("#aw-loading").fadeIn(),NKR.G.loading_timer=setInterval(function(){NKR.G.loading_bg_count-=1,$("#aw-loading-box").css("background-position","0px "+40*NKR.G.loading_bg_count+"px"),1==NKR.G.loading_bg_count&&(NKR.G.loading_bg_count=12)},100)}else $("#aw-loading").fadeOut(),clearInterval(NKR.G.loading_timer)},loading_mini:function(t,e){!t.find("#aw-loading-mini-box").length,"show"==e?(t.find("#aw-loading-mini-box").fadeIn(),NKR.G.loading_timer=setInterval(function(){NKR.G.loading_mini_bg_count-=1,$("#aw-loading-mini-box").css("background-position","0px "+16*NKR.G.loading_mini_bg_count+"px"),1==NKR.G.loading_mini_bg_count&&(NKR.G.loading_mini_bg_count=9)},100)):(t.find("#aw-loading-mini-box").fadeOut(),clearInterval(NKR.G.loading_timer))},ajax_error_msg:function(t){NKR.notify(t,"danger",!0,"top",0,0,"down")},ajax_request:function(t,e){function i(t){return NKR.loading("hide"),t?void(-1==t.errno?NKR.alert(t.err):0==t.errno?NKR.alert(t.err,"success"):t.rsm&&t.rsm.url?window.location=decodeURIComponent(t.rsm.url):1==t.errno&&window.location.reload()):!1}function a(t){NKR.loading("hide"),""!=$.trim(t.responseText)&&alert(_t("发生错误, 返回的信息:")+" "+t.responseText)}return NKR.loading("show"),e?$.post(t,e+"&_post_type=ajax",function(t){i(t)},"json").error(function(t){a(t)}):$.get(t,function(t){i(t)},"json").error(function(t){a(t)}),!1},ajax_post:function(t,e,i){if("undefined"!=typeof CKEDITOR)for(instance in CKEDITOR.instances)CKEDITOR.instances[instance].updateElement();if("function"!=typeof e){var e=NKR.ajax_processer;NKR.loading("show")}if(i)"reply_question"==i&&(NKR.loading("show"),$(".qcmt-reply").attr("disabled","disabled"));else var i="default";var a={_post_type:"ajax"};t.ajaxSubmit({dataType:"json",data:a,success:function(t){e(i,t)},error:function(t){console.log(t),""!=$.trim(t.responseText)?(NKR.loading("hide"),alert(_t("发生错误, 返回的信息:")+" "+t.responseText)):0==t.status?(NKR.loading("hide"),alert(_t("网络链接异常"))):500==t.status&&(NKR.loading("hide"),alert(_t("内部服务器错误")))}})},ajax_processer:function(t,e){if(NKR.loading("hide"),"undefined"==typeof e.errno)NKR.alert(e);else if(0==e.errno)NKR.alert(e.err,"success");else if(1!=e.errno)switch(t){case"default":case"comments_form":case"reply":case"reply_question":case"invite_friend":NKR.alert(e.err),$(".submit-comment-box, .btn-reply").removeClass("disabled");break;case"ajax_post_alert":case"ajax_post_modal":case"error_message":NKR.ajax_error_msg(e.err),$("#captcha").length&&$("#captcha").click()}else if("comments_form"==t&&(NKR.reload_comments_list(e.rsm.item_id,e.rsm.item_id,e.rsm.type_name),$("#ci-reply-box-"+e.rsm.item_id+" form textarea").val(""),$("#ci-reply-box-"+e.rsm.item_id).hide(),$(".ci-submit").removeAttr("disabled")),e.rsm&&e.rsm.url)window.location.href==e.rsm.url?window.location.reload():window.location=decodeURIComponent(e.rsm.url);else switch(t){case"default":case"ajax_post_alert":case"error_message":window.location.reload();break;case"ajax_post_modal":$("#aw-ajax-box div.modal").modal("hide");break;case"invite_friend":$("#modalInviteFriend").modal("hide"),swal({title:"发送邀请成功",text:"",html:!0,confirmButtonText:"确定",type:"success"});break;case"reply_question":NKR.loading("hide"),e.rsm.ajax_html?($(".qcmt-load-comments").click(),$.get(G_BASE_URL+"/question/ajax/new_post_hash/",function(t){-1!=t.errno&&$('#answer_form input[name="post_hash"]').val(t.rsm.post_hash)},"json"),$(".qcmt-reply-box textarea").val(""),$(".comment-box .btn-reply").removeAttr("disabled")):e.rsm.url?window.location=decodeURIComponent(e.rsm.url):window.location.reload();break;case"reply":NKR.loading("hide"),e.rsm.ajax_html?($(".article-comment-items").append(e.rsm.ajax_html),$(".article-reply-button").removeClass("disabled"),$.scrollTo($("#"+$(e.rsm.ajax_html).attr("id")),600,{queue:!0}),$("#comment_editor").val("")):e.rsm.url?window.location=decodeURIComponent(e.rsm.url):window.location.reload()}},load_list_view:function(t,e,i,a,n){return e.attr("id")?(a||(a=0),void 0==e.attr("data-page")?e.attr("data-page",a):e.attr("data-page",parseInt(e.attr("data-page"))+1),e.bind("click",function(){var e=$(this),o=$('<div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>');return o.insertBefore(e.hide()),$.get(t+"__page-"+e.attr("data-page"),function(t){var s=!1;o.remove(),e.show(),""!=$.trim(t)?(e.attr("data-page")==a&&"false"!=e.attr("auto-load")?i.html(t):i.append(t),e.attr("data-page",parseInt(e.attr("data-page"))+1)):(e.attr("data-page")==a&&"false"!=e.attr("auto-load")&&i.html('<p class="c-gray text-center p-t-15 p-b-15">没有内容</p>'),s=!0,e.addClass("disabled").unbind("click").bind("click",function(t){t.preventDefault()})),null!=n&&n(e,s)}),!1}),void("false"!=e.attr("auto-load")&&e.click())):!1},reload_comments_list:function(t,e,i){$.get(G_BASE_URL+"/question/ajax/get_"+i+"_comments/"+i+"_id-"+t,function(t){$("#comment-item-"+e).html(t)})},alert:function(t,e){switch(e){case"info":NKR.notify(t,"info",!0,"top",0,0,"down");break;case"warning":NKR.notify(t,"warning",!0,"top",0,0,"down");break;case"success":NKR.notify(t,"success",!0,"top",0,0,"down");break;case"error":NKR.notify(t,"danger",!0,"top",0,0,"down");break;default:NKR.notify(t,"danger",!0,"top",0,0,"down")}},dialog:function(type,data,callback){switch(type){case"alertImg":var template=Hogan.compile(AW_TEMPLATE.alertImg).render({hide:data.hide,url:data.url,message:data.message});break;case"publish":var template=Hogan.compile(AW_TEMPLATE.publishBox).render({category_id:data.category_id,ask_user_id:data.ask_user_id});break;case"redirect":var template=Hogan.compile(AW_TEMPLATE.questionRedirect).render({data_id:data});break;case"commentEdit":var template=Hogan.compile(AW_TEMPLATE.editCommentBox).render({answer_id:data.answer_id,attach_access_key:data.attach_access_key});break;case"solutionEdit":var template=Hogan.compile(AW_TEMPLATE.editSolutionBox).render({question_id:data.question_id,solution_id:data.solution_id,attach_access_key:data.attach_access_key});break;case"favorite":var template=Hogan.compile(AW_TEMPLATE.favoriteBox).render({item_id:data.item_id,item_type:data.item_type});break;case"inbox":var template=Hogan.compile(AW_TEMPLATE.inbox).render({recipient:data});break;case"report":var template=Hogan.compile(AW_TEMPLATE.reportBox).render({item_type:data.item_type,item_id:data.item_id});break;case"topicEditHistory":var template=AW_TEMPLATE.ajaxData.replace("{{title}}",_t("编辑记录")).replace("{{data}}",data);break;case"ajaxData":var template=AW_TEMPLATE.ajaxData.replace("{{title}}",data.title).replace("{{data}}",'<div id="aw_dialog_ajax_data"></div>');break;case"imagePreview":var template=AW_TEMPLATE.ajaxData.replace("{{title}}",data.title).replace("{{data}}",'<p align="center"><img src="'+data.image+'" alt="" style="max-width:520px" /></p>');break;case"confirm":var template=Hogan.compile(AW_TEMPLATE.confirmBox).render({message:data.message});break;case"recommend":var template=Hogan.compile(AW_TEMPLATE.recommend).render();break;case"projectEventForm":var template=Hogan.compile(AW_TEMPLATE.projectEventForm).render({project_id:data.project_id,contact_name:data.contact_name,contact_tel:data.contact_tel,contact_email:data.contact_email});break;case"projectStockForm":var template=Hogan.compile(AW_TEMPLATE.projectStockForm).render({project_id:data.project_id,contact_name:data.contact_name,contact_tel:data.contact_tel,contact_email:data.contact_email});break;case"activityBox":var template=Hogan.compile(AW_TEMPLATE.activityBox).render({contact_name:data.contact_name,contact_tel:data.contact_tel,contact_qq:data.contact_qq});break;case"addTopic":var template=Hogan.compile(AW_TEMPLATE.addTopicBox).render({question_id:data.question_id})}if(template){switch($(".alert-box").length&&$(".alert-box").remove(),$("#aw-ajax-box").html(template).show(),type){case"redirect":NKR.Dropdown.bind_dropdown_list($(".aw-question-redirect-box #question-input"),"redirect");break;case"inbox":NKR.Dropdown.bind_dropdown_list($(".inbox #invite-input"),"inbox"),$("body").on("click",".inbox .lv-item",function(){$(".inbox #quick_publish input.form-control").val($(this).attr("data-username")),$(this).parents(".dropdown").removeClass("open")});break;case"publish":NKR.Dropdown.bind_dropdown_list($(".aw-publish-box #quick_publish_question_content"),"publish"),NKR.Dropdown.bind_dropdown_list($(".aw-publish-box #aw_edit_topic_title"),"topic"),1==parseInt(data.category_enable)?$.get(G_BASE_URL+"/publish/ajax/fetch_question_category/",function(result){NKR.Dropdown.set_dropdown_list(".aw-publish-box .dropdown",eval(result),data.category_id),$(".aw-publish-title .dropdown li a").click(function(){$(".aw-publish-box #quick_publish_category_id").val($(this).attr("data-value")),$(".aw-publish-box #aw-topic-tags-select").html($(this).text())})}):$(".aw-publish-box .aw-publish-title").hide(),""!=data.ask_user_id&&void 0!=data.ask_user_id&&$(".aw-publish-box .modal-title").html("向 "+data.ask_user_name+" 提问"),$("#aw-search-query").val()&&$("#aw-search-query").val()!=$("#aw-search-query").attr("placeholder")&&$("#quick_publish_question_content").val($("#aw-search-query").val()),NKR.Init.init_topic_edit_box("#quick_publish .aw-edit-topic"),$("#quick_publish .aw-edit-topic").click(),$("#quick_publish .close-edit").hide(),data.topic_title&&$("#quick_publish .aw-edit-topic").parents(".aw-topic-bar").prepend('<span class="topic-tag"><a class="text">'+data.topic_title+'</a><a class="close" onclick="$(this).parents(\'.topic-tag\').detach();"><i class="icon icon-delete"></i></a><input type="hidden" value="'+data.topic_title+'" name="topics[]" /></span>'),"undefined"!=typeof G_QUICK_PUBLISH_HUMAN_VALID&&($("#quick_publish_captcha").show(),$("#captcha").click());break;case"favorite":$.get(G_BASE_URL+"/favorite/ajax/get_favorite_tags/",function(t){var e="";$.each(t,function(t,i){e+='<li><a data-value="'+i.title+'"><i class="md md-check"></i><span class="title">'+i.title+"</span></a></li>"}),$(".aw-favorite-tag-list ul").append(e),$.post(G_BASE_URL+"/favorite/ajax/get_item_tags/",{item_id:$('#favorite_form input[name="item_id"]').val(),item_type:$('#favorite_form input[name="item_type"]').val()},function(t){t&&$.each(t,function(e,i){var a=e;$.each($(".aw-favorite-tag-list ul li .title"),function(e,i){$(this).text()==t[a]&&$(this).parents("li").addClass("active")})})},"json"),$(document).on("click",".aw-favorite-tag-list ul li a",function(){var t=this,e=!0,i=G_BASE_URL+"/favorite/ajax/update_favorite_tag/";$(this).parents("li").hasClass("active")&&(i=G_BASE_URL+"/favorite/ajax/remove_favorite_tag/",e=!1),$.post(i,{item_id:$('#favorite_form input[name="item_id"]').val(),item_type:$('#favorite_form input[name="item_type"]').val(),tags:$(t).attr("data-value")},function(i){1==i.errno&&(e?$(t).parents("li").addClass("active"):$(t).parents("li").removeClass("active"))},"json")})},"json");break;case"report":$(".aw-report-box select option").click(function(){$(".aw-report-box textarea").text($(this).attr("value"))});break;case"commentEdit":$.get(G_BASE_URL+"/question/ajax/fetch_answer_data/"+data.answer_id,function(t){$("#editor_reply").html(t.answer_content.replace("&amp;","&"));var e=CKEDITOR.replace("editor_reply");if("Y"==UPLOAD_ENABLE){var i=new FileUpload("file",".aw-edit-comment-box .upload-box .btn",".aw-edit-comment-box .upload-box .upload-container",G_BASE_URL+"/publish/ajax/attach_upload/id-answer__attach_access_key-"+ATTACH_ACCESS_KEY,{insertTextarea:".aw-edit-comment-box #editor_reply",editor:e});$.post(G_BASE_URL+"/publish/ajax/answer_attach_edit_list/","answer_id="+data.answer_id,function(t){return t.err?!1:void $.each(t.rsm.attachs,function(t,e){i.setFileList(e)})},"json")}else $(".aw-edit-comment-box .file-upload-box").hide()},"json");break;case"solutionEdit":$.get(G_BASE_URL+"/question/ajax/get_question_solution_data/"+data.question_id,function(t){$("#editor_solution").html(t.content.replace("&amp;","&"));var e=CKEDITOR.replace("editor_solution"),i=$("#solution_edit input[name=attach_access_key]").val();if("Y"==UPLOAD_ENABLE){var a=new FileUpload("file",".edit-solution-box .upload-box .btn",".edit-solution-box .upload-box .upload-container",G_BASE_URL+"/publish/ajax/attach_upload/id-solution__attach_access_key-"+i,{insertTextarea:".aw-edit-solution-box #editor_solution",editor:e});$.post(G_BASE_URL+"/publish/ajax/solution_attach_edit_list/","solution_id="+data.solution_id,function(t){return t.err||!t.rsm.attachs?!1:void $.each(t.rsm.attachs,function(t,e){a.setFileList(e)})},"json")}else $(".edit-solution-box .upload-box").hide()},"json");break;case"ajaxData":$.get(data.url,function(t){$("#aw_dialog_ajax_data").html(t)});break;case"confirm":$(".aw-confirm-box .yes").click(function(){return callback&&callback(),$(".alert-box").modal("hide"),!1});break;case"recommend":$.get(G_BASE_URL+"/help/ajax/list/",function(t){if(t&&0!=t){var e="";$.each(t,function(t,i){e+='<li class="aw-border-radius-5"><img class="aw-border-radius-5" src="'+i.icon+'"><a data-id="'+i.id+'" class="aw-hide-txt">'+i.title+'</a><i class="icon icon-followed"></i></li>'}),$(".aw-recommend-box ul").append(e),$.each($(".aw-recommend-box ul li"),function(t,e){data.focus_id==$(this).find("a").attr("data-id")&&$(this).addClass("active")}),$(document).on("click",".aw-recommend-box ul li a",function(){var t=$(this),e=G_BASE_URL+"/help/ajax/add_data/",i=!1;$(this).parents("li").hasClass("active")&&(e=G_BASE_URL+"/help/ajax/remove_data/",i=!0),$.post(e,{item_id:data.item_id,id:t.attr("data-id"),title:t.text(),type:data.type},function(e){1==e.errno&&(i?t.parents("li").removeClass("active"):($(".aw-recommend-box ul li").removeClass("active"),t.parents("li").addClass("active")))},"json")})}else $(".error_message").html(_t("请先去后台创建好章节")),"none"!=$(".error_message").css("display")?NKR.shake($(".error_message")):$(".error_message").fadeIn()},"json");break;case"addTopic":var questionId=$("#cloud-topic-list").attr("data-question-id");$("body").on("click",".cloud-topic-item",function(t){t.preventDefault();var e=$(this),i=e.attr("data-topic-id");$.get(G_BASE_URL+"/topic/ajax/toggle_question_topic_relation/topic_id-"+i+"__question_id-"+questionId,function(t){e.toggleClass("active",t.has_relation)},"json")}),NKR.load_list_view(G_BASE_URL+"/topic/ajax/get_question_cloud_topic_list/question_id-"+questionId,$("#topic-cloud-load-more"),$("#cloud-topic-list ul"),2),$.get(G_BASE_URL+"/topic/ajax/get_question_cloud_topic_list/question_id-"+questionId,function(t){$("#cloud-topic-list ul").html(t)})}$(".alert-box").modal("show")}},check_placeholder:function(t){$.each(t,function(){"undefined"!=typeof $(this).attr("placeholder")&&($(this).attr("data-placeholder","true"),""==$(this).val()&&$(this).addClass("aw-placeholder").val($(this).attr("placeholder")),$(this).focus(function(){$(this).val()==$(this).attr("placeholder")&&$(this).removeClass("aw-placeholder").val("")}),$(this).blur(function(){""==$(this).val()&&$(this).addClass("aw-placeholder").val($(this).attr("placeholder"))}))})},hightlight:function(t,e){if(t.hasClass(e))return!0;var i=setInterval(function(){t.addClass(e)},500),a=setInterval(function(){t.removeClass(e)},600);setTimeout(function(){clearInterval(i),clearInterval(a),t.addClass(e)},1200),setTimeout(function(){t.removeClass(e)},6e3)},nl2br:function(t){return t.replace(new RegExp("\r\n|\n\r|\r|\n","g"),"<br />")},content_switcher:function(t,e){t.hide(),e.removeClass("hide"),e.fadeIn()},htmlspecialchars:function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},show_card_box:function(t,e,i){if(!i)var i=300;$(document).on("mouseover",t,function(){clearTimeout(NKR.G.card_box_hide_timer);var t=$(this);NKR.G.card_box_show_timer=setTimeout(function(){function i(e,i){"user"==e&&$.get(G_BASE_URL+i+t.attr("data-id"),function(t){var e,i=t.focus;t.verified;1==i?(i="following",focusIcon="md-check",e="正在关注"):(i="",focusIcon="md-add",e="添加关注"),"enterprise"==t.verified?(verified_enterprise="icon-v i-ve",verified_title="企业认证"):"personal"==t.verified?(verified_enterprise="icon-v",verified_title="个人认证"):verified_enterprise=verified_title="";var a=G_BASE_URL+"/people/questions/id-"+t.uid+"__type-publish",o=G_BASE_URL+"/people/questions/id-"+t.uid+"__type-answered",s=G_BASE_URL+"/people/questions/id-"+t.uid+"__type-comments";$("#aw-ajax-box").html(Hogan.compile(AW_TEMPLATE.userCard).render({verified_enterprise:verified_enterprise,verified_title:verified_title,uid:t.uid,avatar_file:t.avatar_file,user_name:t.user_name,reputation:t.reputation,agree_count:t.agree_count,signature:t.signature,url:t.url,category_enable:t.category_enable,focus:i,focusIcon:focusIcon,focusTxt:e,ask_name:"'"+t.user_name+"'",fansCount:t.fans_count,success_ratio:(100*t.success_ratio).toFixed(1),poft_ratio:(100*t.poft_ratio).toFixed(1),question_count:t.question_count,answer_count:t.answer_count,quiz_count:t.quiz_count,question_count_url:a,quiz_count_url:o,answer_count_url:s})),(""==G_USER_ID||G_USER_ID==t.uid||t.uid<0)&&$("#aw-card-tips-user .mod-footer").hide(),n(),NKR.G.cashUserData.push($("#aw-ajax-box").html())},"json"),"topic"==e&&$.get(G_BASE_URL+i+t.attr("data-id"),function(t){var e,i=t.focus;0==i?(i="",e=_t("关注")):(i="active",e=_t("取消关注")),$("#aw-ajax-box").html(Hogan.compile(AW_TEMPLATE.topicCard).render({topic_id:t.topic_id,topic_pic:t.topic_pic,topic_title:t.topic_title,topic_description:t.topic_description,discuss_count:t.discuss_count,focus_count:t.focus_count,focus:i,focusTxt:e,url:t.url,fansCount:t.fans_count})),""==G_USER_ID&&$("#aw-card-tips .follow").hide(),n(),NKR.G.cashTopicData.push($("#aw-ajax-box").html())},"json")}function a(e){"user"==e&&$.each(NKR.G.cashUserData,function(e,i){i.match('data-id="'+t.attr("data-id")+'"')&&($("#aw-ajax-box").html(i),$("#aw-card-tips").removeAttr("style"),n(),o=1)}),"topic"==e&&$.each(NKR.G.cashTopicData,function(e,i){i.match('data-id="'+t.attr("data-id")+'"')&&($("#aw-ajax-box").html(i),$("#aw-card-tips").removeAttr("style"),n(),o=1)})}function n(){$(".user-pie-ratio")[0]&&NKR.showpie("user-pie-ratio",100);var e=t.offset().left,i=t.offset().top+t.height()+5,a=t.offset().top-$(window).scrollTop();a+$("#aw-card-tips").innerHeight()>$(window).height()&&(i=t.offset().top-$("#aw-card-tips").innerHeight()-10),e+$("#aw-card-tips").innerWidth()>$(window).width()&&(e=t.offset().left-$("#aw-card-tips").innerWidth()+t.innerWidth()),$("#aw-card-tips").css({left:e,top:i}).fadeIn()}if(t.attr("data-id"))switch(e){case"user":if(0==NKR.G.cashUserData.length)i("user","/people/ajax/user_info/uid-");else{var o=0;a("user"),0==o&&i("user","/people/ajax/user_info/uid-")}break;case"topic":if(0==NKR.G.cashTopicData.length)i("topic","/topic/ajax/topic_info/topic_id-");else{var o=0;a("topic"),0==o&&i("topic","/topic/ajax/topic_info/topic_id-")}}},i)}),$(document).on("mouseout",t,function(){clearTimeout(NKR.G.card_box_show_timer),NKR.G.card_box_hide_timer=setTimeout(function(){$("#aw-card-tips").fadeOut()},600)})},at_user_lists:function(t,e){function i(){$(".content_cursor")[0]||$("#aw-ajax-box").append('<span class="content_cursor"></span>'),$("#aw-ajax-box").find(".content_cursor").css({left:parseInt($(t).offset().left+parseInt($(t).css("padding-left"))+2),top:parseInt($(t).offset().top+parseInt($(t).css("padding-left")))}),$(".aw-invite-dropdown")[0]||$("#aw-ajax-box").append('<ul class="aw-invite-dropdown"></ul>')}function a(){$(".aw-invite-dropdown").css({left:$(".content_cursor").offset().left+$(".content_cursor").innerWidth(),top:$(".content_cursor").offset().top+24}).show()}function n(t){var e={text:"",start:0,end:0};if(t.focus(),t.setSelectionRange)e.start=t.selectionStart,e.end=t.selectionEnd,e.text=e.start!=e.end?t.value.substring(e.start,e.end):"";else if(document.selection){var i,a=document.selection.createRange(),n=document.body.createTextRange();for(n.moveToElementText(t),e.text=a.text,e.bookmark=a.getBookmark(),i=0;n.compareEndPoints("StartToStart",a)<0&&0!==a.moveStart("character",-1);i++)"\n"==t.value.charAt(i)&&i++;e.start=i,e.end=e.text.length+e.start}return e}$(t).keyup(function(t){var o=$(this),s=n($(this)[0]).start;if("@"==$(this).val().charAt(s-1))i(),$("#aw-ajax-box .content_cursor").html($(this).val().substring(0,s));else{var r=$(".aw-invite-dropdown li");switch(t.which){case 38:var c;r.hasClass("active")?($.each(r,function(t,e){$(this).hasClass("active")&&($(this).removeClass("active"),c=0==$(this).index()?r.length-1:$(this).index()-1)}),r.eq(c).addClass("active")):r.eq(r.length-1).addClass("active");break;case 40:var c;r.hasClass("active")?($.each(r,function(t,e){$(this).hasClass("active")&&($(this).removeClass("active"),c=$(this).index()==r.length-1?0:$(this).index()+1)}),r.eq(c).addClass("active")):r.eq(0).addClass("active");break;case 13:$.each($(".aw-invite-dropdown li"),function(t,e){$(this).hasClass("active")&&$(this).click()});break;default:if($(".aw-invite-dropdown")[0]){for(var d=0,l=s;l>0;l--)if("@"==$(this).val().charAt(l)){d=l;break}$.get(G_BASE_URL+"/search/ajax/search/?type=users&q="+encodeURIComponent($(this).val().substring(s,d).replace("@",""))+"&limit="+e,function(t){if($(".aw-invite-dropdown")[0])if(0!=t.length){var e="";$(".aw-invite-dropdown").html(""),$.each(t,function(t,i){e+='<li><img src="'+i.detail.avatar_file+'"/><a>'+i.name+"</a></li>"}),$(".aw-invite-dropdown").append(e),a(),$(".aw-invite-dropdown li").click(function(){o.val(o.val().substring(0,d)+"@"+$(this).find("a").html()+" ").focus(),$(".aw-invite-dropdown").detach()})}else $(".aw-invite-dropdown").hide();0==o.val().length&&$(".aw-invite-dropdown").hide()},"json")}}}}),$(t).keydown(function(t){var e=t.which;return!$(".aw-invite-dropdown").is(":visible")||38!=e&&40!=e&&13!=e?void 0:!1})},shake:function(t){var e=6;t.css("position","relative");for(var i=1;e>=i;i++)i%2==0?i==e?t.animate({left:0},50):t.animate({left:10},50):t.animate({left:-10},50)}};NKR.G={cashUserData:[],cashTopicData:[],card_box_hide_timer:"",card_box_show_timer:"",dropdown_list_xhr:"",loading_timer:"",loading_bg_count:12,loading_mini_bg_count:9,notification_timer:"",user_quiz_message_timer:""},NKR.User={follow:function(t,e,i){if(G_USER_ID<=0)return void(window.location=G_BASE_URL+"/account/login/");switch(t.addClass("disabled"),
e){case"question":var a="/question/ajax/focus/",n={question_id:i};break;case"topic":var a="/topic/ajax/focus_topic/",n={topic_id:i};break;case"user":var a="/follow/ajax/follow_people/",n={uid:i}}$.post(G_BASE_URL+a,n,function(e){1==e.errno?"add"==e.rsm.type?t.addClass("following"):t.removeClass("following"):(e.err&&NKR.alert(e.err),e.rsm.url&&(window.location=decodeURIComponent(e.rsm.url))),t.removeClass("disabled"),t.html()?t.hasClass("following")?t.text("已关注"):t.text("+ 关注"):t.hasClass("following")?t.attr("data-original-title","正在关注"):t.attr("data-original-title","添加关注")},"json")},share_out:function(t){var e=e||window.location.href;if(t.title)var i=t.title+" - "+G_SITE_NAME;else var i=$("title").text();shareURL="http://www.jiathis.com/send/?webid="+t.webid+"&url="+e+"&title="+i,t.content&&$(t.content).find("img").length&&(shareURL=shareURL+"&pic="+$(t.content).find("img").eq(0).attr("src")),window.open(shareURL)},delete_draft:function(t,e){"clean"==e?$.post(G_BASE_URL+"/account/ajax/delete_draft/","type="+e,function(t){1!=t.errno&&NKR.alert(t.err)},"json"):$.post(G_BASE_URL+"/account/ajax/delete_draft/","item_id="+t+"&type="+e,function(t){1!=t.errno&&NKR.alert(t.err)},"json")},agree_vote:function(t,e,i){var a=$(t);$.post(G_BASE_URL+"/question/ajax/answer_vote/","answer_id="+i+"&value=1");var n=a.find(".count"),o=a.find("span"),s=a.attr("data-agreed"),r=parseInt(n.html());s>0?(r>0&&n.html(r-1),o.html("赞同"),a.removeClass("active"),a.attr("data-agreed",0)):(n.html(r+1),o.html("已赞同"),a.addClass("active"),a.attr("data-agreed",1))},disagree_vote:function(t,e,i){$.post(G_BASE_URL+"/question/ajax/answer_vote/","answer_id="+i+"&value=-1",function(t){}),$(t).hasClass("active")?$(t).removeClass("active"):$(t).parents(".operate").find(".agree").hasClass("active")?($.each($(t).parents(".aw-item").find(".aw-user-name"),function(t,i){$(i).html()==e&&($(i).prev()?$(i).prev().remove():$(i).next().remove(),$(i).remove())}),0==$(t).parents(".aw-item").find(".aw-agree-by a").length&&$(t).parents(".aw-item").find(".aw-agree-by").hide(),$(t).parents(".operate").find(".count").html(parseInt($(t).parents(".operate").find(".count").html())-1),$(t).parents(".operate").find(".agree").removeClass("active"),$(t).addClass("active")):$(t).addClass("active")},question_uninterested:function(t,e){t.fadeOut(),$.post(G_BASE_URL+"/question/ajax/uninterested/","question_id="+e,function(t){"1"!=t.errno&&NKR.alert(t.err)},"json")},answer_force_fold:function(t,e){$.post(G_BASE_URL+"/question/ajax/answer_force_fold/","answer_id="+e,function(e){1!=e.errno?NKR.alert(e.err):1==e.errno&&("fold"==e.rsm.action?t.html(t.html().replace(_t("折叠"),_t("撤消折叠"))):t.html(t.html().replace(_t("撤消折叠"),_t("折叠"))))},"json")},question_invite_delete:function(t,e){$.post(G_BASE_URL+"/question/ajax/question_invite_delete/","question_invite_id="+e,function(e){1==e.errno?t.fadeOut():NKR.alert(e.rsm.err)},"json")},invite_user:function(t,e){return G_USER_ID<=0?void(window.location=G_BASE_URL+"/account/login/"):void $.post(G_BASE_URL+"/question/ajax/save_invite/",{question_id:QUESTION_ID,uid:t.attr("data-id")},function(i){-1!=i.errno?(0==t.parents(".aw-invite-box").find(".invite-list a").length&&t.parents(".aw-invite-box").find(".invite-list").show(),t.parents(".aw-invite-box").find(".invite-list").append(' <a class="text-color-999 invite-list-user" data-toggle="tooltip" data-placement="bottom" data-original-title="'+t.attr("data-value")+'"><img src='+e+" /></a>"),t.addClass("active").attr("onclick","NKR.User.disinvite_user($(this))").text("取消邀请"),t.parents(".aw-question-detail").find(".aw-invite-replay .badge").text(parseInt(t.parents(".aw-question-detail").find(".aw-invite-replay .badge").text())+1)):-1==i.errno&&NKR.alert(i.err)},"json")},disinvite_user:function(t){$.get(G_BASE_URL+"/question/ajax/cancel_question_invite/question_id-"+QUESTION_ID+"__recipients_uid-"+t.attr("data-id"),function(e){-1!=e.errno&&($.each($(".aw-question-detail .invite-list a"),function(e,i){$(this).attr("data-original-title")==t.parents(".main").find(".aw-user-name").text()&&$(this).detach()}),t.removeClass("active").attr("onclick","NKR.User.invite_user($(this),$(this).parents('li').find('img').attr('src'))").text("邀请"),t.parents(".aw-question-detail").find(".aw-invite-replay .badge").text(parseInt(t.parents(".aw-question-detail").find(".aw-invite-replay .badge").text())-1),0==t.parents(".aw-invite-box").find(".invite-list").children().length&&t.parents(".aw-invite-box").find(".invite-list").hide())})},question_thanks:function(t,e){$.post(G_BASE_URL+"/question/ajax/question_thanks/","question_id="+e,function(e){1!=e.errno?NKR.alert(e.err):"add"==e.rsm.action?(t.html(t.html().replace(_t("感谢"),_t("已感谢"))),t.removeAttr("onclick")):t.html(t.html().replace(_t("已感谢"),_t("感谢")))},"json")},answer_user_rate:function(t,e,i){$.post(G_BASE_URL+"/question/ajax/question_answer_rate/","type="+e+"&answer_id="+i,function(i){if(1!=i.errno)NKR.alert(i.err);else if(1==i.errno)switch(e){case"thanks":"add"==i.rsm.action?(t.html(t.html().replace(_t("感谢"),_t("已感谢"))),t.removeAttr("onclick")):t.html(t.html().replace(_t("已感谢"),_t("感谢")));break;case"uninterested":"add"==i.rsm.action?t.html(t.html().replace(_t("没有帮助"),_t("撤消没有帮助"))):t.html(t.html().replace(_t("撤消没有帮助"),_t("没有帮助")))}},"json")},remove_answer:function(t,e){$.get(G_BASE_URL+"/question/ajax/remove_answer/answer_id-"+e),t.parents("li.comment-item[id=comment-id-"+e+"]").addClass("animated fadeOutLeft").fadeOut(300,function(){$(this).remove()})},save_comment:function(t){t.attr("disabled","disabled"),NKR.ajax_post(t.parents("form"),NKR.ajax_processer,"comments_form")},remove_comment:function(t,e,i){$.get(G_BASE_URL+"/question/ajax/remove_comment/type-"+e+"__comment_id-"+i),t.parents(".ci-subitem").fadeOut(300,function(){$(this).remove()})},article_vote:function(t,e,i){if(G_USER_ID<=0)return void(window.location=G_BASE_URL+"/account/login/");if(NKR.loading("show"),t.hasClass("active"))var i=0;$.post(G_BASE_URL+"/article/ajax/article_vote/","type=article&item_id="+e+"&rating="+i,function(e){NKR.loading("hide"),1!=e.errno?NKR.alert(e.err):0==i?t.removeClass("active").find("b").html(parseInt(t.find("b").html())-1):-1==i?(t.parents(".aw-article-vote").find(".agree").hasClass("active")&&(t.parents(".aw-article-vote").find("b").html(parseInt(t.parents(".aw-article-vote").find("b").html())-1),t.parents(".aw-article-vote").find("a").removeClass("active")),t.addClass("active")):(t.parents(".aw-article-vote").find("a").removeClass("active"),t.addClass("active").find("b").html(parseInt(t.find("b").html())+1))},"json")},article_comment_vote:function(t,e,i){if(G_USER_ID<=0)return void(window.location=G_BASE_URL+"/account/login/");NKR.loading("show");var a=t.find("span");if(t.hasClass("active"))var i=0;$.post(G_BASE_URL+"/article/ajax/article_vote/","type=comment&item_id="+e+"&rating="+i,function(e){NKR.loading("hide"),1!=e.errno?NKR.alert(e.err):0==i?(t.attr("data-original-title","赞同").removeClass("active").find("b").html(parseInt(t.find("b").html())-1),a.html("赞同")):(t.attr("data-original-title","取消赞同").addClass("active").find("b").html(parseInt(t.find("b").html())+1),a.html("已赞同"))},"json")},add_favorite_tag:function(){$.post(G_BASE_URL+"/favorite/ajax/update_favorite_tag/",{item_id:$('#favorite_form input[name="item_id"]').val(),item_type:$('#favorite_form input[name="item_type"]').val(),tags:$("#favorite_form .add-input").val()},function(t){-1==t.errno?NKR.alert(t.err):1==t.errno&&($(".aw-favorite-box .aw-favorite-tag-list").show(),$(".aw-favorite-box .aw-favorite-tag-add").hide(),$(".aw-favorite-tag-list ul").prepend('<li class="active"><a data-value="'+$("#favorite_form .add-input").val()+'"><i class="md md-check"></i><span class="title">'+$("#favorite_form .add-input").val()+"</span></a></li>"))},"json")},update_signature:function(){if(G_USER_ID<0)return void window.location.reload();var t=$("#user-signature-input").val();$.post(G_BASE_URL+"/account/ajax/update_signature/",{signature:t},function(e){-1==e.errno?NKR.alert(e.err):1==e.errno&&($(".user-signature span.signature").html(t),$(".dropdown.pmop-message.user-signature-dialog").removeClass("open"))},"json")}},NKR.Dropdown={bind_dropdown_list:function(t,e){"search"==e&&$(t).focus(function(){$(t).closest(".dropdown").addClass("open")}),$(t).keyup(function(i){if($(t).closest(".dropdown").addClass("open"),"search"==e&&$(t).parent().find(".search").show().children("a").text($(t).val()),$(t).val().length>=1?38!=i.which&&40!=i.which&&188!=i.which&&13!=i.which&&NKR.Dropdown.get_dropdown_list($(this),e,$(t).val()):$(t).closest(".dropdown").removeClass("open"),"topic"==e){if(188==i.which)return","!=$(".aw-edit-topic-box #aw_edit_topic_title").val()&&($(".aw-edit-topic-box #aw_edit_topic_title").val($(".aw-edit-topic-box #aw_edit_topic_title").val().substring(0,$(".aw-edit-topic-box #aw_edit_topic_title").val().length-1)),$(".aw-edit-topic-box .aw-dropdown").hide(),$(".aw-edit-topic-box .add").click()),!1;if(13==i.which)return $(".aw-edit-topic-box .aw-dropdown").hide(),$(".aw-edit-topic-box .add").click(),!1;var a=$(t).parent().find(".aw-dropdown-list li");if(40==i.which&&a.is(":visible")){var n;a.hasClass("active")?($.each(a,function(t,e){$(this).hasClass("active")&&($(this).removeClass("active"),n=$(this).index()==a.length-1?0:$(this).index()+1)}),a.eq(n).addClass("active"),$(t).val(a.eq(n).text())):a.eq(0).addClass("active")}if(38==i.which&&a.is(":visible")){var n;a.hasClass("active")?($.each(a,function(t,e){$(this).hasClass("active")&&($(this).removeClass("active"),n=0==$(this).index()?a.length-1:$(this).index()-1)}),a.eq(n).addClass("active"),$(t).val(a.eq(n).text())):a.eq(a.length-1).addClass("active")}}}),$(t).blur(function(){})},set_dropdown_list:function(t,e,i){$(t).append(Hogan.compile(AW_TEMPLATE.dropdownList).render({items:e})),$(t+" .aw-dropdown-list li a").click(function(){$("#aw-topic-tags-select").html($(this).text())}),i&&$(t+" .dropdown-menu li a[data-value='"+i+"']").click()},get_dropdown_list:function(t,e,i){""!=NKR.G.dropdown_list_xhr&&NKR.G.dropdown_list_xhr.abort();var a,n="没有找到相关结果";switch(e){case"search":a=G_BASE_URL+"/search/ajax/search/?q="+encodeURIComponent(i)+"&limit=5";break;case"publish":a=G_BASE_URL+"/search/ajax/search/?type=questions&q="+encodeURIComponent(i)+"&limit=5";break;case"redirect":a=G_BASE_URL+"/search/ajax/search/?q="+encodeURIComponent(i)+"&type=questions&limit=30&is_question_id=1";break;case"invite":a=G_BASE_URL+"/search/ajax/search/?type=users&q="+encodeURIComponent(i)+"&limit=10",n="没有找到你想邀请的人";break;case"inbox":a=G_BASE_URL+"/search/ajax/search/?type=users&q="+encodeURIComponent(i)+"&limit=10",n="没有找到相关的人";break;case"topic_question":a=G_BASE_URL+"/search/ajax/search/?type=questions,articles&q="+encodeURIComponent(i)+"&topic_ids="+CONTENTS_RELATED_TOPIC_IDS+"&limit=50";break;case"topic":a=G_BASE_URL+"/search/ajax/search/?type=topics&q="+encodeURIComponent(i)+"&limit=10";break;case"questions":a=G_BASE_URL+"/search/ajax/search/?type=questions&q="+encodeURIComponent(i)+"&limit=10";break;case"articles":a=G_BASE_URL+"/search/ajax/search/?type=articles&q="+encodeURIComponent(i)+"&limit=10"}NKR.G.dropdown_list_xhr=$.get(a,function(a){if(0!=a.length&&void 0!=NKR.G.dropdown_list_xhr){switch($(t).parent().find(".aw-dropdown-list").html(""),e){case"search":$.each(a,function(e,i){switch(i.type){case"questions":if(i.detail.best_answer>0)var a="active";else var a="";$(t).parent().find(".aw-dropdown-list").append(Hogan.compile(AW_TEMPLATE.searchDropdownListQuestions).render({url:i.url,active:a,content:i.name,discuss_count:i.detail.answer_count}));break;case"articles":$(t).parent().find(".aw-dropdown-list").append(Hogan.compile(AW_TEMPLATE.searchDropdownListArticles).render({url:i.url,content:i.name,comments:i.detail.comments}));break;case"topics":$(t).parent().find(".aw-dropdown-list").append(Hogan.compile(AW_TEMPLATE.searchDropdownListTopics).render({url:i.url,name:i.name,focus_count:i.detail.focus_count,topic_id:i.detail.topic_id}));break;case"users":var n=i.detail.signature;$(t).parent().find(".aw-dropdown-list").append(Hogan.compile(AW_TEMPLATE.searchDropdownListUsers).render({url:i.url,img:i.detail.avatar_file,name:i.name,intro:n}))}});break;case"publish":case"topic_question":$.each(a,function(e,i){$(t).parent().find(".aw-dropdown-list").append(Hogan.compile(AW_TEMPLATE.questionDropdownList).render({url:i.url,name:i.name}))});break;case"topic":$.each(a,function(e,i){$(t).parent().find(".aw-dropdown-list").append(Hogan.compile(AW_TEMPLATE.editTopicDorpdownList).render({name:i.name}))});break;case"redirect":$.each(a,function(e,i){$(t).parent().find(".aw-dropdown-list").append(Hogan.compile(AW_TEMPLATE.questionRedirectList).render({url:"'"+G_BASE_URL+"/question/ajax/redirect/', 'item_id="+$(t).attr("data-id")+"&target_id="+i.search_id+"'",name:i.name}))});break;case"questions":case"articles":$.each(a,function(e,i){$(t).parent().find(".aw-dropdown-list").append(Hogan.compile(AW_TEMPLATE.questionDropdownList).render({url:"#",name:i.name}))});break;case"inbox":$.each(a,function(e,i){var a=i.detail.signature;$(t).parent().find(".aw-dropdown-list").append(Hogan.compile(AW_TEMPLATE.inboxDropdownList).render({uid:i.uid,name:i.name,img:i.detail.avatar_file,intro:a}))});break;case"invite":$.each(a,function(e,i){var a=i.detail.signature;$(t).parent().find(".aw-dropdown-list").append(Hogan.compile(AW_TEMPLATE.inviteDropdownList).render({uid:i.uid,name:i.name,img:i.detail.avatar_file,intro:a,url:i.url}))})}"publish"==e?$(t).parent().find(".aw-publish-suggest-question, .aw-publish-suggest-question .aw-dropdown-list").show():($(t).parent().find(".aw-dropdown, .aw-dropdown-list").show().children().show(),$(t).parent().find(".title").hide(),$(t).parent().find(".aw-dropdown-list li.question a").highText(i,"b","active"))}else $(t).parent().find(".aw-dropdown").show().end().find(".title").html(n).show(),$(t).parent().find(".aw-dropdown-list, .aw-publish-suggest-question").hide()},"json")}},NKR.Notifcation={load:function(){G_USER_ID>0&&$("#header-notifications").length&&$.get(G_BASE_URL+"/notifications/ajax/header_list/flag-0__limit-5",function(t){t.length?$("#header-notifications").html(t):$("#header-notifications").html('<p class="no-notification">没有未读消息</p>')})},check_notifications:function(){return 0==G_USER_ID?(clearInterval(NKR.G.notification_timer),!1):void $.get(G_BASE_URL+"/home/ajax/notifications/",function(t){$("#inbox_unread").html(Number(t.rsm.inbox_num)),$("#inbox_unread_mobile").html(Number(t.rsm.inbox_num));var e=G_UNREAD_NOTIFICATION;if(G_UNREAD_NOTIFICATION=Number(t.rsm.notifications_num),G_UNREAD_NOTIFICATION>0){G_UNREAD_NOTIFICATION!=e&&(NKR.Message.load_notification_list(),$("#notifications_unread").html(G_UNREAD_NOTIFICATION),$("#notifications_unread_mobile").html(G_UNREAD_NOTIFICATION));var i=Number(t.rsm.notifications_num)+Number(t.rsm.inbox_num);document.title="("+i+") "+document_title,$("#notifications_unread").show(),$("#notifications_unread_mobile").show()}else $("#header_notification_list").length&&$("#header_notification_list").html(""),$("#index_notification").length&&$("#index_notification").fadeOut(),document.title=document_title,$("#notifications_unread").hide(),$("#notifications_unread_mobile").hide();Number(t.rsm.inbox_num)>0?($("#inbox_unread").removeClass("hide"),$("#inbox_unread_mobile").removeClass("hide")):($("#inbox_unread").addClass("hide"),$("#inbox_unread_mobile").addClass("hide"))},"json")},read_notification:function(t,e,i){if(e){t.remove();var a=G_BASE_URL+"/notifications/ajax/read_notification/notification_id-"+e}else{$("#index_notification").length&&$("#index_notification").fadeOut();var a=G_BASE_URL+"/notifications/ajax/read_notification/"}$.get(a,function(t){NKR.Message.check_notifications(),i&&window.location.reload()})},notification_show:function(t){$("#index_notification").length>0&&(0==$("#index_notification ul#notification_list li").length?$("#index_notification").fadeOut():$("#index_notification ul#notification_list li").each(function(e,i){t>e?$(i).show():$(i).hide()}))}},NKR.Init={init_comment_box:function(t){$(document).on("click",t,function(){if($(this).parents(".aw-question-detail").find(".aw-invite-box, .aw-question-related-box").hide(),"undefined"!=typeof COMMENT_UNFOLD&&"all"==COMMENT_UNFOLD&&0==$(this).attr("data-comment-count")&&"hide"==$(this).attr("data-first-click"))return $(this).removeAttr("data-first-click"),!1;if(!$(this).attr("data-type")||!$(this).attr("data-id"))return!0;var t="#aw-comment-box-"+$(this).attr("data-type")+"-"+$(this).attr("data-id");if($(t).length)"none"==$(t).css("display")?($(this).addClass("active"),$(t).fadeIn()):($(this).removeClass("active"),$(t).fadeOut());else{switch($(this).attr("data-type")){case"question":var e=G_BASE_URL+"/question/ajax/save_question_comment/question_id-"+$(this).attr("data-id"),i=G_BASE_URL+"/question/ajax/get_question_comments/question_id-"+$(this).attr("data-id");break;case"answer":var e=G_BASE_URL+"/question/ajax/save_answer_comment/answer_id-"+$(this).attr("data-id"),i=G_BASE_URL+"/question/ajax/get_answer_comments/answer_id-"+$(this).attr("data-id")}G_USER_ID?($(this).parents(".aw-item").find(".mod-footer").append(Hogan.compile(AW_TEMPLATE.commentBox).render({comment_form_id:t.replace("#",""),comment_form_action:e})),$(t).find(".aw-comment-txt").bind({focus:function(){$(t).find(".aw-comment-box-btn").show()},blur:function(){""==$(this).val()&&$(t).find(".aw-comment-box-btn").hide()}}),$(t).find(".close-comment-box").click(function(){$(t).fadeOut(),$(t).find(".aw-comment-txt").css("height",$(this).css("line-height"))})):$(this).parents(".aw-item").find(".mod-footer").append(Hogan.compile(AW_TEMPLATE.commentBoxClose).render({comment_form_id:t.replace("#",""),comment_form_action:e})),$.get(i,function(e){""==$.trim(e)&&(e='<div align="center" class="aw-padding10">'+_t("暂无评论")+"</div>"),$(t).find(".aw-comment-list").html(e)}),$(t).find(".aw-comment-txt").autosize(),$(this).addClass("active"),NKR.at_user_lists(t+" .aw-comment-txt",5)}NKR.at_user_lists($(this).parents(".aw-item").find(".aw-comment-txt"))})},init_article_comment_box:function(t){$(document).on("click",t,function(){var t=$(this).closest(".comment-item").find(".article-reply-comment-box");t.length?"block"==t.css("display")?t.fadeOut():t.fadeIn():$(this).closest(".comment-item").find(".media-body").append(Hogan.compile(AW_TEMPLATE.articleCommentBox).render({at_uid:$(this).attr("data-id"),article_id:ARTICLE_ID}))})},init_topic_edit_box:function(t){$(t).click(function(){var t=$(this).parents(".aw-topic-bar"),e=t.attr("data-id"),i=t.attr("data-type");t.hasClass("active")?t.addClass("active"):(t.addClass("active"),t.find(".topic-tag .close").length||t.find(".topic-tag").append('<a class="close"><i class="icon icon-delete"></i></a>')),0==t.find(".aw-edit-topic-box").length&&(t.append(AW_TEMPLATE.editTopicBox),t.find(".add").click(function(){if(""!=t.find("#aw_edit_topic_title").val())switch(i){case"publish":t.find(".tag-bar").prepend('<span class="topic-tag"><a class="text">'+t.find("#aw_edit_topic_title").val()+'</a><a class="close" onclick="$(this).parents(\'.topic-tag\').remove();"><i class="icon icon-delete"></i></a><input type="hidden" value="'+t.find("#aw_edit_topic_title").val()+'" name="topics[]" /></span>').hide().fadeIn(),t.find("#aw_edit_topic_title").val("");break;case"question":$.post(G_BASE_URL+"/topic/ajax/save_topic_relation/","type=question&item_id="+e+"&topic_title="+encodeURIComponent(t.find("#aw_edit_topic_title").val()),function(e){return 1!=e.errno?(NKR.alert(e.err),!1):(t.find(".tag-bar").prepend('<span class="topic-tag" data-id="'+e.rsm.topic_id+'"><a href="'+G_BASE_URL+"/topic/"+e.rsm.topic_id+'" class="text">'+t.find("#aw_edit_topic_title").val()+'</a><a class="close"><i class="icon icon-delete"></i></a></span>').hide().fadeIn(),void t.find("#aw_edit_topic_title").val(""))},"json");break;case"article":$.post(G_BASE_URL+"/topic/ajax/save_topic_relation/","type=article&item_id="+e+"&topic_title="+encodeURIComponent(t.find("#aw_edit_topic_title").val()),function(e){return 1!=e.errno?(NKR.alert(e.err),!1):(t.find(".tag-bar").prepend('<span class="topic-tag" data-id="'+e.rsm.topic_id+'"><a href="'+G_BASE_URL+"/topic/"+e.rsm.topic_id+'" class="text">'+t.find("#aw_edit_topic_title").val()+'</a><a class="close"><i class="icon icon-delete"></i></a></span>').hide().fadeIn(),void t.find("#aw_edit_topic_title").val(""))},"json");break;case"topic":$.post(G_BASE_URL+"/topic/ajax/save_related_topic/topic_id-"+e,"topic_title="+encodeURIComponent(t.find("#aw_edit_topic_title").val()),function(e){return 1!=e.errno?(NKR.alert(e.err),!1):(t.find(".tag-bar").prepend('<span class="topic-tag"><a href="'+G_BASE_URL+"/favorite/tag-"+encodeURIComponent(t.find("#aw_edit_topic_title").val())+'" class="text">'+t.find("#aw_edit_topic_title").val()+'</a><a class="close"><i class="icon icon-delete"></i></a></span>').hide().fadeIn(),void t.find("#aw_edit_topic_title").val(""))},"json");break;case"favorite":$.post(G_BASE_URL+"/favorite/ajax/update_favorite_tag/","item_id="+e+"&item_type="+t.attr("data-item-type")+"&tags="+encodeURIComponent(t.find("#aw_edit_topic_title").val()),function(e){return 1!=e.errno?(NKR.alert(e.err),!1):(t.find(".tag-bar").prepend('<span class="topic-tag"><a href="'+G_BASE_URL+"/favorite/tag-"+encodeURIComponent(t.find("#aw_edit_topic_title").val())+'" class="text">'+t.find("#aw_edit_topic_title").val()+'</a><a class="close"><i class="icon icon-delete"></i></a></span>').hide().fadeIn(),void t.find("#aw_edit_topic_title").val(""))},"json")}}),t.find(".close-edit").click(function(){t.removeClass("active"),t.find(".aw-edit-topic-box").hide(),t.find(".aw-edit-topic").show()}),NKR.Dropdown.bind_dropdown_list($(this).parents(".aw-topic-bar").find("#aw_edit_topic_title"),"topic")),$(this).parents(".aw-topic-bar").find(".aw-edit-topic-box").fadeIn(),G_CAN_CREATE_TOPIC||$(this).parents(".aw-topic-bar").find(".add").hide(),$(this).hide()})}},function(t){t.fn.extend({insertAtCaret:function(e){var i=t(this).get(0);if(document.all&&i.createTextRange&&i.caretPos){var a=i.caretPos;a.text=""==a.text.charAt(a.text.length-1)?e+"":e}else if(i.setSelectionRange){var n=i.selectionStart,o=i.selectionEnd,s=i.value.substring(0,n),r=i.value.substring(o);i.value=s+e+r,i.focus();var c=e.length;i.setSelectionRange(n+c,n+c),i.blur()}else i.value+=e},highText:function(e,i,a){return this.each(function(){t(this).html(function(e,i,a,n){var o=i.replace(/\b(\w+)\b/g,"($1)").replace(/\s+/g,"|");return e.replace(new RegExp(o,"ig"),function(e){return t("<"+a+" class="+n+">"+e+"</"+a+">").outerHTML()})}(t(this).text(),e,i,a))})},outerHTML:function(t){return t?this.before(t).remove():jQuery("<p>").append(this.eq(0).clone()).html()}}),t.extend({scrollTo:function(e,i,a){t("html, body").animate({scrollTop:e},{duration:i,queue:a.queue})}})}(jQuery),$(document).ready(function(){function t(){for(var t="",e=["category","quiztype","difficulty","countdown"],i=0;i<e.length;i++){var a=$(".qf-"+e[i]+".active"),n="";1!=a.length&&(n+="");var o=a.attr("data-id");n+="undefined"==typeof o?"":e[i]+"-"+o,n.length&&(t+=n+"__")}var s=$("#qf-record").attr("data-filter-type");"undefined"!=typeof s&&""!=s&&(t+="urecord-"+s+"__");var r=$("#qf-date").attr("data-filter-type");"undefined"!=typeof r&&""!=r&&(t+="date-"+r+"__");var c=$("#qs-sort");1!=c.length&&(t+="");var d=c.attr("data-sort-type");return t+="undefined"==typeof d||""==d?"":"sort_type-"+d+"__",t=t.replace(/(__$)/g,""),t=t.replace(/(^__)/g,"")}var e=$("#question-select");0!=e.length&&($(".question-select-wrap").height(e.height()),e.affix({offset:{top:e.offset().top}})),$("#question-filter").on("click",".qf-list > li",function(t){t.preventDefault(),$(this).addClass("active").siblings().removeClass("active")}),$("#qf-apply").on("click",function(){window.location.href=G_BASE_URL+"/question/"+t()}),$("#qs-sort").on("click","a",function(e){var i=$("#qs-sort");e.preventDefault(),i.attr("data-sort-type",$(this).attr("data-sort-type")),window.location.href=G_BASE_URL+"/question/"+t()}),$("#qf-date").on("click","a",function(e){var i=$("#qf-date");e.preventDefault(),i.attr("data-filter-type",$(this).attr("data-filter-type")),window.location.href=G_BASE_URL+"/question/"+t()}),$("#qf-record").on("click","a",function(e){var i=$("#qf-record"),a=$(this).attr("data-filter-type");return e.preventDefault(),""!=a&&G_USER_ID<=0?void(window.location.href=G_BASE_URL+"/account/login/"):(i.attr("data-filter-type",a),void(window.location.href=G_BASE_URL+"/question/"+t()))})}),$(document).ready(function(){function t(){$(".countdown-timer").addClass("active"),i()}function e(t){var e=$("#countdown-timer").attr("data-countdown");timer='<li><div class="easy-pie countdown-hour" data-percent="100"><div class="dial hour">60</div><div class="dial-title">时</div></div></li><li><div class="easy-pie countdown-minute" data-percent="100"><div class="dial minute">60</div><div class="dial-title">分</div></div></li><li><div class="easy-pie countdown-second" data-percent="100"><div class="dial second">60</div><div class="dial-title">秒</div></div></li>',$("#countdown-timer").html(timer);var i=parseInt(e/3600),a=parseInt(e/60),n=parseInt(e%60),o=$("#countdown-timer .countdown-hour").attr("data-percent",5*(60-i)/3);$("#countdown-timer .dial.hour").text(i),$("#countdown-timer .countdown-minute").attr("data-percent",5*(60-a)/3),$("#countdown-timer .dial.minute").text(a),$("#countdown-timer .countdown-second").attr("data-percent",5*(60-n)/3),$("#countdown-timer .dial.second").text(n),i>0?o.parents("li").show():o.parents("li").hide();var s="#eee",r="rgba(255,255,255,0)",c="#03A9F4";$("#countdown-timer .easy-pie").easyPieChart({trackColor:s,scaleColor:r,barColor:c,lineWidth:2,animate:{duration:100},lineCap:"butt",size:t})}function i(){var t=$(".countdown-timer.active");0!=t.length&&($(".countdown-timer-wrap").height(t.height()),t.on("affixed.bs.affix",function(){e(60)}),t.on("affixed-top.bs.affix",function(){e(90)}),t.affix({offset:{top:t.offset().top}}))}function a(t){$("#countdown-timer").attr("data-countdown",t);var e=parseInt(t/3600),i=parseInt(t/60),a=parseInt(t%60),n=$("#countdown-timer .countdown-hour"),o=$("#countdown-timer .dial.hour"),s=$("#countdown-timer .countdown-minute"),r=$("#countdown-timer .dial.minute"),c=$("#countdown-timer .countdown-second"),d=$("#countdown-timer .dial.second");e>0?n.parents("li").show():n.parents("li").hide();var l="#03A9F4";r.removeClass("c-red"),0==e&&0==i&&(l="#f44336",r.addClass("c-red"));var u="#03A9F4";d.removeClass("c-orange").removeClass("c-red"),0==e&&0==i&&10>=a&&a>0?(u="#FFC107",d.addClass("c-orange")):0==e&&0==i&&0==a&&(u="#f44336",d.addClass("c-red")),s.data("easyPieChart").options.barColor=l,c.data("easyPieChart").options.barColor=u,n.data("easyPieChart").update(5*(60-e)/3),o.text(e),s.data("easyPieChart").update(5*(60-i)/3),r.text(i),c.data("easyPieChart").update(5*(60-a)/3),d.text(a)}function n(t,e){var i='<div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>',a=(swal({title:"",text:i+'<p class="m-t-10 f-12 c-gray">正在检查答案</p>',html:!0,allowEscapeKey:!1,showConfirmButton:!1}),$("#q-content").attr("data-id"));$.get(G_BASE_URL+"/question/ajax/question_quiz_submit_answer/question_id-"+a+"__answer-"+t+"__spend_time-"+e+"__record_id-"+QUESTION_QUIZ_RECORD_ID,function(t){if(!t.is_special_user){if(t.internal_error)return sweetAlert("系统错误","答题无效！","error"),void(window.location.href=G_BASE_URL);var i="";e>0&&(i='<p><i class="icon icon-countdown"></i> 答题用时 <span><strong>'+e+"</strong> 秒</span></p>"),t.correct?(t.integral&&(i+='<p><span class="c-green"> +'+t.integral+"</span> 积分</p>",i+="<p>你当前剩余 <span><strong>"+(t.user_integral+t.integral)+"</strong></span> 积分</p>"),swal({title:"回答正确",text:i,html:!0,confirmButtonText:"确定",type:"success"},function(){c()})):(t.integral&&(i+='<p><span class="c-red"> -'+t.integral+"</span> 积分</p>",i+="<p>你当前剩余 <span><strong>"+(t.user_integral-t.integral)+"</strong></span> 积分</p>"),swal({title:"回答错误",text:i,html:!0,confirmButtonText:"确定",type:"error"},function(){c()}))}},"json")}function o(t,e){if(G_USER_ID<=0)return window.location.href=G_BASE_URL+"/account/login/",!1;var i=$("input[name=qz-record-passed]").val();return i?(textInfo='你已经通过了答题，回答正确<strong class="c-red">不加分</strong>，回答错误<strong class="c-red">仍然扣分</strong>',swal({title:"答题提示",text:textInfo,html:!0,confirmButtonText:"继续答题",showCancelButton:!0,cancelButtonText:"返回问题",type:"warning"},function(i){i&&setTimeout(function(){return n(t,e),!0},10)}),!1):(n(t,e),!0)}function s(){if(G_USER_ID<=0)return void(window.location.href=G_BASE_URL+"/account/login/");var t=$("#q-content").attr("data-id");$.get(G_BASE_URL+"/question/ajax/question_quiz_timeout/record_id-"+QUESTION_QUIZ_RECORD_ID+"__question_id-"+t,function(t){t.is_special_user||(textInfo='<p class="c-deeporange"><i class="md md-timer-off"></i> 答题超时</p>',t.required_integral&&(textInfo+='<p><span class="c-red"> -'+t.required_integral+"</span> 积分</p>",textInfo+="<p>你当前剩余 <span><strong>"+(t.user_integral-t.required_integral)+"</strong></span> 积分</p>"),swal({title:"答题失败",text:textInfo,html:!0,confirmButtonText:"确定",type:"error"},function(){c()}))},"json")}function r(e,i){QUESTION_QUIZ=$("input[name=qz-content]").val(),QUESTION_QUIZ_ID=$("input[name=qz-id]").val(),QUESTION_QUIZ_RECORD_ID=$("input[name=qz-record-id]").val();var n=!0;try{var r=$.parseJSON(QUESTION_QUIZ)}catch(c){n=!1}n&&$(".qz-content").nkrQuiz({mode:"single",showSubmit:e,enableCountdown:i,data:r,enabled:!0,onSubmitAnswer:o,beforeCountdown:t,onCountdown:a,onTimeout:s})}function c(){var t='<div class="sk-spinner sk-circle"><div class="sk-circle1 sk-child"></div><div class="sk-circle2 sk-child"></div><div class="sk-circle3 sk-child"></div><div class="sk-circle4 sk-child"></div><div class="sk-circle5 sk-child"></div><div class="sk-circle6 sk-child"></div><div class="sk-circle7 sk-child"></div><div class="sk-circle8 sk-child"></div><div class="sk-circle9 sk-child"></div><div class="sk-circle10 sk-child"></div><div class="sk-circle11 sk-child"></div><div class="sk-circle12 sk-child"></div></div>';$("#q-content").html(t);var a=$("#q-content").attr("data-id");$.get(G_BASE_URL+"/question/ajax/init_question_content/id-"+a,function(t){$("#q-content").html(t);var a=$("input[name=qz-record-passed]").val(),n=$("input[name=qz-record-try-count]").val();e(90),i(),r(0==n||n>0&&a,!a)})}function d(t){if(G_USER_ID<=0)return void(window.location.href=G_BASE_URL+"/account/login/");var e=$("#q-content").attr("data-id");$.get(G_BASE_URL+"/question/ajax/get_question_quiz_retry_integral/question_id-"+e,function(i){return i.err?void NKR.alert(i.err):i.not_enough_integral?(textInfo="<p>你当前剩余 <strong>"+i.user_integral+'</strong> 积分</p><p>重新答题需要 <span class="c-red">'+i.required_integral+"</span> 积分</p>",textInfo+='<div class="m-t-20 alert-get-integral"><i class="md md-help"></i> 你可以通过<a class="c-lightblue" href="'+G_BASE_URL+'/publish/">分享题目</a>来获取额外积分，更多获取积分的方式可以查看<a class="c-lightblue" href="'+G_BASE_URL+'/integral/rule/">积分规则</a></div>',void swal({title:"积分不足",text:textInfo,html:!0,confirmButtonText:"获取积分",showCancelButton:!0,cancelButtonText:"返回问题",type:"info"},function(){window.location.href=G_BASE_URL+"/integral/rule/"})):void(i.required_integral>0&&swal({title:"积分提示",text:"<p>你当前剩余 <strong>"+i.user_integral+'</strong> 积分</p><p>重新答题需要 <span class="c-red">'+i.required_integral+"</span> 积分</p>",html:!0,confirmButtonText:"继续",showCancelButton:!0,cancelButtonText:"取消",type:"info"},function(){$.get(G_BASE_URL+"/question/ajax/save_question_quiz_retry_integral/question_id-"+e,function(e){return e.err?void NKR.alert(e.err):void t()},"json")}))},"json")}function l(){if(G_USER_ID<=0)return void(window.location.href=G_BASE_URL+"/account/login/");var t=$("#q-content").attr("data-id");$.get(G_BASE_URL+"/question/ajax/begin_question_quiz_countdown/id-"+t,function(t){$("#q-content").html(t).css("opacity",0).animate({opacity:1},300),e(90),i(),r(!0,!0)})}c(),$("body").on("click","[data-qz-act]",function(t){
t.preventDefault();var e=($(this),$(this).data("qz-act"));switch(e){case"retry":d(function(){$(".qz-state").hide(),r(!0,!0)});break;case"retry-countdown":d(function(){l()});break;case"discuss":questionComment();break;case"answer-countdown":l()}})}),$(document).ready(function(){function t(t,e){e&&(t.addClass("no-more"),t.html("没有更多"))}function e(){"undefined"!=typeof QUESTION_ID&&$.get(G_BASE_URL+"/question/ajax/invited_users/question_id-"+QUESTION_ID+"__page-1",function(e){""!=e?($("#qi-invited-list").html(e),$("#qi-invited .load-more").html('<a href="#" auto-load="false" id="qi-load-more"><i class="icon icon-load-more"></i> 加载更多</a>').show(),NKR.load_list_view(G_BASE_URL+"/question/ajax/invited_users/question_id-"+QUESTION_ID,$("#qi-load-more"),$("#qi-invited-list"),2,t)):($("#qi-invited-list").html('<div class="qia-no-invites"><p>目前还没有被邀请的用户</p><a href="#" class="qia-add-invite"><i class="icon icon-person-add"></i> 邀请答题</a></div>'),$("#qi-invited .load-more").hide())})}function i(){"undefined"!=typeof QUESTION_ID&&$.get(G_BASE_URL+"/question/ajax/user_invited_users/uid-"+G_USER_ID+"__question_id-"+QUESTION_ID,function(t){$("#qim-invites").html(t)})}function a(){var t=$("#qia-search-input"),e=$("#qia-search-result"),i=$("#qia-search-clear"),a=t.val().trim(),n=$("#qia-recommend-list");if(a.length>0){i.show();var o=G_BASE_URL+"/search/ajax/search/?type=users&q="+encodeURIComponent(a)+"&limit=10",s=$.get(o,function(t){0!=t.length&&void 0!=s?(e.html(""),$.each(t,function(t,i){e.append(Mustache.render(TEMPLATE.inviteSearch,{uid:i.uid,name:i.name,img:i.detail.avatar_file,intro:i.detail.signature,url:i.url,hide:t>2}))}),e.append('<a class="qia-more qia-more-search" href="#">更多搜索结果</a>')):e.html('<div class="qia-search-none">没有找到相关用户</div>')},"json");e.show(),n.hide()}else i.hide(),e.hide(),n.show()}$("body").on("click",".qia-toggle-invitation",function(t){if(t.preventDefault(),G_USER_ID<=0)return void(window.location=G_BASE_URL+"/account/login/");var a=$(t.target);a.hasClass("invited")?$.post(G_BASE_URL+"/question/ajax/cancel_question_invite/question_id-"+QUESTION_ID+"__recipients_uid-"+a.attr("data-id"),function(t){-1==t.errno?NKR.alert(t.err):(e(),i(),a.removeClass("invited").text("发送邀请"))},"json"):$.post(G_BASE_URL+"/question/ajax/save_invite/question_id-"+QUESTION_ID+"__uid-"+a.attr("data-id"),function(t){-1==t.errno?NKR.alert(t.err):(e(),i(),a.addClass("invited").text("取消邀请"))},"json")}),$("body").on("click",".qim-cancel-invitation",function(t){t.preventDefault();var a=$(this),n=$('#qia-recommend-list .qia-toggle-invitation[data-id="'+a.attr("data-id")+'"]')[0];n?n.click():$.post(G_BASE_URL+"/question/ajax/cancel_question_invite/question_id-"+QUESTION_ID+"__recipients_uid-"+a.attr("data-id"),function(t){-1==t.errno?NKR.alert(t.err):(e(),i())},"json")}),e(),$("body").on("click",".qia-more",function(t){var e=$(this);t.preventDefault(),e.siblings().removeClass("hide"),e.detach()}),i(),$("#qia-search-input").on("keyup",function(t){a()}),$("#qia-search-clear").on("click",function(t){t.preventDefault(),$("#qia-search-input").val(""),a()}),$("body").on("click",".qia-add-invite",function(t){t.preventDefault(),$.scrollTo($("#question-invites").offset().top-70,300,{queue:!0}),$("#qi-add-invite-tab").click()})}),$(document).ready(function(){function t(t){"undefined"!=typeof QUESTION_ID&&$.get(G_BASE_URL+"/question/ajax/load_answers/question_id-"+QUESTION_ID,function(e){$("#qcmt-comment-list").html(e),$(".qcmt-comments").removeClass("hide"),"function"==typeof t&&t()})}window.questionComment=function(){$.scrollTo($("#question-comments").offset().top-70,300,{queue:!0}),$(".qcmt-reply-box").is(":visible")&&$(".qcmt-reply-box textarea").focus()},1==$("#qcmt-comment-list").attr("data-show-comments")&&t(),$(".qcmt-load-comments").on("click",function(e){return e.preventDefault(),G_USER_ID<=0?void(window.location.href=G_BASE_URL+"/account/login/"):void t(function(){$(".qcmt-load-hint").hide(),questionComment()})}),$("body").on("click",".qcmt-reply",function(t){t.preventDefault();var e=$(this),i=e.attr("data-user-name"),a=e.attr("data-index"),n=$("#ci-reply-box-"+e.attr("data-answer-id")),o=n.find("textarea"),s=o.attr("data-index"),r="@"+i+" ";"undefined"==typeof i&&(r=""),n.is(":visible")?a!=s?(o.attr("data-index",a),o.val(r),o.focus()):(o.removeAttr("data-index"),n.hide(),o.val("")):(n.show(),o.attr("data-index",a),o.insertAtCaret(r),o.focus(),$.scrollTo(o.offset().top-250,300,{queue:!0}))}),"undefined"!=typeof QUESTION_ID&&NKR.load_list_view(G_BASE_URL+"/question/ajax/load_answers/question_id-"+QUESTION_ID,$("#qcmt-load-more"),$("#qcmt-comment-list"),2,function(t,e){e&&(t.addClass("no-more"),t.html("已加载全部讨论"))})}),$(document).ready(function(){function t(){$.get(G_BASE_URL+"/question/ajax/get_question_solution/question_id-"+QUESTION_ID,function(t){return t?($("#solution-content").html(t),void $("#dlg-solution").modal()):void AWS.alert("获取答案解析失败！")})}$("body").on("click","[data-qtb-act]",function(e){e.preventDefault();var i=$(this),a=i.data("qtb-act");switch(a){case"solution":if(G_USER_ID<=0)return void(window.location.href=G_BASE_URL+"/account/login/");$.get(G_BASE_URL+"/question/ajax/get_question_solution_record/question_id-"+QUESTION_ID,function(e){return e.err?void AWS.alert(e.err):e.solution_not_exist?void swal({title:"系统提示",text:"该问题目前还没有答案解析！",html:!0,confirmButtonText:"确定",type:"info"}):void(e.record_exist?t():$.get(G_BASE_URL+"/question/ajax/get_question_view_solution_integral/question_id-"+QUESTION_ID,function(e){return e.err?void AWS.alert(e.err):e.not_enough_integral?(textInfo="<p>你当前剩余 <strong>"+e.user_integral+'</strong> 积分</p><p>查看答案解析需要 <span class="required-integral c-red">'+e.required_integral+"</span> 积分</p>",textInfo+='<div class="m-t-20 alert-get-integral"><i class="md md-help"></i> 你可以通过<a class="c-lightblue" href="'+G_BASE_URL+'/publish/">分享题目</a>来获取额外积分，更多获取积分的方式可以查看<a class="c-lightblue" href="'+G_BASE_URL+'/integral/rule/">积分规则</a></div>',void swal({title:"积分不足",text:textInfo,html:!0,confirmButtonText:"获取积分",showCancelButton:!0,cancelButtonText:"返回问题",type:"info"},function(){window.location.href=G_BASE_URL+"/integral/rule/"})):void(e.required_integral>0&&swal({title:"积分提示",text:"<p>你当前剩余 <strong>"+e.user_integral+'</strong> 积分</p><p>查看答案解析需要 <span class="c-red">'+e.required_integral+"</span> 积分</p>",html:!0,confirmButtonText:"继续",showCancelButton:!0,cancelButtonText:"取消",type:"info"},function(){$.get(G_BASE_URL+"/question/ajax/save_question_view_solution_integral/question_id-"+QUESTION_ID,function(e){e.err&&AWS.alert(e.err),$.get(G_BASE_URL+"/question/ajax/save_question_solution_record/question_id-"+QUESTION_ID,function(e){e.err?AWS.alert(e.err):t()},"json")})}))},"json"))},"json");break;case"comment":questionComment();break;case"invite":$.scrollTo($("#question-invites").offset().top-70,300,{queue:!0}),$("#qi-add-invite-tab").click();break;case"share":}})}),function(t){var e,i;e=function(){function e(e,i){this.$element=t(e),this.settings=t.extend({},t.fn.nkrQuiz.defaults,i),this.init(),"undefined"!=typeof this.settings.data&&(quizMode=this.settings.mode,"single"==quizMode?this.parseQuizItem(this.$element,this.settings.data,this.settings):"set"==quizMode?this.parseQuizSet():"training"==quizMode&&this.parseQuizTraining())}return e.prototype.init=function(){this.$element.html(""),this.savedAnswers=[]},e.prototype.parseQuizOptionCrossWord=function(e,i,a){function n(t){var e=t.find(".quiz-submit-answer");t.find(".quiz-answer-board .quiz-answer-key.blank").length?e.addClass("disabled"):e.removeClass("disabled")}for(var o='<div class="quiz-options"><div class="quiz-word-board"><div class="quiz-word-group">',s=0;s<i[0].content.length;s++)o+='<a href="javascript:void(0);" class="quiz-word-key" data-index="'+s+'" data-word="'+i[0].content[s]+'">'+i[0].content[s]+"</a>";o+='</div><div class="quiz-answer-board"><div class="quiz-word-group">';for(var s=0;s<i[0].wordcount;s++)o+='<a href="javascript:void(0);" class="quiz-answer-key blank"></a>';o+="</div></div></div>",e.append(o);var r=function(e){var i="";return e.find(".quiz-answer-key").each(function(e){i+=t(this).text().trim()}),i},c=function(t){t.find(".quiz-submit-answer").off("click").prop("disabled",!0),t.find(".quiz-word-board").off("click",".quiz-word-key"),t.find(".quiz-answer-board").off("click",".quiz-answer-key")},d=function(e,i){for(var a=e.find(".quiz-word-board .quiz-word-key"),n=e.find(".quiz-answer-board .quiz-answer-key"),o=0;o<i.length;o++){var s=i[o];"undefined"!=typeof s&&(t(a[s]).addClass("checked").text(""),t(n[o]).removeClass("blank").attr("data-word-index",s).text(t(a[s]).attr("data-word")))}};a.getQuizResult=r,a.lockQuiz=c,a.setupInitAnswer=d,e.find(".quiz-word-board").on("click",".quiz-word-key",t.proxy(function(i){var a=t(i.currentTarget);if(!a.hasClass("checked")){var o=this.$element.find(".quiz-answer-board .quiz-answer-key.blank:first");o.length&&(a.addClass("checked").text(""),o.removeClass("blank").attr("data-word-index",a.attr("data-index")).text(a.attr("data-word"))),n(e)}i.preventDefault()},this)),e.find(".quiz-answer-board").on("click",".quiz-answer-key",t.proxy(function(i){var a=t(i.currentTarget);if(!a.hasClass("blank")){var o=e.find('.quiz-word-board .quiz-word-key[data-index="'+a.attr("data-word-index")+'"]');o.length&&(o.removeClass("checked").text(o.attr("data-word")),a.addClass("blank").removeAttr("data-word-index").text(""),n(e))}i.preventDefault()},this))},e.prototype.parseQuizOptionSingleSelection=function(e,i,a){function n(t){var e=t.find(".quiz-submit-answer");t.find(".quiz-single-selection .quiz-option.checked").length?e.removeClass("disabled"):e.addClass("disabled")}for(var o='<div class="quiz-options"><ul class="quiz-single-selection">',s=0;s<i.length;s++){var r=a.alphabet[s%a.alphabet.length];o+='<li class="quiz-option" data-index="'+s+'"><span class="quiz-option-tag"><em class="quiz-option-index">'+r+'</em><i class="quiz-option-mark icon icon-check"></i></span><span>'+i[s].content+"</span></li>"}o+="</ul></div>",e.append(o);var c=function(e){return parseInt(t(e.find(".quiz-single-selection .quiz-option.checked")[0]).attr("data-index"))+1},d=function(t){t.find(".quiz-submit-answer").off("click").prop("disabled",!0),t.find(".quiz-single-selection").off("click",".quiz-option")},l=function(e,i){var a=e.find(".quiz-single-selection .quiz-option");"undefined"!=typeof i&&t(a[i]).addClass("checked").siblings(".quiz-option").removeClass("checked")};a.getQuizResult=c,a.lockQuiz=d,a.setupInitAnswer=l,e.find(".quiz-single-selection").on("click",".quiz-option",t.proxy(function(i){t(i.currentTarget).addClass("checked").siblings(".quiz-option").removeClass("checked"),n(e),i.preventDefault()},this))},e.prototype.parseQuizOptionMultipleSelection=function(e,i,a){function n(t){var e=t.find(".quiz-submit-answer");t.find(".quiz-multiple-selection .quiz-option.checked").length?e.removeClass("disabled"):e.addClass("disabled")}for(var o='<div class="quiz-options"><ul class="quiz-multiple-selection">',s=0;s<i.length;s++){var r=a.alphabet[s%a.alphabet.length];o+='<li class="quiz-option" data-index="'+s+'"><span class="quiz-option-tag"><em class="quiz-option-index">'+r+'</em><i class="quiz-option-mark icon icon-check"></i></span><span>'+i[s].content+"</span></li>"}o+="</ul></div>",e.append(o);var c=function(e){var i=[];return e.find(".quiz-multiple-selection .quiz-option.checked").each(function(e){i[e]=parseInt(t(this).attr("data-index"))+1}),i},d=function(t){t.find(".quiz-submit-answer").off("click").prop("disabled",!0),t.find(".quiz-multiple-selection").off("click",".quiz-option")},l=function(e,i){for(var a=e.find(".quiz-multiple-selection .quiz-option"),n=0;n<i.length;n++){var o=i[n];"undefined"!=typeof o&&t(a[o]).addClass("checked")}};a.getQuizResult=c,a.lockQuiz=d,a.setupInitAnswer=l,e.find(".quiz-multiple-selection").on("click",".quiz-option",t.proxy(function(i){t(i.currentTarget).toggleClass("checked"),n(e),i.preventDefault()},this))},e.prototype.parseQuizOptionTextInput=function(e,i,a){function n(e){var i=!0;return e.find(".quiz-text-input input.quiz-input").each(function(){i&=t(this).val().trim().length>0}),i}function o(t){var e=t.find(".quiz-submit-answer");n(t)?e.removeClass("disabled"):e.addClass("disabled")}for(var s='<div class="quiz-options"><ul class="quiz-text-inputs">',r=0;r<i.length;r++)s+='<li class="quiz-text-input"><label>'+(r+1)+'</label><input type="text" class="quiz-input" placeholder="'+i[r].content+'" data-index="'+r+'"></input></li>';s+="</ul></div>",e.append(s);var c=function(e){var i=[];return e.find(".quiz-text-input input.quiz-input").each(function(e){i[e]=t(this).val().trim()}),i},d=function(t){t.find(".quiz-submit-answer").off("click").prop("disabled",!0),t.find(".quiz-text-input").off("input",".quiz-input").find("input.quiz-input").prop("disabled",!0)},l=function(e,i){for(var a=e.find(".quiz-text-input input.quiz-input"),n=0;n<i.length;n++){var o=i[n];"undefined"!=typeof o&&t(a[n]).val(o.trim())}};a.getQuizResult=c,a.lockQuiz=d,a.setupInitAnswer=l,e.find(".quiz-text-input").on("input",".quiz-input",t.proxy(function(t){o(e),t.preventDefault()},this))},e.prototype.parseQuizItem=function(e,i,a){function n(){r--,"function"==typeof a.onTimeout&&a.onCountdown(r),0==r&&(clearInterval(a.timer),"function"==typeof a.lockQuiz&&a.lockQuiz(e),"function"==typeof a.onTimeout&&a.onTimeout())}e="undefined"==typeof e?this.$element:e;var o=!1,s="";if("undefined"!=typeof i.description&&(s+='<div class="quiz-description">',s+=i.description,s+="</div>",e.append(s)),"undefined"!=typeof a.enableCountdown&&a.enableCountdown&&("function"==typeof a.beforeCountdown&&a.beforeCountdown(),i.countdown>0)){var r=i.countdown;a.timer=setInterval(n,1e3)}"crossword"===i.type?(this.parseQuizOptionCrossWord(e,i.options,a),o=!0):"singleSelection"===i.type?(this.parseQuizOptionSingleSelection(e,i.options,a),o=!0):"multipleSelection"===i.type?(this.parseQuizOptionMultipleSelection(e,i.options,a),o=!0):"textInput"===i.type&&(this.parseQuizOptionTextInput(e,i.options,a),o=!0),o&&("undefined"!=typeof a.initAnswer&&"function"==typeof a.setupInitAnswer&&a.setupInitAnswer(this.$element,initAnswer),"undefined"!=typeof a.showSubmit&&a.showSubmit&&(s='<div class="quiz-submit">',s+='<a class="quiz-submit-answer btn btn-success disabled">'+a.submitAnswerText+"</a>",s+="</div>",this.$element.append(s),this.$element.find(".quiz-submit-answer").on("click",t.proxy(function(){if("undefined"!=typeof a.timer&&clearInterval(a.timer),"function"==typeof a.getQuizResult){var t=a.getQuizResult(this.$element),n=-1;if(i.countdown>0&&(n=i.countdown-this.$element.find(".quiz-countdown .timer").attr("data-time-spend")),"function"==typeof a.onSubmitAnswer){if(!a.onSubmitAnswer(t,n))return;"function"==typeof a.lockQuiz&&a.lockQuiz(e)}}},this))),a.enabled||("function"==typeof a.lockQuiz&&a.lockQuiz(e),"undefined"!=typeof a.timer&&clearInterval(a.timer),this.$element.find(".quiz-submit").remove()))},e.prototype.parseQuizSet=function(){var e=t.proxy(function(){var t=this.$element.find(".quiz-question"),e="",i=this.$element.attr("data-qid");t.html(""),"undefined"==typeof i||0>i?(e+='<div class="quiz-description">',"undefined"!=typeof this.settings.data.startupContent&&(e+=this.settings.data.startupContent),e+='<button class="quiz-nav-startup">'+this.settings.startupQuizText+"</button>",e+="</div>",t.append(e)):(this.parseQuizItem(t,this.settings.data.questions[i],{initAnswer:this.savedAnswers[i],showSubmit:!1}),e+='<div class="quiz-navigation">',i>0&&(e+='<button class="quiz-nav-previous">'+this.settings.quizNavPreviousText+"</button>"),i<this.settings.data.questions.length-1&&(e+='<button class="quiz-nav-next">'+this.settings.quizNavNextText+"</button>"),i==this.settings.data.questions.length-1&&(e+='<button class="quiz-nav-complete">'+this.settings.quizNavCompleteText+"</button>"),e+="</div>",t.append(e))},this),i=t.proxy(function(){var t=this.$element.attr("data-qid");"undefined"!=typeof t&&(this.savedAnswers[t]=this.settings.getQuizResult(this.$element))},this),a='<div class="quiz-question"></div>';this.$element.append(a),e(),a='<div class="quiz-question-num-list">';for(var n=0;n<this.settings.data.questions.length;n++)a+='<button class="quiz-question-num">'+(n+1)+"</button>";a+="</div>",this.$element.append(a),this.$element.on("click","button.quiz-nav-startup",t.proxy(function(t){this.$element.attr("data-qid","0"),e(),t.preventDefault()},this)),this.$element.on("click","button.quiz-nav-previous",t.proxy(function(t){var a=this.$element.attr("data-qid");a>0&&(i(),a--,this.$element.attr("data-qid",a),e()),t.preventDefault()},this)),this.$element.on("click","button.quiz-nav-next",t.proxy(function(t){var a=this.$element.attr("data-qid");a<this.settings.data.questions.length-1&&(i(),a++,this.$element.attr("data-qid",a),e()),t.preventDefault()},this)),this.$element.on("click","button.quiz-nav-complete",t.proxy(function(t){},this))},e}(),i=function(){},t.fn.nkrQuiz=function(i){return this.each(function(){var a=t(this),n=a.data("plugin");return a.data("plugin",n=new e(this,i)),"string"===t.type(i)?n[i]():void 0})},t.fn.nkrQuiz.defaults={mode:"single",enabled:!0,alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ",submitAnswerText:"提交答案",startupQuizText:"开始测试",quizNavPreviousText:"上一题",quizNavNextText:"下一题",quizNavCompleteText:"完成测试",getQuizResult:function(){},lockQuiz:function(){},setupInitAnswer:function(){},onSubmitAnswer:function(t,e){},beforeCountdown:function(){},onCountdown:function(t){},onTimeout:function(){}}}(jQuery);var TEMPLATE={inviteSearch:'<li class="list-group-item media {{#hide}}hide{{/hide}}"><div class="pull-left"><a href="{{url}}" class="user-tag user-img"><img class="qia-user-img" src="{{img}}" /></a></div><div class="media-body"><div class="qia-invite"><a class="btn btn-xs qia-toggle-invitation" data-id="{{uid}}">发送邀请</a></div><div class="lgi-heading"><a href="{{url}}" class="user-tag user-name">{{name}}</a></div><small class="lgi-text">{{intro}}</small></div></li>'};$(document).ready(function(){});